"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[183],{30183:(t,e,n)=>{n.d(e,{cz:()=>N,mg:()=>U});var i,o,a,r=n(80315),s=n(69440),c=n(51077);class u extends Error{constructor(t){var e;super(t||"An unexpected error has occurred."),this.name="StandardError",this.type="standard",e=new.target.prototype,Object.setPrototypeOf?Object.setPrototypeOf(this,e):this.__proto__=e,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,new.target):this.stack=new Error(this.message).stack}}(a=i||(i={}))[a.MissingBillingAddress=0]="MissingBillingAddress",a[a.MissingCart=1]="MissingCart",a[a.MissingCheckout=2]="MissingCheckout",a[a.MissingConsignments=3]="MissingConsignments",a[a.MissingCustomer=4]="MissingCustomer",a[a.MissingCheckoutConfig=5]="MissingCheckoutConfig",a[a.MissingOrder=6]="MissingOrder",a[a.MissingOrderConfig=7]="MissingOrderConfig",a[a.MissingOrderId=8]="MissingOrderId",a[a.MissingPayment=9]="MissingPayment",a[a.MissingPaymentId=10]="MissingPaymentId",a[a.MissingPaymentInstrument=11]="MissingPaymentInstrument",a[a.MissingPaymentMethod=12]="MissingPaymentMethod",a[a.MissingPaymentRedirectUrl=13]="MissingPaymentRedirectUrl",a[a.MissingPaymentStatus=14]="MissingPaymentStatus",a[a.MissingPaymentToken=15]="MissingPaymentToken",a[a.MissingShippingAddress=16]="MissingShippingAddress";class d extends u{constructor(t){super(function(t){switch(t){case i.MissingBillingAddress:return"Unable to proceed because billing address data is unavailable.";case i.MissingCart:return"Unable to proceed because cart data is unavailable.";case i.MissingConsignments:return"Unable to proceed because consignments data is unavailable.";case i.MissingCheckout:return"Unable to proceed because checkout data is unavailable.";case i.MissingCustomer:return"Unable to proceed because customer data is unavailable.";case i.MissingCheckoutConfig:case i.MissingOrderConfig:return"Unable to proceed because configuration data is unavailable.";case i.MissingOrder:return"Unable to proceed because order data is unavailable.";case i.MissingOrderId:return"Unable to proceed because order ID is unavailable or not generated yet.";case i.MissingPayment:return"Unable to proceed because payment data is unavailable.";case i.MissingPaymentToken:return"Unable to proceed because the token required to submit a payment is missing.";case i.MissingPaymentMethod:return"Unable to proceed because payment method data is unavailable or not properly configured.";case i.MissingShippingAddress:return"Unable to proceed because shipping address data is unavailable.";default:return"Unable to proceed because the required data is unavailable."}}(t)),this.subtype=t,this.name="MissingDataError",this.type="missing_data"}}function h(t){return e=t.lineItems.physicalItems.filter((t=>!t.addedByPromotion)),(0,s.reduce)(e,((t,e)=>t+e.quantity),0);var e}function l(t,e){if(null==t)throw e?e():new Error("An unexpected error has occurred.");return t}!function(t){t[t.CheckoutButtonNotInitialized=0]="CheckoutButtonNotInitialized",t[t.CustomerNotInitialized=1]="CustomerNotInitialized",t[t.PaymentNotInitialized=2]="PaymentNotInitialized",t[t.ShippingNotInitialized=3]="ShippingNotInitialized",t[t.SpamProtectionNotInitialized=4]="SpamProtectionNotInitialized"}(o||(o={}));class y extends u{constructor(t){super(function(t){switch(t){case o.CustomerNotInitialized:return"Unable to proceed because the customer step of checkout has not been initialized.";case o.PaymentNotInitialized:return"Unable to proceed because the payment step of checkout has not been initialized.";case o.ShippingNotInitialized:return"Unable to proceed because the shipping step of checkout has not been initialized.";case o.SpamProtectionNotInitialized:return"Unable to proceed because the checkout spam protection has not been initialized.";default:return"Unable to proceed because the required component has not been initialized."}}(t)),this.subtype=t,this.name="NotInitializedError",this.type="not_initialized"}}const m={de:"eu",jp:"fe",uk:"eu",us:"na"};var p,g,P,f,b,v;!function(t){t.en_US="en_US",t.en_GB="en_GB",t.de_DE="de_DE",t.fr_FR="fr_FR",t.it_IT="it_IT",t.es_ES="es_ES",t.ja_JP="ja_JP"}(p||(p={})),function(t){t.Home="Home",t.Product="Product",t.Cart="Cart",t.Checkout="Checkout",t.Other="Other"}(g||(g={})),function(t){t.USD="USD",t.EUR="EUR",t.GBP="GBP",t.JPY="JPY"}(P||(P={})),function(t){t.PayAndShip="PayAndShip",t.PayOnly="PayOnly"}(f||(f={})),function(t){t.Gold="Gold",t.LightGray="LightGray",t.DarkGray="DarkGray"}(b||(b={})),function(t){t.C0001="C0001"}(v||(v={}));var C=function(t,e,n,i){return new(n||(n=Promise))((function(o,a){function r(t){try{c(i.next(t))}catch(t){a(t)}}function s(t){try{c(i.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,s)}c((i=i.apply(t,e||[])).next())}))};class w{constructor(t){this.amazonPayV2ScriptLoader=t}initialize(t){return C(this,void 0,void 0,(function*(){this.amazonPayV2SDK=yield this.amazonPayV2ScriptLoader.load(t),this.buttonParentContainer=this.buttonParentContainer||this.createAmazonPayButtonParentContainer()}))}deinitialize(){var t;return this.amazonPayV2Button=void 0,null===(t=this.buttonParentContainer)||void 0===t||t.remove(),this.buttonParentContainer=void 0,this.amazonPayV2SDK=void 0,Promise.resolve()}bindButton(t,e,n){this.getAmazonPayV2SDK().Pay.bindChangeAction(`#${t}`,{amazonCheckoutSessionId:e,changeAction:n})}createButton(t,e){this.amazonPayV2Button=this.getAmazonPayV2SDK().Pay.renderButton(`#${t}`,e)}prepareCheckout(t){const e=this.prepareRequestConfig(t);this.getAmazonPayV2Button().onClick((()=>{this.getAmazonPayV2Button().initCheckout(e)}))}prepareCheckoutWithCreationRequestConfig(t){this.getAmazonPayV2Button().onClick((()=>C(this,void 0,void 0,(function*(){const e=yield t();if(e){const t=this.prepareRequestConfig(e.createCheckoutSessionConfig,e.estimatedOrderAmount,e.productType);this.getAmazonPayV2Button().initCheckout(t)}}))))}signout(){return C(this,void 0,void 0,(function*(){return this.amazonPayV2SDK&&this.amazonPayV2SDK.Pay.signout(),Promise.resolve()}))}renderAmazonPayButton({buttonColor:t,checkoutState:e,containerId:n,decoupleCheckoutInitiation:i=!1,methodId:o,options:a,placement:r,isButtonMicroTextDisabled:s=!1}){const c=document.querySelector(`#${n}`);if(!c)return;const{id:u}=c.appendChild(this.getButtonParentContainer());a&&s&&(a.design=v.C0001);const d=null!=a?a:this.getAmazonPayV2ButtonOptions(e,o,r,i,t);return this.createButton(u,d),this.getButtonParentContainer()}updateBuyNowFlowFlag(t){this.isBuyNowFlow=Boolean(t)}isPh4Enabled(t,e){const n=!!t["PROJECT-3483.amazon_pay_ph4"],i=!!t["INT-6885.amazon_pay_ph4_us_only"];return n&&i?"US"===e:n}prepareRequestConfig(t,e,n){const{publicKeyId:i}=t,o=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(t);o<i.length;o++)e.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(t,i[o])&&(n[i[o]]=t[i[o]])}return n}(t,["publicKeyId"]);return Object.assign(Object.assign({createCheckoutSessionConfig:this.isEnvironmentSpecific(i)?o:t},e&&{estimatedOrderAmount:e}),n&&{productType:n})}createAmazonPayButtonParentContainer(){const t=Math.random().toString(16).substr(-4),e=document.createElement("div");return e.id=`amazonpay_button_parent_container_${t}`,e}getAmazonPayV2ButtonOptions(t,e,n,o=!1,a=b.Gold){var r;const{getCart:s,getCheckout:c,getStoreConfigOrThrow:u,getPaymentMethodOrThrow:l}=this.getCheckoutState(t),{config:{merchantId:y,testMode:m},initializationData:p}=l(e);if(!p)throw new d(i.MissingPaymentMethod);const{checkoutLanguage:g,checkoutSessionMethod:P,createCheckoutSessionConfig:C,extractAmazonCheckoutSessionId:w,ledgerCurrency:z,publicKeyId:S="",isButtonMicroTextDisabled:I}=p;if(!y||!z)throw new d(i.MissingPaymentMethod);const _=Object.assign({merchantId:y,ledgerCurrency:z,checkoutLanguage:g,placement:n,buttonColor:a},I?{design:v.C0001}:{});if(this.isBuyNowFlow)return Object.assign(Object.assign({},_),{sandbox:!!m});const O=s();_.productType=O&&0===h(O)?f.PayOnly:f.PayAndShip;const{checkoutSettings:{features:k},storeProfile:{shopPath:M,storeCountryCode:B}}=u();if(this.isPh4Enabled(k,B)){if(!C)throw new d(i.MissingPaymentMethod);const t=null===(r=c())||void 0===r?void 0:r.outstandingBalance.toString(),e=null==O?void 0:O.currency.code,n=Object.assign({},_);let a;return this.isEnvironmentSpecific(S)?(n.publicKeyId=S,a=C):(n.sandbox=!!m,a=Object.assign(Object.assign({},C),{publicKeyId:S})),o||(n.createCheckoutSessionConfig=a),t&&e&&(n.estimatedOrderAmount={amount:t,currencyCode:e}),n}const A={method:P,url:`${M}/remote-checkout/${e}/payment-session`,extractAmazonCheckoutSessionId:w};return Object.assign(Object.assign({},_),{createCheckoutSession:A,sandbox:!!m})}isEnvironmentSpecific(t){return/^(SANDBOX|LIVE)/.test(t)}getAmazonPayV2SDK(){return this.getOrThrow(this.amazonPayV2SDK)}getButtonParentContainer(){return this.getOrThrow(this.buttonParentContainer)}getAmazonPayV2Button(){return this.getOrThrow(this.amazonPayV2Button)}getOrThrow(t){return l(t,(()=>new y(o.PaymentNotInitialized)))}getCheckoutState(t){return"object"==typeof(e=t)&&null!==e&&"cart"in e&&"checkout"in e&&"config"in e&&"paymentMethods"in e?{getCart:t.cart.getCart,getCheckout:t.checkout.getCheckout,getStoreConfigOrThrow:t.config.getStoreConfigOrThrow,getPaymentMethodOrThrow:e=>t.paymentMethods.getPaymentMethodOrThrow(e)}:t;var e}}class z extends u{constructor(t){super(t||"Unable to proceed because the client library of a payment method is not loaded or ready to be used."),this.name="PaymentMethodClientUnavailableError",this.type="payment_method_client_unavailable"}}class S{constructor(t,e=window){this.scriptLoader=t,this.windowWithAmazonPay=e}load(t){return e=this,i=function*(){const{initializationData:e}=t,n=(null==e?void 0:e.region)||"us",i=m[n];if(yield this.scriptLoader.loadScript(`https://static-${i}.payments-amazon.com/checkout.js`),!this.windowWithAmazonPay.amazon)throw new z;return this.windowWithAmazonPay.amazon},new((n=void 0)||(n=Promise))((function(t,o){function a(t){try{s(i.next(t))}catch(t){o(t)}}function r(t){try{s(i.throw(t))}catch(t){o(t)}}function s(e){var i;e.done?t(e.value):(i=e.value,i instanceof n?i:new n((function(t){t(i)}))).then(a,r)}s((i=i.apply(e,[])).next())}));var e,n,i}}function I(){return new w(new S((0,r.vQ)()))}function _(t,e){return Object.assign(t,{resolveIds:e})}class O extends u{constructor(t){super(t||"Invalid arguments have been provided."),this.name="InvalidArgumentError",this.type="invalid_argument"}}class k extends O{constructor(t){let e="Unable to submit payment for the order because the payload is invalid.";t&&(e=`${e} Make sure the following fields are provided correctly: ${t.join(", ")}.`),super(e),this.name="PaymentArgumentInvalidError"}}class M extends u{constructor(t){super(t||"Payment process was cancelled."),this.name="PaymentMethodCancelledError",this.type="payment_cancelled"}}class B extends u{constructor(){super("The current order does not need to be finalized at this stage."),this.name="OrderFinalizationNotRequiredError",this.type="order_finalization_not_required"}}var A=function(t,e,n,i){return new(n||(n=Promise))((function(o,a){function r(t){try{c(i.next(t))}catch(t){a(t)}}function s(t){try{c(i.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,s)}c((i=i.apply(t,e||[])).next())}))};class T{constructor(t,e){this.paymentIntegrationService=t,this.amazonPayV2PaymentProcessor=e}initialize(t){return A(this,void 0,void 0,(function*(){const{methodId:e,amazonpay:n}=t;if(!e)throw new O('Unable to proceed because "methodId" argument is not provided.');const i=this.paymentIntegrationService.getState(),{features:o}=i.getStoreConfigOrThrow().checkoutSettings,a=i.getPaymentMethodOrThrow(e),r=a.initializationData||{},{paymentToken:s="",region:c="",isButtonMicroTextDisabled:u}=r;if(yield this.amazonPayV2PaymentProcessor.initialize(a),this._isReadyToPay(s))(null==n?void 0:n.editButtonId)&&this._bindEditButton(n.editButtonId,s,"changePayment",this._isModalFlow(c));else{const{id:t}=this._createContainer();if(this._amazonPayButton=this.amazonPayV2PaymentProcessor.renderAmazonPayButton({checkoutState:i,containerId:t,decoupleCheckoutInitiation:this._isOneTimeTransaction(o,c.toUpperCase()),methodId:e,placement:g.Checkout,isButtonMicroTextDisabled:u}),!this._amazonPayButton)throw new O("Unable to render the Amazon Pay button to an invalid HTML container element.")}}))}execute(t,e){return A(this,void 0,void 0,(function*(){const{payment:n}=t;if(!n)throw new k(["payment"]);const{methodId:i}=n,o=this.paymentIntegrationService.getState(),{features:a}=o.getStoreConfigOrThrow().checkoutSettings,r=o.getPaymentMethodOrThrow(i).initializationData||{},{paymentToken:c="",region:u=""}=r;if(this._isReadyToPay(c)||this._isOneTimeTransaction(a,u.toUpperCase())){const n={methodId:i,paymentData:{nonce:c||"apb"}};yield this.paymentIntegrationService.submitOrder(t,e);try{return void(yield this.paymentIntegrationService.submitPayment(n))}catch(t){if(!((t=>"object"==typeof t&&null!==t&&"body"in t)(t)&&(d=t.body,"object"==typeof d&&null!==d&&"status"in d&&"additional_action_required"in d&&"additional_action_required"===d.status&&"data"in d.additional_action_required&&"redirect_url"in d.additional_action_required.data&&"string"==typeof d.additional_action_required.data.redirect_url)))throw t;const{additional_action_required:e}=t.body,{redirect_url:n}=e.data;if(c)return new Promise((()=>window.location.assign(n)));this.amazonPayV2PaymentProcessor.prepareCheckout(JSON.parse(n))}}var d;return this._getAmazonPayButton().click(),this._isModalFlow(u)?new Promise(((t,e)=>{const n=()=>{window.removeEventListener("focus",n),e(new M("Shopper needs to login to Amazonpay to continue"))};window.addEventListener("focus",n)})):new Promise(s.noop)}))}finalize(){return Promise.reject(new B)}deinitialize(){return A(this,void 0,void 0,(function*(){yield this.amazonPayV2PaymentProcessor.deinitialize(),this._amazonPayButton=void 0}))}_bindEditButton(t,e,n,i){const o=document.getElementById(t);if(o&&o.parentNode){if(!i){const t=o.cloneNode(!0);o.parentNode.replaceChild(t,o),t.addEventListener("click",(()=>{this._showLoadingSpinner()}))}this.amazonPayV2PaymentProcessor.bindButton(t,e,n)}}_isModalFlow(t){return"us"===t}_showLoadingSpinner(){return A(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.widgetInteraction((()=>new Promise(s.noop)))}))}_createContainer(){let t=document.getElementById("AmazonPayButton");return t||(t=document.createElement("div"),t.id="AmazonPayButton",t.style.display="none",document.body.appendChild(t))}_getAmazonPayButton(){return l(this._amazonPayButton,(()=>new y(o.PaymentNotInitialized)))}_isOneTimeTransaction(t,e){return this.amazonPayV2PaymentProcessor.isPh4Enabled(t,e)&&t["INT-6399.amazon_pay_apb"]}_isReadyToPay(t){return!!t}}const N=_((t=>new T(t,I())),[{id:"amazonpay"}]);class V extends u{constructor(t){super(t||"Not implemented."),this.name="NotImplementedError",this.type="not_implemented"}}var x=function(t,e,n,i){return new(n||(n=Promise))((function(o,a){function r(t){try{c(i.next(t))}catch(t){a(t)}}function s(t){try{c(i.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,s)}c((i=i.apply(t,e||[])).next())}))};class E{constructor(t,e){this.paymentIntegrationService=t,this.amazonPayV2PaymentProcessor=e}initialize(t){return x(this,void 0,void 0,(function*(){const{methodId:e,amazonpay:n}=t;if(!e||!(null==n?void 0:n.container))throw new O('Unable to proceed because "methodId" or "containerId" argument is not provided.');let i;try{i=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e)}catch(t){yield this.paymentIntegrationService.loadPaymentMethod(e),i=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e)}yield this.amazonPayV2PaymentProcessor.initialize(i),this.amazonPayV2PaymentProcessor.renderAmazonPayButton({checkoutState:this.paymentIntegrationService.getState(),containerId:n.container,methodId:e,placement:g.Checkout})}))}deinitialize(){return x(this,void 0,void 0,(function*(){yield this.amazonPayV2PaymentProcessor.deinitialize()}))}signIn(){throw new V('In order to sign in via Amazon, the shopper must click on "Amazon Pay" button.')}signOut(t){return x(this,void 0,void 0,(function*(){const e=this.paymentIntegrationService.getState().getPaymentId();e&&(yield this.amazonPayV2PaymentProcessor.signout(),yield this.paymentIntegrationService.remoteCheckoutSignOut(e.providerId,t))}))}executePaymentMethodCheckout(t){var e;return null===(e=null==t?void 0:t.continueWithCheckoutCallback)||void 0===e||e.call(t),Promise.resolve()}}const U=_((t=>new E(t,I())),[{id:"amazonpay"}]);class j extends u{constructor(t){super(t||"An unexpected error has occurred during buy now cart creation process. Please try again later."),this.name="BuyNowCartCreationError",this.type="buy_now_cart_creation_error"}}class D extends u{constructor(t){super(t||"An unexpected error has occurred during config creation process. Please try again later."),this.name="AmazonPayV2ConfigCreationError",this.type="amazon_pay_v2_config_creation_error"}}function q(t){return t instanceof Object&&"buyNowInitializeOptions"in t}var R,L=function(t,e,n,i){return new(n||(n=Promise))((function(o,a){function r(t){try{c(i.next(t))}catch(t){a(t)}}function s(t){try{c(i.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,s)}c((i=i.apply(t,e||[])).next())}))};class K{constructor(t,e,n){this.paymentIntegrationService=t,this.amazonPayV2PaymentProcessor=e,this.amazonPayV2ConfigRequestSender=n}initialize(t){var e;return L(this,void 0,void 0,(function*(){const{methodId:n,containerId:i,amazonpay:o}=t,{buttonColor:a}=o||{};if(!n||!i)throw new O('Unable to proceed because "methodId" or "containerId" argument is not provided.');const{getPaymentMethodOrThrow:r}=this.paymentIntegrationService.getState(),s=r(n),{initializationData:c}=s;yield this.amazonPayV2PaymentProcessor.initialize(s),o||(yield this.paymentIntegrationService.loadDefaultCheckout());const u=q(o)?void 0:o;q(o)&&"function"==typeof(null===(e=o.buyNowInitializeOptions)||void 0===e?void 0:e.getBuyNowCartRequestBody)&&(this._buyNowInitializeOptions=o.buyNowInitializeOptions,this.amazonPayV2PaymentProcessor.updateBuyNowFlowFlag(!0)),this.amazonPayV2PaymentProcessor.renderAmazonPayButton({checkoutState:this.paymentIntegrationService.getState(),containerId:i,methodId:n,options:u,placement:g.Cart,buttonColor:a,isButtonMicroTextDisabled:null==c?void 0:c.isButtonMicroTextDisabled}),this._buyNowInitializeOptions&&this.amazonPayV2PaymentProcessor.prepareCheckoutWithCreationRequestConfig(this._getCheckoutCreationRequestConfig.bind(this))}))}deinitialize(){return this.amazonPayV2PaymentProcessor.deinitialize()}_createBuyNowCartOrThrow(){var t,e;return L(this,void 0,void 0,(function*(){const n=null===(e=null===(t=this._buyNowInitializeOptions)||void 0===t?void 0:t.getBuyNowCartRequestBody)||void 0===e?void 0:e.call(t);if(!n)throw new d(i.MissingCart);try{return yield this.paymentIntegrationService.createBuyNowCart(n)}catch(t){throw new j}}))}_createCheckoutConfig(t){return L(this,void 0,void 0,(function*(){try{const e=(yield this.amazonPayV2ConfigRequestSender.createCheckoutConfig(t)).body,{payload:n,public_key:i}=e,o=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(t);o<i.length;o++)e.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(t,i[o])&&(n[i[o]]=t[i[o]])}return n}(e,["payload","public_key"]);return Object.assign({payloadJSON:n,publicKeyId:i},o)}catch(t){throw new D}}))}_getCheckoutCreationRequestConfig(){return L(this,void 0,void 0,(function*(){const t=yield this._createBuyNowCartOrThrow(),e={amount:String(t.baseAmount),currencyCode:t.currency.code};return{createCheckoutSessionConfig:yield this._createCheckoutConfig(t.id),estimatedOrderAmount:e,productType:0===h(t)?f.PayOnly:f.PayAndShip}}))}}!function(t){t.Json="application/json",t.JsonV1="application/vnd.bc.v1+json"}(R||(R={}));const F=R,J={"X-Checkout-SDK-Version":"1.832.1"};class G{constructor(t){this._requestSender=t}createCheckoutConfig(t){const e={cartId:t},n=Object.assign({"X-API-INTERNAL":"This API endpoint is for internal use only and may change in the future","Content-Type":F.Json},J);return this._requestSender.post("/api/storefront/payment/amazonpay",{headers:n,body:e})}}_((t=>{const e=(0,c.createRequestSender)(),n=new G(e),i=I();return new K(t,i,n)}),[{id:"amazonpay"}])}}]);
//# sourceMappingURL=183-4ab72af3.js.map