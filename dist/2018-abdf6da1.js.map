{"version":3,"file":"2018-abdf6da1.js","mappings":"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","sources":["webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-utils/src/braintree.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/errors/standard-error.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/errors/set-prototype-of.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/errors/payment-method-client-unavailable-error.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-utils/src/braintree-sdk-verison.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-utils/src/braintree-sdk-scripts-integrity.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/errors/not-initialized-error.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-utils/src/types.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-utils/src/braintree-script-loader.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-utils/src/isManageableBraintreeSDKVersion.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/unsupported-browser-error.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-utils/src/utils/is-braintree-error.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/errors/missing-data-error.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-utils/src/braintree-sdk.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/utility/src/is-experiment-enabled/is-experiment-enabled.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-utils/src/braintree-sdk-version-manager.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/to-resolvable-module.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/errors/invalid-argument-error.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/errors/payment-argument-invalid-error.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/payment/is-vaulted-instrument.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/errors/order-finalization-not-required-error.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/payment/is-hosted-intrument-like.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/errors/payment-method-failed-error.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/is-us-bank-account-instrument-like.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-ach/braintree-ach-payment-strategy.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-ach/create-braintree-ach-payment-strategy.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-utils/src/create-braintree-sdk.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/errors/payment-invalid-form-error.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/errors/payment-method-cancelled-error.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/common/cancellable-promise/cancellable-promise.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-utils/src/paypal.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-utils/src/braintree-integration-service.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-utils/src/utils/is-credit-card-instrument-like.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-utils/src/braintree-messages.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/ui/src/overlay/overlay.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/ui/src/overlay/overlay-style.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/ui/src/loading-indicator/loading-indicator.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-paypal-constants.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/is-braintree-error.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/map-to-braintree-shipping-address-override.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-paypal/braintree-paypal-payment-strategy.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/is-braintree-paypal-provider-error.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-paypal/create-braintree-paypal-payment-strategy.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/common/http-request/content-type.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/common/http-request/sdk-version-headers.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-request-sender.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/common/http-request/internal-api-headers.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/errors/request-error.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/errors/payment-method-invalid-error.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/errors/timeout-error.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-local-payment-methods/braintree-local-methods-payment-strategy.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-local-payment-methods/create-braintree-local-methods-payment-strategy.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-utils/src/utils/get-fastlane-styles.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-utils/src/utils/is-braintree-accelerated-checkout-customer.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/payment/instrument.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-fastlane/braintree-fastlane-payment-strategy.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/storage/src/cookie-storage.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-fastlane/braintree-fastlane-utils.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-fastlane/create-braintree-fastlane-payment-strategy.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-visa-checkout/braintree-visa-checkout-payment-strategy.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-visa-checkout/create-braintree-visa-checkout-payment-strategy.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-venmo/braintree-venmo-payment-strategy.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-venmo/create-braintree-venmo-payment-strategy.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-credit-card/braintree-credit-card-payment-strategy.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/errors/is-request-error.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-utils/src/utils/is-braintree-payment-request-3ds-error.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-utils/src/utils/is-braintree-form-fields-map.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-utils/src/utils/is-braintree-hosted-form-error.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-hosted-form/braintree-hosted-form.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-utils/src/utils/is-braintree-supported-card-brand.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-credit-card/create-braintree-credit-card-payment-strategy.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-paypal/braintree-paypal-customer-strategy.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/checkout-buttons/default-checkout-button-height.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-paypal/create-braintree-paypal-customer-strategy.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-paypal-credit/braintree-paypal-credit-customer-strategy.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-paypal-credit/create-braintree-paypal-credit-customer-strategy.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-fastlane/braintree-fastlane-customer-strategy.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-fastlane/create-braintree-fastlane-customer-strategy.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/errors/not-implemented-error.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-visa-checkout/braintree-visa-checkout-customer-strategy.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-visa-checkout/create-braintree-visa-checkout-customer-strategy.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/errors/buy-now-cart-creation-error.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/get-valid-button-style.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-paypal/braintree-paypal-button-strategy.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-paypal/create-braintree-paypal-button-strategy.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-paypal-credit/braintree-paypal-credit-button-strategy.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-paypal-credit/create-braintree-paypal-credit-button-strategy.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-visa-checkout/braintree-visa-checkout-button-strategy.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-visa-checkout/create-braintree-visa-checkout-button-strategy.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-utils/src/map-to-legacy-billing-address.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-utils/src/map-to-legacy-shipping-address.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-venmo/braintree-venmo-button-strategy.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/isUnsupportedBrowserError.ts","webpack://checkout/@bigcommerce/checkout-sdk/./packages/braintree-integration/src/braintree-venmo/create-braintree-venmo-button-strategy.ts"],"sourcesContent":["import { Omit } from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport {\n    PaypalAuthorizeData,\n    PaypalButtonOptions,\n    PaypalButtonRender,\n    PaypalSDK,\n    PaypalStyleOptions,\n} from './paypal';\nimport {\n    BraintreeClientCreator,\n    BraintreeDataCollectorCreator,\n    BraintreeError,\n    BraintreeFastlaneCreator,\n    BraintreeGooglePaymentCreator,\n    BraintreeHostedFieldsTokenizePayload,\n    BraintreeModule,\n    BraintreeModuleCreator,\n    BraintreeModuleCreatorConfig,\n    BraintreeThreeDSecureCreator,\n    BraintreeTokenizationDetails,\n    BraintreeUsBankAccountCreator,\n    BraintreeWindow,\n    FastlaneStylesSettings,\n    VisaCheckoutSDK,\n} from './types';\nimport {\n    VisaCheckoutInitOptions,\n    VisaCheckoutPaymentSuccessPayload,\n    VisaCheckoutTokenizedPayload,\n} from './visacheckout';\n\n/**\n *\n * Constants\n *\n */\nexport enum BraintreeEnv {\n    Sandbox = 'sandbox',\n    Production = 'production',\n}\n\n/**\n *\n * Common\n *\n */\nexport enum BraintreeModuleName {\n    Client = 'client',\n    DataCollector = 'dataCollector',\n    Fastlane = 'fastlane',\n    GooglePayment = 'googlePayment',\n    HostedFields = 'hostedFields',\n    LocalPayment = 'localPayment',\n    Paypal = 'paypal',\n    PaypalCheckout = 'paypalCheckout',\n    ThreeDSecure = 'threeDSecure',\n    UsBankAccount = 'usBankAccount',\n    Venmo = 'venmo',\n    VisaCheckout = 'visaCheckout',\n}\n\nexport type BraintreeModuleCreators =\n    | BraintreeClientCreator\n    | BraintreeFastlaneCreator\n    | BraintreeDataCollectorCreator\n    | BraintreeGooglePaymentCreator\n    | BraintreeHostedFieldsCreator\n    | BraintreePaypalCreator\n    | BraintreePaypalCheckoutCreator\n    | BraintreeThreeDSecureCreator\n    | BraintreeVenmoCheckoutCreator\n    | BraintreeVisaCheckoutCreator\n    | BraintreeUsBankAccountCreator\n    | BraintreeLocalPaymentCreator;\n\n// TODO: rename to BraintreeSdkModules\nexport interface BraintreeSDK {\n    [BraintreeModuleName.Client]?: BraintreeClientCreator;\n    [BraintreeModuleName.Fastlane]?: BraintreeFastlaneCreator;\n    [BraintreeModuleName.DataCollector]?: BraintreeDataCollectorCreator;\n    [BraintreeModuleName.GooglePayment]?: BraintreeGooglePaymentCreator;\n    [BraintreeModuleName.HostedFields]?: BraintreeHostedFieldsCreator;\n    [BraintreeModuleName.Paypal]?: BraintreePaypalCreator;\n    [BraintreeModuleName.PaypalCheckout]?: BraintreePaypalCheckoutCreator;\n    [BraintreeModuleName.ThreeDSecure]?: BraintreeThreeDSecureCreator;\n    [BraintreeModuleName.Venmo]?: BraintreeVenmoCheckoutCreator;\n    [BraintreeModuleName.VisaCheckout]?: BraintreeVisaCheckoutCreator;\n    [BraintreeModuleName.UsBankAccount]?: BraintreeUsBankAccountCreator;\n    [BraintreeModuleName.LocalPayment]?: BraintreeLocalPaymentCreator;\n}\n\nexport type BraintreeLocalPaymentCreator = BraintreeModuleCreator<\n    BraintreeLocalPayment,\n    BraintreeLocalPaymentCreateConfig,\n    BraintreeError | undefined\n>;\n\nexport interface BraintreeLocalPaymentCreateConfig extends BraintreeModuleCreatorConfig {\n    merchantAccountId: string;\n}\n\nexport interface BraintreeInitializationData {\n    clientToken: string;\n    enableCheckoutPaywallBanner?: boolean;\n    intent?: 'authorize' | 'order' | 'sale';\n    isCreditEnabled?: boolean;\n    isAcceleratedCheckoutEnabled?: boolean;\n    isFastlaneStylingEnabled?: boolean;\n    isFastlaneEnabled?: boolean;\n    isFastlaneShippingOptionAutoSelectEnabled?: boolean;\n    fastlaneStyles?: FastlaneStylesSettings;\n    isBraintreeAnalyticsV2Enabled?: boolean;\n    shouldRunAcceleratedCheckout?: boolean; // TODO: only for BT AXO A/B testing purposes, hence should be removed after testing\n    paymentButtonStyles?: Record<string, PaypalStyleOptions>;\n    paypalBNPLConfiguration?: PayPalBNPLConfigurationItem[] | null;\n    nonce?: string;\n}\n\nexport interface BraintreePaypalRequest {\n    amount: string | number;\n    billingAgreementDescription?: string;\n    currency?: string;\n    displayName?: string;\n    enableShippingAddress: true;\n    flow: 'checkout' | 'vault';\n    intent?: 'authorize' | 'order' | 'sale';\n    landingPageType?: 'login' | 'billing';\n    locale?: string;\n    offerCredit?: boolean;\n    shippingAddressEditable?: boolean;\n    shippingAddressOverride?: BraintreeShippingAddressOverride;\n    useraction?: 'commit';\n}\n\nexport interface BraintreeShippingAddressOverride {\n    line1: string;\n    line2?: string;\n    city: string;\n    state: string;\n    postalCode: string;\n    countryCode: string;\n    phone?: string;\n    recipientName?: string;\n}\n\nexport interface BraintreeTokenizePayload {\n    nonce: string;\n    type: 'PaypalAccount' | 'VenmoAccount';\n    details: BraintreeTokenizationDetails;\n    creditFinancingOffered?: {\n        totalCost: {\n            value: string;\n            currency: string;\n        };\n        term: number;\n        monthlyPayment: {\n            value: string;\n            currency: string;\n        };\n        totalInsterest: {\n            value: string;\n            currency: string;\n        };\n        payerAcceptance: boolean;\n        cartAmountImmutable: boolean;\n    };\n}\n\nexport type BraintreeFormErrorData = Omit<BraintreeFormFieldState, 'isFocused'>;\n\nexport type BraintreeFormErrorDataKeys =\n    | 'number'\n    | 'expirationDate'\n    | 'expirationMonth'\n    | 'expirationYear'\n    | 'cvv'\n    | 'postalCode';\n\nexport type BraintreeFormErrorsData = Partial<\n    Record<BraintreeFormErrorDataKeys, BraintreeFormErrorData>\n>;\n\n/**\n *\n * Braintree Hosted Fields\n *\n */\nexport type BraintreeHostedFieldsCreator = BraintreeModuleCreator<\n    BraintreeHostedFields,\n    BraintreeHostedFieldsCreatorConfig\n>;\n\nexport interface BraintreeHostedFields {\n    getState(): BraintreeHostedFieldsState;\n    teardown(): Promise<void>;\n    tokenize(\n        options?: BraintreeHostedFieldsTokenizeOptions,\n    ): Promise<BraintreeHostedFieldsTokenizePayload>;\n    on(eventName: string, callback: (event: BraintreeHostedFieldsState) => void): void;\n}\n\nexport interface BraintreeHostedFieldsCreatorConfig extends BraintreeModuleCreatorConfig {\n    fields: {\n        number?: BraintreeHostedFieldOption;\n        expirationDate?: BraintreeHostedFieldOption;\n        expirationMonth?: BraintreeHostedFieldOption;\n        expirationYear?: BraintreeHostedFieldOption;\n        cvv?: BraintreeHostedFieldOption;\n        postalCode?: BraintreeHostedFieldOption;\n        cardholderName?: BraintreeHostedFieldOption;\n    };\n    styles?: {\n        input?: { [key: string]: string };\n        '.invalid'?: { [key: string]: string };\n        '.valid'?: { [key: string]: string };\n        ':focus'?: { [key: string]: string };\n    };\n    preventCursorJumps?: boolean;\n}\n\nexport interface BraintreeHostedFieldOption {\n    container: string | HTMLElement;\n    placeholder?: string;\n    type?: string;\n    formatInput?: boolean;\n    maskInput?: boolean | { character?: string; showLastFour?: string };\n    select?: boolean | { options?: string[] };\n    maxCardLength?: number;\n    maxlength?: number;\n    minlength?: number;\n    prefill?: string;\n    rejectUnsupportedCards?: boolean;\n    supportedCardBrands?: { [key: string]: boolean };\n}\n\nexport interface BraintreeHostedFieldsState {\n    cards: BraintreeHostedFieldsCard[];\n    emittedBy: string;\n    fields: {\n        number?: BraintreeHostedFieldsFieldData;\n        expirationDate?: BraintreeHostedFieldsFieldData;\n        expirationMonth?: BraintreeHostedFieldsFieldData;\n        expirationYear?: BraintreeHostedFieldsFieldData;\n        cvv?: BraintreeHostedFieldsFieldData;\n        postalCode?: BraintreeHostedFieldsFieldData;\n    };\n}\n\nexport interface BraintreeHostedFieldsCard {\n    type: string;\n    niceType: string;\n    code: { name: string; size: number };\n}\n\nexport interface BraintreeHostedFieldsFieldData {\n    container: HTMLElement;\n    isFocused: boolean;\n    isEmpty: boolean;\n    isPotentiallyValid: boolean;\n    isValid: boolean;\n}\n\nexport interface BraintreeHostedFieldsTokenizeOptions {\n    vault?: boolean;\n    fieldsToTokenize?: string[];\n    cardholderName?: string;\n    billingAddress?: BraintreeBillingAddressRequestData;\n}\n\nexport interface BraintreeBillingAddressRequestData {\n    postalCode?: string;\n    firstName?: string;\n    lastName?: string;\n    company?: string;\n    streetAddress?: string;\n    extendedAddress?: string;\n    locality?: string;\n    region?: string;\n    countryCodeNumeric?: string;\n    countryCodeAlpha2?: string;\n    countryCodeAlpha3?: string;\n    countryName?: string;\n}\n\nexport interface BraintreeHostedFormError extends BraintreeError {\n    details?: {\n        invalidFieldKeys?: string[];\n    };\n}\n\nexport interface BraintreeFormFieldState {\n    isFocused: boolean;\n    isEmpty: boolean;\n    isPotentiallyValid: boolean;\n    isValid: boolean;\n}\n\nexport interface TokenizationPayload {\n    nonce: string;\n    bin: string;\n}\n\n/**\n *\n * Braintree PayPal\n *\n */\nexport type BraintreePaypalCreator = BraintreeModuleCreator<BraintreePaypal>;\n\nexport interface BraintreePaypal {\n    closeWindow(): void;\n    focusWindow(): void;\n    tokenize(options: BraintreePaypalRequest): Promise<BraintreeTokenizePayload>;\n    Buttons?(options: PaypalButtonOptions): PaypalButtonRender;\n}\n\n/**\n * A set of options that are required to support 3D Secure authentication flow.\n *\n * If the customer uses a credit card that has 3D Secure enabled, they will be\n * asked to verify their identity when they pay. The verification is done\n * through a web page via an iframe provided by the card issuer.\n */\n// export interface BraintreeThreeDSecureOptions {\n//     /**\n//      * A callback that gets called when the iframe is ready to be added to the\n//      * current page. It is responsible for determining where the iframe should\n//      * be inserted in the DOM.\n//      *\n//      * @param error - Any error raised during the verification process;\n//      * undefined if there is none.\n//      * @param iframe - The iframe element containing the verification web page\n//      * provided by the card issuer.\n//      * @param cancel - A function, when called, will cancel the verification\n//      * process and remove the iframe.\n//      */\n//     addFrame(\n//         error: Error | undefined,\n//         iframe: HTMLIFrameElement,\n//         cancel: () => Promise<BraintreeVerifyPayload> | undefined,\n//     ): void;\n//\n//     /**\n//      * A callback that gets called when the iframe is about to be removed from\n//      * the current page.\n//      */\n//     removeFrame(): void;\n// }\n\nexport interface BraintreeFormOptions {\n    fields: BraintreeFormFieldsMap | BraintreeStoredCardFieldsMap;\n    styles?: BraintreeFormFieldStylesMap;\n    onBlur?(data: BraintreeFormFieldBlurEventData): void;\n    onCardTypeChange?(data: BraintreeFormFieldCardTypeChangeEventData): void;\n    onFocus?(data: BraintreeFormFieldFocusEventData): void;\n    onValidate?(data: BraintreeFormFieldValidateEventData): void;\n    onEnter?(data: BraintreeFormFieldEnterEventData): void;\n}\n\nexport enum BraintreeFormFieldType {\n    CardCode = 'cardCode',\n    CardCodeVerification = 'cardCodeVerification',\n    CardExpiry = 'cardExpiry',\n    CardName = 'cardName',\n    CardNumber = 'cardNumber',\n    CardNumberVerification = 'cardNumberVerification',\n}\n\nexport interface BraintreeFormFieldsMap {\n    [BraintreeFormFieldType.CardCode]?: BraintreeFormFieldOptions;\n    [BraintreeFormFieldType.CardExpiry]: BraintreeFormFieldOptions;\n    [BraintreeFormFieldType.CardName]: BraintreeFormFieldOptions;\n    [BraintreeFormFieldType.CardNumber]: BraintreeFormFieldOptions;\n}\n\nexport interface BraintreeStoredCardFieldsMap {\n    [BraintreeFormFieldType.CardCodeVerification]?: BraintreeStoredCardFieldOptions;\n    [BraintreeFormFieldType.CardNumberVerification]?: BraintreeStoredCardFieldOptions;\n}\n\nexport interface BraintreeFormFieldOptions {\n    accessibilityLabel?: string;\n    containerId: string;\n    placeholder?: string;\n}\n\nexport interface BraintreeStoredCardFieldOptions extends BraintreeFormFieldOptions {\n    instrumentId: string;\n}\n\nexport interface BraintreeFormFieldStylesMap {\n    default?: BraintreeFormFieldStyles;\n    error?: BraintreeFormFieldStyles;\n    focus?: BraintreeFormFieldStyles;\n}\n\nexport type BraintreeFormFieldStyles = Partial<\n    Pick<CSSStyleDeclaration, 'color' | 'fontFamily' | 'fontSize' | 'fontWeight'>\n>;\n\nexport interface BraintreeFormFieldKeyboardEventData {\n    fieldType: string;\n    errors?: BraintreeFormErrorsData;\n}\n\nexport type BraintreeFormFieldBlurEventData = BraintreeFormFieldKeyboardEventData;\nexport type BraintreeFormFieldEnterEventData = BraintreeFormFieldKeyboardEventData;\nexport type BraintreeFormFieldFocusEventData = BraintreeFormFieldKeyboardEventData;\n\nexport interface BraintreeFormFieldCardTypeChangeEventData {\n    cardType?: string;\n}\n\nexport interface BraintreeFormFieldValidateEventData {\n    errors: {\n        [BraintreeFormFieldType.CardCode]?: BraintreeFormFieldValidateErrorData[];\n        [BraintreeFormFieldType.CardExpiry]?: BraintreeFormFieldValidateErrorData[];\n        [BraintreeFormFieldType.CardName]?: BraintreeFormFieldValidateErrorData[];\n        [BraintreeFormFieldType.CardNumber]?: BraintreeFormFieldValidateErrorData[];\n        [BraintreeFormFieldType.CardCodeVerification]?: BraintreeFormFieldValidateErrorData[];\n        [BraintreeFormFieldType.CardNumberVerification]?: BraintreeFormFieldValidateErrorData[];\n    };\n    isValid: boolean;\n}\n\nexport interface BraintreeFormFieldValidateErrorData {\n    fieldType: string;\n    message: string;\n    type: string;\n}\n\n/**\n *\n * Braintree PayPal Checkout\n *\n */\nexport type BraintreePaypalCheckoutCreator = BraintreeModuleCreator<BraintreePaypalCheckout>;\n\nexport interface BraintreePaypalCheckout {\n    loadPayPalSDK(\n        config: BraintreePaypalSdkCreatorConfig,\n        callback: (instance: BraintreePaypalCheckout) => void,\n    ): void;\n    createPayment(options: BraintreePaypalRequest): Promise<string>;\n    teardown(): Promise<void>;\n    tokenizePayment(options: PaypalAuthorizeData): Promise<BraintreeTokenizePayload>;\n}\n\nexport interface BraintreePaypalSdkCreatorConfig {\n    components?: string;\n    currency?: string;\n    intent?: string;\n    isCreditEnabled?: boolean;\n    commit?: boolean;\n}\n\n/**\n *\n * Braintree Venmo\n *\n */\nexport type BraintreeVenmoCheckoutCreator = BraintreeModuleCreator<\n    BraintreeVenmoCheckout,\n    BraintreeVenmoCreatorConfig\n>;\n\nexport interface BraintreeVenmoCheckout extends BraintreeModule {\n    tokenize(callback: (error: BraintreeError, payload: BraintreeTokenizePayload) => unknown): void;\n    isBrowserSupported(): boolean;\n}\n\nexport interface BraintreeVenmoCreatorConfig extends BraintreeModuleCreatorConfig {\n    allowDesktop?: boolean;\n    paymentMethodUsage?: string;\n}\n\n/**\n *\n * Braintree Visa Checkout\n *\n */\nexport type BraintreeVisaCheckoutCreator = BraintreeModuleCreator<BraintreeVisaCheckout>;\n\nexport interface BraintreeVisaCheckout extends BraintreeModule {\n    tokenize(payment: VisaCheckoutPaymentSuccessPayload): Promise<VisaCheckoutTokenizedPayload>;\n    createInitOptions(options: Partial<VisaCheckoutInitOptions>): VisaCheckoutInitOptions;\n}\n\n/**\n *\n * Braintree BNPL Configurator related types\n *\n */\nexport interface PayPalBNPLConfigurationItem {\n    id: string;\n    name: string;\n    status: boolean;\n    styles: Record<string, string>;\n}\n\n/**\n *\n * Braintree Local Methods\n *\n */\nexport interface BraintreeLocalPaymentConfig {\n    paymentType: string;\n    amount: number;\n    fallback: {\n        url: string;\n        buttonText: string;\n    };\n    currencyCode: string;\n    shippingAddressRequired: boolean;\n    email: string;\n    givenName: string;\n    surname: string;\n    address: {\n        countryCode: string;\n    };\n    onPaymentStart(data: BraintreeLPMPaymentStartData, start: () => Promise<void>): Promise<void>;\n}\n\nexport interface BraintreeLPMStartPaymentError {\n    code: string;\n}\n\nexport interface BraintreeLPMPaymentStartData {\n    paymentId: string;\n}\n\nexport interface BraintreeLocalPaymentsPayload {\n    nonce: string;\n}\n\nexport interface BraintreeLocalPayment extends BraintreeModule {\n    startPayment(\n        config: BraintreeLocalPaymentConfig,\n        callback: (\n            startPaymentError: BraintreeLPMStartPaymentError | undefined,\n            payload: BraintreeLocalPaymentsPayload,\n        ) => Promise<void>,\n    ): void;\n}\n\n/**\n *\n * Other\n *\n */\nexport interface BraintreeHostWindow extends BraintreeWindow {\n    braintree?: BraintreeSDK;\n    paypal?: PaypalSDK;\n    V?: VisaCheckoutSDK;\n}\n","import CustomError from './custom-error';\nimport setPrototypeOf from './set-prototype-of';\n\n/**\n * This error type should not be constructed directly. It is a base class for\n * all custom errors thrown in this library.\n */\nexport default abstract class StandardError extends Error implements CustomError {\n    name = 'StandardError';\n    type = 'standard';\n\n    constructor(message?: string) {\n        super(message || 'An unexpected error has occurred.');\n\n        setPrototypeOf(this, new.target.prototype);\n\n        if (typeof Error.captureStackTrace === 'function') {\n            Error.captureStackTrace(this, new.target);\n        } else {\n            this.stack = new Error(this.message).stack;\n        }\n    }\n}\n","export default function setPrototypeOf(object: any, prototype: object) {\n    if (Object.setPrototypeOf) {\n        Object.setPrototypeOf(object, prototype);\n    } else {\n        object.__proto__ = prototype;\n    }\n\n    return object;\n}\n","import StandardError from './standard-error';\n\n/**\n * This error should be thrown when the client library of a payment method fails\n * to load, or for some reason, it is inaccessible.\n */\nexport default class PaymentMethodClientUnavailableError extends StandardError {\n    constructor(message?: string) {\n        super(\n            message ||\n                'Unable to proceed because the client library of a payment method is not loaded or ready to be used.',\n        );\n\n        this.name = 'PaymentMethodClientUnavailableError';\n        this.type = 'payment_method_client_unavailable';\n    }\n}\n","export const BRAINTREE_SDK_HOSTED_FIELDS_FIX_VERSION = '3.128.0';\nexport const BRAINTREE_SDK_DEFAULT_VERSION = '3.123.2';\nexport const BRAINTREE_SDK_STABLE_VERSION = '3.106.0';\n","import { BraintreeModuleName } from './braintree';\nimport {\n    BRAINTREE_SDK_DEFAULT_VERSION,\n    BRAINTREE_SDK_HOSTED_FIELDS_FIX_VERSION,\n    BRAINTREE_SDK_STABLE_VERSION,\n} from './braintree-sdk-verison';\n\nexport const BRAINTREE_SDK_SCRIPTS_INTEGRITY = {\n    [BRAINTREE_SDK_STABLE_VERSION]: {\n        [BraintreeModuleName.Client]:\n            'sha384-26BXDNnJI23JYRyFBj4xe4sVNrUSSiSSu11kxVXNM/vEPONm4LuL00w6ZaTgQewt',\n        [BraintreeModuleName.PaypalCheckout]:\n            'sha384-B+vzbZwnQtzWBthpkT4TXKUibO65tyeK7eCxSvpblgprTep2+IAXB2Cxxjrn710O',\n        [BraintreeModuleName.Paypal]:\n            'sha384-uyAGL1/3+XJAHnGoNy4eCoXdzJ4f7Ilzp+6w9PNnEjs6DCCz9WMyJjMN1gzc78U+',\n        [BraintreeModuleName.LocalPayment]:\n            'sha384-LIvOEMkIVEwVuYBdVOQc1AC5YbGGlwyfUheS0ACK218D2STuVYQlZ4FyEPowAEfT',\n        [BraintreeModuleName.DataCollector]:\n            'sha384-1bo9JDz+Kscthc085cCKWur8CLwUoBpoNyxsDi7932mCl0zFq3A5mv+FQLw9GHpV',\n        [BraintreeModuleName.UsBankAccount]:\n            'sha384-xmHBVaU+w74V+OebD3AaPONFxHUGMf+QRs8G/JxVPXNNP7MDa2jL0ICWHIe2tTfJ',\n        [BraintreeModuleName.GooglePayment]:\n            'sha384-WKDJl8mqoP82qZpMGH6AbZxnvXnSW8ILV4M64CyMLiugGMwu7LyP89wjCkHqsiBe',\n        [BraintreeModuleName.ThreeDSecure]:\n            'sha384-VQUlpGHzsGvs5XeiGFip7EXRsvoHWEXDVmgCacfbyieZI9mdBOqq3NSoyo28OCOB',\n        [BraintreeModuleName.VisaCheckout]:\n            'sha384-yx7mADfzTN0T43Q6rlH49LIg1EJ0iUZgBp/EczX9LXsUGkySgxrD+nWHQRBkyfoT',\n        [BraintreeModuleName.Venmo]:\n            'sha384-QX4rPjoj1ZDhuG0aSyKs56lEKDqTMTcjYxUHY1SzO5VZDsqIE2NTkqot7KNSCyov',\n        [BraintreeModuleName.HostedFields]:\n            'sha384-VvYBACfSu0Cr/J32uKmxG7AXcNOJE1AzIIL3kbikyS7YKp5fz5Is+NzNP/lyauNy',\n        [BraintreeModuleName.Fastlane]:\n            'sha384-9oGsZMRZwpGtDEDYa/dFt76dECqj1xAni9gIKgc3KfMIiRnR73nEeeUDLiBzxhFa',\n    },\n    [BRAINTREE_SDK_DEFAULT_VERSION]: {\n        [BraintreeModuleName.Client]:\n            'sha384-o+nbQGcwNNxIBeXeu3+XmbSq+Cg8R3EN3N0l5hXCgMMU2RGY0t1z0LroSEIAbfAO',\n        [BraintreeModuleName.PaypalCheckout]:\n            'sha384-WrfbWPBS4mH86GAoycPSgiH8hQ8KH7A67C93Hjhunv/xhNk2YpBn3wbFA4Fhg9U/',\n        [BraintreeModuleName.Paypal]:\n            'sha384-VF389nvvrRUgDsTXMxTYORDtVegB9IQa3Cxr//DyJnLYnz8/X8VCzEvck2c+Megt',\n        [BraintreeModuleName.LocalPayment]:\n            'sha384-tZKx2rEQbfmZpoPSY5VPmJEhaq4X75dLvwHMs3VE9U+C8lPyw+hWTIL1+GPvWCIH',\n        [BraintreeModuleName.DataCollector]:\n            'sha384-E6k3wOpP7syCDDwaRDLF06942Y00NkbwJvWi2OQXwwKzGwG5fd3E7RFUvCCecfvO',\n        [BraintreeModuleName.UsBankAccount]:\n            'sha384-258FON8LZGG0W9Qaz4Jij83pZHu30YnKjJA7gNulLBh6CclkucgF+tHDQuYFRYfW',\n        [BraintreeModuleName.GooglePayment]:\n            'sha384-taJ2p/0+n0VH328POAoBiuEbL3tnHUTE9S42hK1V+Txs3X+QYjZOyKW35JgHRFfO',\n        [BraintreeModuleName.ThreeDSecure]:\n            'sha384-+NSZH4Zj3sO5bdWvPKhU5N16QDxeueTVTnUVeleeESkhLSaz4Ob1hh/5myecc9Ym',\n        [BraintreeModuleName.VisaCheckout]:\n            'sha384-66DiBjghxk1OmBj8aksN8gbQ+CwoQcx1vPfiXUN08g1iQVM+BwewF0p7toM3i7SS',\n        [BraintreeModuleName.Venmo]:\n            'sha384-B5UwY42kE4RoLoWbQ7YpqosUlUad2/DlGWiw0HhoZbSPk30CQAaSA10ohyLDTkDU',\n        [BraintreeModuleName.HostedFields]:\n            'sha384-Aw9EesSaUeWxe36PqEHiOyOyOq8M6CIb1gw7/yHNVPRzGtFXXcd2OQ8qXrIlOj2P',\n        [BraintreeModuleName.Fastlane]:\n            'sha384-rhBL1hpZ71JqG+2TsT0Dih47mbjx8cjJCpeZjk9tw3df1gFMKfCTmMyZunhr7H4Y',\n    },\n    [BRAINTREE_SDK_HOSTED_FIELDS_FIX_VERSION]: {\n        [BraintreeModuleName.Client]:\n            'sha384-0WNxksIpRP+fYZiIdr12g6DBUQfLDzYCQJZtR/C8KkcwSGhPHfcFp3tTaGcMyFTq',\n        [BraintreeModuleName.PaypalCheckout]:\n            'sha384-lWM1jk4BOxoDNV6Kop7tVNvQgINlmEVz0c/OwM+HNHK3QC8xqwd54Ovrt2QRDTjh',\n        [BraintreeModuleName.Paypal]:\n            'sha384-fXUmVxC2EMZBDXZ7eTHSTL/LFBrHej/MSXT/vTBXvra4lzgLNGvREAp+x0GYObuH',\n        [BraintreeModuleName.LocalPayment]:\n            'sha384-pha1xGuGSkmZH5x9aqHvRaO4xLea7rmQ/79PFj9zxNzxuFcOWZg7gOP7FibygOEC',\n        [BraintreeModuleName.DataCollector]:\n            'sha384-Q6PI2F9eekWbAxhroybl+aEcvqhdowN/EQlGwBUyJOzPFn9982u9xl6SU6XfGKzc',\n        [BraintreeModuleName.UsBankAccount]:\n            'sha384-W3RLQSKJL1tQ3+Y7mP6tmkamtZ8bV4Yw/XxL9Jj5JtXHraD8loMF8hAIG5m2zK7F',\n        [BraintreeModuleName.GooglePayment]:\n            'sha384-TITQMsFWA3elDNGP2mWz2oKBo4qjt+TlqzovcaPoeBiAh/wPBi6nae50ADdgU1/i',\n        [BraintreeModuleName.ThreeDSecure]:\n            'sha384-YiycYN89ZlL/Evcaq4y1ajW1mhd7JYfZBDuOwHtIn4/Jnm20GL+/XCM+zYAwWD8D',\n        [BraintreeModuleName.VisaCheckout]:\n            'sha384-/OdaTv9qrkKzjObtUe6yzfDhHozFW/+uXlrSl736sOZRJpjGQETvpYXqMFFg69xv',\n        [BraintreeModuleName.Venmo]:\n            'sha384-dA+ojdW9vbJS4JavcXyOs9d5uZHJg5dNtYupoPSH2zsXIiYDVS5amLb/u8qmQ6oz',\n        [BraintreeModuleName.HostedFields]:\n            'sha384-31ZkS58+iaWsW06ftW52zzVZFp43WPd7pNYRiddYynSNg6Oh7WGbSFGorAUH6T1z',\n        [BraintreeModuleName.Fastlane]:\n            'sha384-jlbrwNvL3HvLAUCtLSmrnQ2GH1udCUrRS/bVmReAS5fuIVvcW8Pko/Gkg82tlgtr',\n    },\n};\n","import StandardError from './standard-error';\n\nexport enum NotInitializedErrorType {\n    CheckoutButtonNotInitialized,\n    CustomerNotInitialized,\n    PaymentNotInitialized,\n    ShippingNotInitialized,\n    SpamProtectionNotInitialized,\n}\n\n/**\n * Throw this error if a method requires a certain initialization call to be\n * made first. Some objects can be constructed but they cannot be used until a\n * separate initialization call is made.\n */\nexport default class NotInitializedError extends StandardError {\n    constructor(public subtype: NotInitializedErrorType) {\n        super(getErrorMessage(subtype));\n\n        this.name = 'NotInitializedError';\n        this.type = 'not_initialized';\n    }\n}\n\nfunction getErrorMessage(type: NotInitializedErrorType): string {\n    switch (type) {\n        case NotInitializedErrorType.CustomerNotInitialized:\n            return 'Unable to proceed because the customer step of checkout has not been initialized.';\n\n        case NotInitializedErrorType.PaymentNotInitialized:\n            return 'Unable to proceed because the payment step of checkout has not been initialized.';\n\n        case NotInitializedErrorType.ShippingNotInitialized:\n            return 'Unable to proceed because the shipping step of checkout has not been initialized.';\n\n        case NotInitializedErrorType.SpamProtectionNotInitialized:\n            return 'Unable to proceed because the checkout spam protection has not been initialized.';\n\n        default:\n            return 'Unable to proceed because the required component has not been initialized.';\n    }\n}\n","import { Address } from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nexport * from './braintree';\nexport * from './paypal';\nexport * from './visacheckout';\n\n/**\n *\n * Braintree Module\n *\n */\nexport interface BraintreeModuleCreator<\n    TInstance,\n    TOptions = BraintreeModuleCreatorConfig,\n    TError = BraintreeError,\n> {\n    create(\n        config: TOptions,\n        callback?: (error: TError, instance: TInstance) => void,\n    ): Promise<TInstance>;\n}\n\nexport interface BraintreeModuleCreatorConfig {\n    client?: BraintreeClient;\n    authorization?: string; // Info: authorization uses clientToken as a value\n}\n\nexport interface BraintreeModule {\n    teardown(): Promise<void>;\n}\n\n/**\n *\n * Braintree Window\n *\n */\nexport interface BraintreeWindow extends Window {\n    client?: BraintreeClientCreator;\n    braintreeFastlane?: BraintreeFastlane;\n}\n\n/**\n *\n * Braintree Client\n *\n */\nexport type BraintreeClientCreator = BraintreeModuleCreator<BraintreeClient>;\n\nexport interface BraintreeClient {\n    request(payload: BraintreeClientRequestPayload): Promise<BraintreeClientRequestResponse>;\n}\n\nexport interface BraintreeClientRequestPayload {\n    data: {\n        creditCard: {\n            billingAddress?: {\n                countryCodeAlpha2: string;\n                locality: string;\n                countryName: string;\n                postalCode: string;\n                streetAddress: string;\n            };\n            cardholderName: string;\n            cvv?: string;\n            expirationDate: string;\n            number: string;\n            options: {\n                validate: boolean;\n            };\n        };\n    };\n    endpoint: string;\n    method: string;\n}\n\nexport interface BraintreeHostedFieldsTokenizePayload {\n    nonce: string;\n    details: {\n        bin: string;\n        cardType: string;\n        expirationMonth: string;\n        expirationYear: string;\n        lastFour: string;\n        lastTwo: string;\n    };\n    description: string;\n    type: string;\n    binData: {\n        commercial: string;\n        countryOfIssuance: string;\n        debit: string;\n        durbinRegulated: string;\n        healthcare: string;\n        issuingBank: string;\n        payroll: string;\n        prepaid: string;\n        productId: string;\n    };\n}\n\nexport interface BraintreeClientRequestResponse {\n    creditCards: BraintreeHostedFieldsTokenizePayload[];\n}\n\n/**\n *\n * Braintree Data Collector\n *\n */\nexport type BraintreeDataCollectorCreator = BraintreeModuleCreator<\n    BraintreeDataCollector,\n    BraintreeDataCollectorCreatorConfig\n>;\n\nexport interface BraintreeDataCollectorCreatorConfig extends BraintreeModuleCreatorConfig {\n    kount?: boolean; // Info: this param is needed for fraud detection (should always be 'true')\n    paypal?: boolean; // TODO: based on braintree documentation, this param is deprecated, so we dont need it anymore\n    riskCorrelationId?: string; // Info: the option is needed for PayPal Analytics\n}\n\nexport interface BraintreeDataCollector extends BraintreeModule {\n    deviceData?: string;\n}\n\n// TODO: remove this interface when BraintreeIntegrationService will be removed\nexport interface BraintreeDataCollectors {\n    default?: BraintreeDataCollector;\n    paypal?: BraintreeDataCollector;\n}\n\n/**\n *\n * Braintree Google Payment\n *\n */\ntype BraintreeGooglePaymentAddressFormat = 'FULL' | 'MIN';\n\nexport enum TotalPriceStatusType {\n    ESTIMATED = 'ESTIMATED',\n    FINAL = 'FINAL',\n    NOT_CURRENTLY_KNOWN = 'NOT_CURRENTLY_KNOWN',\n}\n\nexport interface BraintreeGooglePaymentDataRequestOptions {\n    merchantInfo: {\n        authJwt?: string;\n        merchantId?: string;\n        merchantName?: string;\n    };\n    transactionInfo: {\n        currencyCode: string;\n        totalPriceStatus: TotalPriceStatusType;\n        totalPrice: string;\n    };\n    cardRequirements: {\n        billingAddressRequired: boolean;\n        billingAddressFormat: BraintreeGooglePaymentAddressFormat;\n    };\n    emailRequired?: boolean;\n    phoneNumberRequired?: boolean;\n    shippingAddressRequired?: boolean;\n}\n\nexport interface BraintreeGooglePaymentDataRequest {\n    allowedPaymentMethods: string[];\n    apiVersion: number;\n    cardRequirements: {\n        allowedCardNetworks: string[];\n        billingAddressFormat: string;\n        billingAddressRequired: boolean;\n    };\n    environment: string;\n    i: {\n        googleTransactionId: string;\n        startTimeMs: number;\n    };\n    merchantInfo: {\n        merchantId: string;\n        merchantName: string;\n        authJwt?: string;\n    };\n    paymentMethodTokenizationParameters: {\n        parameters: {\n            'braintree:apiVersion': string;\n            'braintree:authorizationFingerprint': string;\n            'braintree:merchantId': string;\n            'braintree:metadata': string;\n            'braintree:sdkVersion': string;\n            gateway: string;\n        };\n        tokenizationType: string;\n    };\n    shippingAddressRequired: boolean;\n    phoneNumberRequired: boolean;\n    transactionInfo: {\n        currencyCode: string;\n        totalPrice: string;\n        totalPriceStatus: TotalPriceStatusType;\n    };\n}\n\nexport type BraintreeGooglePaymentCreator = BraintreeModuleCreator<BraintreeGooglePayment>;\n\nexport interface BraintreeGooglePayment extends BraintreeModule {\n    createPaymentDataRequest(\n        options?: BraintreeGooglePaymentDataRequestOptions,\n    ): BraintreeGooglePaymentDataRequest;\n}\n\nexport interface BraintreeGooglePayThreeDSecure {\n    verifyCard(options: BraintreeGooglePayThreeDSecureOptions): Promise<BraintreeVerifyPayload>;\n}\n\nexport interface BraintreeGooglePayThreeDSecureOptions {\n    nonce: string;\n    amount: number;\n    bin: string;\n    showLoader?: boolean;\n    onLookupComplete(data: BraintreeThreeDSecureVerificationData, next: () => void): void;\n}\n\n/**\n *\n * Braintree 3D Secure\n *\n */\nexport type BraintreeThreeDSecureCreator = BraintreeModuleCreator<\n    BraintreeThreeDSecure,\n    BraintreeThreeDSecureCreatorConfig\n>;\n\nexport interface BraintreeThreeDSecure extends BraintreeModule {\n    verifyCard(\n        options: BraintreeThreeDSecureOptions,\n        callback?: Braintree3DSVerifyCardCallback,\n    ): Promise<BraintreeVerifyPayload>;\n    cancelVerifyCard(): Promise<BraintreeVerifyPayload>;\n    on<K extends keyof BraintreeThreeDSecureEventMap>(\n        event: K,\n        handler: BraintreeThreeDSecureEventMap[K],\n    ): void;\n}\n\nexport type Braintree3DSVerifyCardCallback = (\n    verifyError: Braintree3DSVerifyCardError,\n    payload: Braintree3DSVerifyCardPayload,\n) => void;\n\nexport interface BraintreeThreeDSecureEventMap {\n    'customer-canceled': () => void;\n}\n\nexport interface Braintree3DSVerifyCardError {\n    code: string;\n}\n\nexport interface Braintree3DSVerifyCardPayload {\n    nonce: string;\n}\n\nexport interface BraintreeThreeDSecureCreatorConfig extends BraintreeModuleCreatorConfig {\n    version?: number;\n}\n\nexport interface BraintreeThreeDSecureOptions {\n    nonce: string;\n    amount: number | string;\n    challengeRequested?: boolean;\n    showLoader?: boolean;\n    bin?: string;\n    additionalInformation?: {\n        acsWindowSize?: '01' | '02' | '03' | '04' | '05';\n    };\n    collectDeviceData?: boolean;\n    addFrame?(\n        error: Error | undefined,\n        iframe: HTMLIFrameElement,\n        cancel: () => Promise<BraintreeVerifyPayload> | undefined,\n    ): void;\n    removeFrame?(): void;\n    onLookupComplete?(data: BraintreeThreeDSecureVerificationData, next: () => void): void;\n}\n\nexport interface BraintreeThreeDSecureVerificationData {\n    lookup: {\n        threeDSecureVersion: string;\n    };\n    paymentMethod: BraintreeVerifyPayload;\n    requiresUserAuthentication: boolean;\n    threeDSecureInfo: {\n        liabilityShiftPossible: boolean;\n        liabilityShifted: boolean;\n    };\n}\n\nexport enum BraintreeOrderStatus {\n    Completed = 'COMPLETED',\n    Pending = 'PENDING',\n    Failed = 'FAILED',\n}\n\nexport interface BraintreeOrderStatusData {\n    status: BraintreeOrderStatus;\n}\n\n/**\n *\n * Braintree US Bank Account (ACH)\n *\n */\nexport type BraintreeUsBankAccountCreator = BraintreeModuleCreator<BraintreeUsBankAccount>;\n\nexport interface BraintreeUsBankAccount {\n    tokenize(\n        options: BraintreeUsBankAccountTokenizationOptions,\n    ): Promise<BraintreeUsBankAccountTokenizationResponse>;\n}\n\nexport interface BraintreeUsBankAccountTokenizationOptions {\n    bankDetails: BraintreeUsBankAccountDetails;\n    mandateText: string;\n}\n\nexport interface BraintreeUsBankAccountTokenizationResponse {\n    nonce: string;\n    details: BraintreeTokenizationDetails;\n}\n\nexport interface BraintreeUsBankAccountDetails {\n    accountNumber: string;\n    routingNumber: string;\n    ownershipType: string;\n    accountType: string;\n    firstName?: string;\n    lastName?: string;\n    businessName?: string;\n    billingAddress: {\n        streetAddress: string;\n        extendedAddress: string;\n        locality: string;\n        region: string;\n        postalCode: string;\n    };\n}\n\n// TODO: move this interface in separate types group if it will be used in another (not ACH) strategies\n// This seems to be an interface which will be used in different places\nexport interface BraintreeTokenizationDetails {\n    username?: string;\n    email?: string;\n    payerId?: string;\n    firstName?: string;\n    lastName?: string;\n    countryCode?: string;\n    phone?: string;\n    shippingAddress?: BraintreeShippingAddress;\n    billingAddress?: BraintreeAddress;\n}\n\nexport interface BraintreeAddress {\n    line1: string;\n    line2: string;\n    city: string;\n    state: string;\n    postalCode: string;\n    countryCode: string;\n}\n\nexport interface BraintreeShippingAddress extends BraintreeAddress {\n    recipientName: string;\n}\n\n/**\n *\n * Braintree non-instant payment methods\n *\n */\nexport enum NonInstantLocalPaymentMethods {\n    TRUSTLY = 'trustly',\n}\n\nexport interface BraintreeLocalPaymentMethodRedirectAction {\n    body: {\n        additional_action_required: {\n            type: 'offsite_redirect';\n            data: {\n                redirect_url: string;\n            };\n        };\n    };\n}\n\nexport interface BraintreeOrderSavedResponse {\n    body: {\n        additional_action_required: {\n            data: {\n                order_id_saved_successfully: string;\n            };\n        };\n    };\n}\n\n/**\n *\n * Braintree Fastlane\n *\n */\nexport type BraintreeFastlaneCreator = BraintreeModuleCreator<\n    BraintreeFastlane,\n    BraintreeFastlaneConfig\n>;\n\nexport interface BraintreeFastlaneConfig {\n    authorization: string;\n    client: BraintreeClient;\n    deviceData?: string;\n    styles?: BraintreeFastlaneStylesOption;\n}\n\nexport interface BraintreeFastlane {\n    identity: BraintreeFastlaneIdentity;\n    profile: BraintreeFastlaneProfile;\n    FastlaneCardComponent: (\n        options: BraintreeFastlaneCardComponentOptions,\n    ) => Promise<BraintreeFastlaneCardComponent>;\n    events: BraintreeFastlaneEvents;\n}\n\nexport interface BraintreeFastlaneProfile {\n    showCardSelector(): Promise<BraintreeFastlaneCardSelectorResponse>;\n    showShippingAddressSelector(): Promise<BraintreeFastlaneShippingAddressSelectorResponse>;\n}\n\nexport interface BraintreeFastlaneShippingAddressSelectorResponse {\n    selectionChanged: boolean;\n    selectedAddress: BraintreeFastlaneShippingAddress;\n}\n\nexport interface BraintreeFastlaneShippingAddress {\n    name: BraintreeFastlaneProfileName;\n    phoneNumber: string;\n    id?: string;\n    firstName?: string;\n    lastName?: string;\n    company?: string;\n    streetAddress: string;\n    extendedAddress?: string;\n    locality: string;\n    region: string;\n    postalCode: string;\n    countryCodeNumeric?: number;\n    countryCodeAlpha2: string;\n    countryCodeAlpha3?: string;\n}\n\nexport interface BraintreeFastlaneProfileName {\n    fullName: string;\n    firstName?: string;\n    lastName?: string;\n}\n\nexport interface BraintreeFastlaneCardSelectorResponse {\n    selectionChanged: boolean;\n    selectedCard: BraintreeFastlaneVaultedInstrument;\n}\n\nexport interface BraintreeFastlaneWindow extends Window {\n    braintreeFastlane: BraintreeFastlane;\n}\n\nexport interface BraintreeFastlaneIdentity {\n    lookupCustomerByEmail(email: string): Promise<BraintreeFastlaneLookupCustomerByEmailResult>;\n    triggerAuthenticationFlow(\n        customerId: string,\n        options?: BraintreeFastlaneAuthenticationOptions,\n    ): Promise<BraintreeFastlaneAuthenticationCustomerResult>;\n}\n\nexport interface BraintreeFastlaneLookupCustomerByEmailResult {\n    customerContextId?: string;\n}\n\nexport interface BraintreeFastlaneAuthenticationOptions {\n    styles?: BraintreeFastlaneStylesOption;\n}\n\nexport interface BraintreeFastlaneStylesOption {\n    root?: {\n        backgroundColorPrimary?: string;\n        errorColor?: string;\n        fontFamily?: string;\n        fontSizeBase?: string;\n        padding?: string;\n        primaryColor?: string;\n    };\n    input?: {\n        borderRadius?: string;\n        borderColor?: string;\n        focusBorderColor?: string;\n        backgroundColor?: string;\n        borderWidth?: string;\n        textColorBase?: string;\n    };\n    toggle?: {\n        colorPrimary?: string;\n        colorSecondary?: string;\n    };\n    text?: {\n        body?: {\n            color?: string;\n            fontSize?: string;\n        };\n        caption?: {\n            color?: string;\n            fontSize?: string;\n        };\n    };\n    branding?: string; // 'light' | 'dark'\n}\n\nexport enum BraintreeFastlaneAuthenticationState {\n    SUCCEEDED = 'succeeded',\n    FAILED = 'failed',\n    CANCELED = 'cancelled',\n    UNRECOGNIZED = 'unrecognized',\n}\n\nexport interface BraintreeFastlaneAuthenticationCustomerResult {\n    authenticationState: BraintreeFastlaneAuthenticationState;\n    profileData: BraintreeFastlaneProfileData;\n}\n\nexport interface BraintreeFastlaneProfileData {\n    fastlaneCustomerAuthAssertionToken: string;\n    fastlaneCustomerId: string;\n    shippingAddress: BraintreeFastlaneAddress;\n    card: BraintreeFastlaneVaultedInstrument;\n    name: BraintreeFastlaneName;\n}\n\nexport interface BraintreeFastlaneName {\n    firstName: string;\n    lastName: string;\n}\n\nexport interface BraintreeFastlaneAddress {\n    id?: string;\n    firstName?: string;\n    lastName?: string;\n    company?: string;\n    streetAddress: string;\n    extendedAddress?: string;\n    locality: string;\n    region: string;\n    postalCode: string;\n    countryCodeNumeric?: number;\n    countryCodeAlpha2: string;\n    countryCodeAlpha3?: string;\n    phoneNumber?: string;\n}\n\nexport interface BraintreeFastlaneCardPaymentSource {\n    brand: string;\n    expiry: string;\n    lastDigits: string;\n    name?: string;\n    billingAddress: BraintreeFastlaneAddress;\n    binDetails?: {\n        bin: string;\n    };\n}\n\nexport interface BraintreeFastlanePaymentSource {\n    card: BraintreeFastlaneCardPaymentSource;\n}\n\nexport interface BraintreeFastlaneVaultedInstrument {\n    id: string; // This is the nonce / token\n    paymentSource: BraintreeFastlanePaymentSource;\n}\n\nexport interface BraintreeFastlaneCardComponentOptions {\n    styles: BraintreeFastlaneStylesOption;\n    fields: BraintreeFastlaneCardComponentFields;\n}\n\nexport interface BraintreeFastlaneCardComponentFields {\n    cardholderName?: {\n        enabled?: boolean;\n        prefill?: string;\n    };\n    phoneNumber?: {\n        placeholder?: string;\n        prefill?: string;\n    };\n}\n\nexport interface FastlaneStylesSettings {\n    fastlaneRootSettingsBackgroundColor?: string;\n    fastlaneRootSettingsErrorColor?: string;\n    fastlaneRootSettingsFontFamily?: string;\n    fastlaneRootSettingsPadding?: string;\n    fastlaneRootSettingsPrimaryColor?: string;\n    fastlaneRootSettingsFontSize?: string;\n    fastlaneInputSettingsBackgroundColor?: string;\n    fastlaneInputSettingsBorderRadius?: string;\n    fastlaneInputSettingsBorderWidth?: string;\n    fastlaneInputSettingsBorderColor?: string;\n    fastlaneInputSettingsFocusBorderBase?: string;\n    fastlaneInputSettingsTextColorBase?: string;\n    fastlaneToggleSettingsColorPrimary?: string;\n    fastlaneToggleSettingsColorSecondary?: string;\n    fastlaneTextBodySettingsColor?: string;\n    fastlaneTextBodySettingsFontSize?: string;\n    fastlaneTextCaptionSettingsFontSize?: string;\n    fastlaneTextCaptionSettingsColor?: string;\n    fastlaneBrandingSettings?: string;\n}\n\nexport interface BraintreeFastlaneTokenizeOptions {\n    name?: {\n        fullName: string;\n    };\n    billingAddress?: BraintreeFastlaneAddress;\n    shippingAddress?: BraintreeFastlaneAddress;\n}\n\nexport interface BraintreeFastlaneEvents {\n    apmSelected: (options: BraintreeFastlaneApmSelectedEventOptions) => void;\n    emailSubmitted: (options: BraintreeFastlaneEmailEnteredEventOptions) => void;\n    orderPlaced: (options: BraintreeFastlaneOrderPlacedEventOptions) => void;\n}\n\nexport interface BraintreeFastlaneEventCommonOptions {\n    context_type: 'cs_id';\n    context_id: string; // checkout session id\n    page_type: 'checkout_page';\n    page_name: string; // title of the checkout initiation page\n    partner_name: 'bigc';\n    user_type: 'store_member' | 'store_guest'; // type of the user on the merchant site\n    store_id: string;\n    merchant_name: string;\n    experiment: string; // stringify JSON object \"[{ treatment_group: 'test' | 'control' }]\"\n}\n\nexport interface BraintreeFastlaneApmSelectedEventOptions\n    extends BraintreeFastlaneEventCommonOptions {\n    apm_shown: '0' | '1'; // alternate payment shown on the checkout page\n    apm_list: string; // list of alternate payment shown on checkout page\n    apm_selected: string; // alternate payment method selected / methodId\n    apm_location: 'pre-email section' | 'payment section'; // placement of APM, whether it be above the email entry or in the radio buttons\n}\n\nexport interface BraintreeFastlaneEmailEnteredEventOptions\n    extends BraintreeFastlaneEventCommonOptions {\n    user_email_saved: boolean; // shows whether checkout was loaded with or without a saved email\n    apm_shown: '0' | '1'; // alternate payment shown on the checkout page\n    apm_list: string; // list of alternate payment shown on checkout page 'applepay,googlepay,paypal'\n}\n\nexport interface BraintreeFastlaneOrderPlacedEventOptions\n    extends BraintreeFastlaneEventCommonOptions {\n    selected_payment_method: string;\n    currency_code: string;\n}\n\nexport interface BraintreeFastlaneCardComponent {\n    (options: BraintreeFastlaneCardComponentOptions): BraintreeFastlaneCardComponent;\n    getPaymentToken(\n        options: BraintreeFastlaneTokenizeOptions,\n    ): Promise<BraintreeFastlaneVaultedInstrument>;\n    render(element: string): void;\n}\n\n/**\n *\n * Braintree Payload Verification\n *\n */\nexport interface BraintreeVerifyPayload {\n    nonce: string;\n    details: {\n        cardType: string;\n        lastFour: string;\n        lastTwo: string;\n    };\n    description: string;\n    liabilityShiftPossible: boolean;\n    liabilityShifted: boolean;\n}\n\n/**\n *\n * Braintree Errors\n *\n */\nexport enum BraintreeErrorType {\n    Customer = 'CUSTOMER',\n    Merchant = 'MERCHANT',\n    Network = 'NETWORK',\n    Internal = 'INTERNAL',\n    Unknown = 'UNKNOWN',\n}\n\nexport enum BraintreeErrorCode {\n    KountNotEnabled = 'DATA_COLLECTOR_KOUNT_NOT_ENABLED',\n}\n\nexport interface BraintreeError extends Error {\n    type: BraintreeErrorType;\n    code: string | BraintreeErrorCode.KountNotEnabled;\n    details?: unknown;\n}\n\nexport interface BraintreeRedirectError {\n    body: {\n        additional_action_required: {\n            data: {\n                redirect_url: string;\n            };\n        };\n    };\n}\n\nexport default interface BillingAddress extends Address {\n    id: string;\n    email?: string;\n}\n\nexport enum BraintreeSupportedCardBrands {\n    Visa = 'visa',\n    Mastercard = 'mastercard',\n    AmericanExpress = 'american-express',\n    DinersClub = 'diners-club',\n    Discover = 'discover',\n    Jcb = 'jcb',\n    UnionPay = 'union-pay',\n    Maestro = 'maestro',\n    Elo = 'elo',\n    Mir = 'mir',\n    Hiper = 'hiper',\n    Hipercard = 'hipercard',\n}\n\nexport interface BillingAddressState {\n    data?: BillingAddress;\n    errors: BillingAddressErrorsState;\n    statuses: BillingAddressStatusesState;\n}\n\nexport interface BillingAddressErrorsState {\n    loadError?: Error;\n    updateError?: Error;\n    continueAsGuestError?: Error;\n}\n\nexport interface BillingAddressStatusesState {\n    isLoading?: boolean;\n    isUpdating?: boolean;\n    isContinuingAsGuest?: boolean;\n}\n\nexport interface BraintreeRequestData {\n    data: {\n        creditCard: {\n            billingAddress?: {\n                countryCodeAlpha2: string;\n                locality: string;\n                countryName: string;\n                postalCode: string;\n                streetAddress: string;\n            };\n            cardholderName: string;\n            cvv?: string;\n            expirationDate: string;\n            number: string;\n            options: {\n                validate: boolean;\n            };\n        };\n    };\n    endpoint: string;\n    method: string;\n}\n","import { ScriptLoader } from '@bigcommerce/script-loader';\n\nimport { PaymentMethodClientUnavailableError } from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport { BRAINTREE_SDK_SCRIPTS_INTEGRITY } from './braintree-sdk-scripts-integrity';\nimport BraintreeSDKVersionManager from './braintree-sdk-version-manager';\nimport isManageableBraintreeSDKVersion from './isManageableBraintreeSDKVersion';\nimport {\n    BraintreeClientCreator,\n    BraintreeDataCollectorCreator,\n    BraintreeFastlaneCreator,\n    BraintreeGooglePaymentCreator,\n    BraintreeHostedFieldsCreator,\n    BraintreeHostWindow,\n    BraintreeLocalPaymentCreator,\n    BraintreeModuleCreators,\n    BraintreeModuleName,\n    BraintreePaypalCheckoutCreator,\n    BraintreePaypalCreator,\n    BraintreeThreeDSecureCreator,\n    BraintreeUsBankAccountCreator,\n    BraintreeVenmoCheckoutCreator,\n    BraintreeVisaCheckoutCreator,\n} from './types';\nimport { VisaCheckoutSDK } from './visacheckout';\n\nexport default class BraintreeScriptLoader {\n    constructor(\n        private scriptLoader: ScriptLoader,\n        private braintreeHostWindow: BraintreeHostWindow,\n        private braintreeSDKVersionManager: BraintreeSDKVersionManager,\n    ) {}\n\n    async loadClient(): Promise<BraintreeClientCreator> {\n        return this.loadBraintreeModuleOrThrow<BraintreeClientCreator>(\n            BraintreeModuleName.Client,\n            'client.min.js',\n        );\n    }\n\n    async loadFastlane(): Promise<BraintreeFastlaneCreator> {\n        return this.loadBraintreeModuleOrThrow<BraintreeFastlaneCreator>(\n            BraintreeModuleName.Fastlane,\n            'fastlane.min.js',\n        );\n    }\n\n    async loadPaypalCheckout(): Promise<BraintreePaypalCheckoutCreator> {\n        return this.loadBraintreeModuleOrThrow<BraintreePaypalCheckoutCreator>(\n            BraintreeModuleName.PaypalCheckout,\n            'paypal-checkout.min.js',\n        );\n    }\n\n    async loadPaypal(): Promise<BraintreePaypalCreator> {\n        return this.loadBraintreeModuleOrThrow<BraintreePaypalCreator>(\n            BraintreeModuleName.Paypal,\n            'paypal.min.js',\n        );\n    }\n\n    async loadLocalPayment(): Promise<BraintreeLocalPaymentCreator> {\n        return this.loadBraintreeModuleOrThrow<BraintreeLocalPaymentCreator>(\n            BraintreeModuleName.LocalPayment,\n            'local-payment.min.js',\n        );\n    }\n\n    async loadDataCollector(): Promise<BraintreeDataCollectorCreator> {\n        return this.loadBraintreeModuleOrThrow<BraintreeDataCollectorCreator>(\n            BraintreeModuleName.DataCollector,\n            'data-collector.min.js',\n        );\n    }\n\n    async loadUsBankAccount(): Promise<BraintreeUsBankAccountCreator> {\n        return this.loadBraintreeModuleOrThrow<BraintreeUsBankAccountCreator>(\n            BraintreeModuleName.UsBankAccount,\n            'us-bank-account.min.js',\n        );\n    }\n\n    async loadGooglePayment(): Promise<BraintreeGooglePaymentCreator> {\n        return this.loadBraintreeModuleOrThrow<BraintreeGooglePaymentCreator>(\n            BraintreeModuleName.GooglePayment,\n            'google-payment.min.js',\n        );\n    }\n\n    async load3DS(): Promise<BraintreeThreeDSecureCreator> {\n        return this.loadBraintreeModuleOrThrow<BraintreeThreeDSecureCreator>(\n            BraintreeModuleName.ThreeDSecure,\n            'three-d-secure.min.js',\n        );\n    }\n\n    loadVisaCheckout(): Promise<BraintreeVisaCheckoutCreator> {\n        return this.loadBraintreeModuleOrThrow<BraintreeVisaCheckoutCreator>(\n            BraintreeModuleName.VisaCheckout,\n            'visa-checkout.min.js',\n        );\n    }\n\n    loadVenmoCheckout(): Promise<BraintreeVenmoCheckoutCreator> {\n        return this.loadBraintreeModuleOrThrow<BraintreeVenmoCheckoutCreator>(\n            BraintreeModuleName.Venmo,\n            'venmo.min.js',\n        );\n    }\n\n    async loadHostedFields(): Promise<BraintreeHostedFieldsCreator> {\n        return this.loadBraintreeModuleOrThrow<BraintreeHostedFieldsCreator>(\n            BraintreeModuleName.HostedFields,\n            'hosted-fields.min.js',\n        );\n    }\n\n    async loadVisaCheckoutSdk(testMode?: boolean): Promise<VisaCheckoutSDK> {\n        if (this.braintreeHostWindow.V) {\n            return this.braintreeHostWindow.V;\n        }\n\n        const hash = testMode\n            ? 'sha384-0eu1s1GtqzXlL9DtLgmwzC5WWlEH/ADRM0n38cVQkvtT+W/gey96rcb1LwuUOPDm'\n            : 'sha384-1f1csvP3ZFxg4dILH1GaY4LHlZ0oX7Rk83rxmLlwbnIi4TM0NYzXoev1VoEiVDS6';\n\n        return this.scriptLoader\n            .loadScript(\n                `//${\n                    testMode ? 'sandbox-' : ''\n                }assets.secure.checkout.visa.com/checkout-widget/resources/js/integration/v1/sdk.js`,\n                {\n                    async: true,\n                    attributes: {\n                        integrity: hash,\n                        crossorigin: 'anonymous',\n                    },\n                },\n            )\n            .then(() => {\n                if (!this.braintreeHostWindow.V) {\n                    throw new PaymentMethodClientUnavailableError();\n                }\n\n                return this.braintreeHostWindow.V;\n            });\n    }\n\n    private async loadBraintreeModuleOrThrow<T extends BraintreeModuleCreators>(\n        braintreeModuleName: BraintreeModuleName,\n        fileName: string,\n    ): Promise<T> {\n        let module = this.getBraintreeModule(braintreeModuleName);\n\n        if (module) {\n            // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n            return module as T;\n        }\n\n        const braintreeSdkVersion = this.braintreeSDKVersionManager.getSDKVersion();\n\n        const scriptPath = `//js.braintreegateway.com/web/${braintreeSdkVersion}/js/${fileName}`;\n\n        const integrity = isManageableBraintreeSDKVersion(braintreeSdkVersion)\n            ? this.getIntegrityValuesByModuleName(braintreeModuleName, braintreeSdkVersion)\n            : undefined;\n\n        await this.scriptLoader.loadScript(\n            scriptPath,\n            integrity\n                ? {\n                      async: true,\n                      attributes: {\n                          integrity,\n                          crossorigin: 'anonymous',\n                      },\n                  }\n                : undefined,\n        );\n\n        module = this.getBraintreeModule(braintreeModuleName);\n\n        if (!module) {\n            throw new PaymentMethodClientUnavailableError();\n        }\n\n        // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n        return module as T;\n    }\n\n    private getBraintreeModule(\n        braintreeModuleName: BraintreeModuleName,\n    ): BraintreeModuleCreators | undefined {\n        return this.braintreeHostWindow.braintree?.[braintreeModuleName];\n    }\n\n    private getIntegrityValuesByModuleName(\n        moduleName: BraintreeModuleName,\n        version: keyof typeof BRAINTREE_SDK_SCRIPTS_INTEGRITY,\n    ): string {\n        const integrity = BRAINTREE_SDK_SCRIPTS_INTEGRITY[version][moduleName];\n\n        if (!integrity) {\n            throw new Error('Unexpected fileName value');\n        }\n\n        return integrity;\n    }\n}\n","import { BRAINTREE_SDK_SCRIPTS_INTEGRITY } from './braintree-sdk-scripts-integrity';\n\nfunction isManageableBraintreeSDKVersion(\n    version: string,\n): version is keyof typeof BRAINTREE_SDK_SCRIPTS_INTEGRITY {\n    return version in BRAINTREE_SDK_SCRIPTS_INTEGRITY;\n}\n\nexport default isManageableBraintreeSDKVersion;\n","import { StandardError } from './index';\n\n/**\n * Throw this error if the shopper is using a browser version that is not\n * supported by us or any third party provider we use.\n */\nexport default class UnsupportedBrowserError extends StandardError {\n    constructor(message?: string) {\n        super(message || 'Unsupported browser error');\n\n        this.name = 'UnsupportedBrowserError';\n        this.type = 'unsupported_browser';\n    }\n}\n","import { BraintreeError } from '../types';\n\nexport default function isBraintreeError(error: unknown): error is BraintreeError {\n    return Boolean(\n        typeof error === 'object' &&\n            error !== null &&\n            ('type' in error || 'message' in error || 'code' in error),\n    );\n}\n","import StandardError from './standard-error';\n\nexport enum MissingDataErrorType {\n    MissingBillingAddress,\n    MissingCart,\n    MissingCheckout,\n    MissingConsignments,\n    MissingCustomer,\n    MissingCheckoutConfig,\n    MissingOrder,\n    MissingOrderConfig,\n    MissingOrderId,\n    MissingPayment,\n    MissingPaymentId,\n    MissingPaymentInstrument,\n    MissingPaymentMethod,\n    MissingPaymentRedirectUrl,\n    MissingPaymentStatus,\n    MissingPaymentToken,\n    MissingShippingAddress,\n}\n\n/**\n * Throw this error when data that is expected to exist is missing. Usually it\n * is due to the fact that certain data has not been retrieved from or saved to\n * the server yet. And such data is required to perform certain actions.\n */\nexport default class MissingDataError extends StandardError {\n    constructor(public subtype: MissingDataErrorType) {\n        super(getErrorMessage(subtype));\n\n        this.name = 'MissingDataError';\n        this.type = 'missing_data';\n    }\n}\n\nfunction getErrorMessage(type: MissingDataErrorType): string {\n    switch (type) {\n        case MissingDataErrorType.MissingBillingAddress:\n            return 'Unable to proceed because billing address data is unavailable.';\n\n        case MissingDataErrorType.MissingCart:\n            return 'Unable to proceed because cart data is unavailable.';\n\n        case MissingDataErrorType.MissingConsignments:\n            return 'Unable to proceed because consignments data is unavailable.';\n\n        case MissingDataErrorType.MissingCheckout:\n            return 'Unable to proceed because checkout data is unavailable.';\n\n        case MissingDataErrorType.MissingCustomer:\n            return 'Unable to proceed because customer data is unavailable.';\n\n        case MissingDataErrorType.MissingCheckoutConfig:\n        case MissingDataErrorType.MissingOrderConfig:\n            return 'Unable to proceed because configuration data is unavailable.';\n\n        case MissingDataErrorType.MissingOrder:\n            return 'Unable to proceed because order data is unavailable.';\n\n        case MissingDataErrorType.MissingOrderId:\n            return 'Unable to proceed because order ID is unavailable or not generated yet.';\n\n        case MissingDataErrorType.MissingPayment:\n            return 'Unable to proceed because payment data is unavailable.';\n\n        case MissingDataErrorType.MissingPaymentToken:\n            return 'Unable to proceed because the token required to submit a payment is missing.';\n\n        case MissingDataErrorType.MissingPaymentMethod:\n            return 'Unable to proceed because payment method data is unavailable or not properly configured.';\n\n        case MissingDataErrorType.MissingShippingAddress:\n            return 'Unable to proceed because shipping address data is unavailable.';\n\n        default:\n            return 'Unable to proceed because the required data is unavailable.';\n    }\n}\n","import {\n    NotInitializedError,\n    NotInitializedErrorType,\n    UnsupportedBrowserError,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport BraintreeScriptLoader from './braintree-script-loader';\nimport {\n    BraintreeClient,\n    BraintreeDataCollector,\n    BraintreeDataCollectorCreatorConfig,\n    BraintreeError,\n    BraintreeErrorCode,\n    BraintreeGooglePayment,\n    BraintreeLocalPayment,\n    BraintreeModule,\n    BraintreeThreeDSecure,\n    BraintreeUsBankAccount,\n    BraintreeVenmoCheckout,\n    BraintreeVisaCheckout,\n} from './types';\nimport isBraintreeError from './utils/is-braintree-error';\nimport { VisaCheckoutSDK } from './visacheckout';\n\nexport default class BraintreeSdk {\n    private braintreeVenmo?: BraintreeVenmoCheckout;\n    private braintreeLocalPayment?: BraintreeLocalPayment;\n    private client?: BraintreeClient;\n    private clientToken?: string;\n    private dataCollector?: BraintreeDataCollector;\n    private googlePayment?: BraintreeGooglePayment;\n    private threeDS?: BraintreeThreeDSecure;\n    private visaCheckout?: Promise<BraintreeVisaCheckout>;\n    private visaCheckoutSDK?: VisaCheckoutSDK;\n    private usBankAccount?: BraintreeUsBankAccount;\n\n    constructor(private braintreeScriptLoader: BraintreeScriptLoader) {}\n\n    initialize(clientToken: string): void {\n        this.setClientToken(clientToken);\n    }\n\n    async deinitialize(): Promise<void> {\n        await this.teardownModule(this.dataCollector);\n\n        this.dataCollector = undefined;\n    }\n\n    /**\n     *\n     * Braintree Client\n     * braintree doc: https://braintree.github.io/braintree-web/current/module-braintree-web_client.html\n     *\n     */\n    async getClient(): Promise<BraintreeClient> {\n        if (!this.client) {\n            const clientToken = this.getClientTokenOrThrow();\n            const clientCreator = await this.braintreeScriptLoader.loadClient();\n\n            this.client = await clientCreator.create({ authorization: clientToken });\n        }\n\n        return this.client;\n    }\n\n    /**\n     *\n     * Braintree Data collector\n     * braintree doc: https://braintree.github.io/braintree-web/current/module-braintree-web_data-collector.html\n     *\n     */\n    async getDataCollectorOrThrow(\n        options?: Partial<BraintreeDataCollectorCreatorConfig>,\n    ): Promise<BraintreeDataCollector> {\n        const emptyDataCollector = {\n            deviceData: undefined,\n            teardown: () => Promise.resolve(),\n        };\n\n        if (!this.dataCollector) {\n            try {\n                const client = await this.getClient();\n                const dataCollector = await this.braintreeScriptLoader.loadDataCollector();\n\n                const dataCollectorConfig: BraintreeDataCollectorCreatorConfig = {\n                    client,\n                    kount: true,\n                    ...options,\n                };\n\n                this.dataCollector = await dataCollector.create(dataCollectorConfig);\n            } catch (error) {\n                if (isBraintreeError(error) && error.code === BraintreeErrorCode.KountNotEnabled) {\n                    return emptyDataCollector;\n                }\n\n                throw error;\n            }\n        }\n\n        return this.dataCollector;\n    }\n\n    /**\n     *\n     * Braintree Google Payment\n     * braintree doc: https://braintree.github.io/braintree-web/current/module-braintree-web_google-payment.html\n     *\n     */\n    async getBraintreeGooglePayment(): Promise<BraintreeGooglePayment> {\n        if (!this.googlePayment) {\n            const [client, braintreeGooglePayment] = await Promise.all([\n                this.getClient(),\n                this.braintreeScriptLoader.loadGooglePayment(),\n            ]);\n\n            this.googlePayment = await braintreeGooglePayment.create({ client });\n        }\n\n        return this.googlePayment;\n    }\n\n    /**\n     *\n     * Braintree 3DS\n     * braintree doc: https://braintree.github.io/braintree-web/current/module-braintree-web_three-d-secure.html\n     *\n     */\n    async getBraintreeThreeDS(): Promise<BraintreeThreeDSecure> {\n        if (!this.threeDS) {\n            const [client, threeDSecure] = await Promise.all([\n                this.getClient(),\n                this.braintreeScriptLoader.load3DS(),\n            ]);\n\n            this.threeDS = await threeDSecure.create({ client, version: 2 });\n        }\n\n        return this.threeDS;\n    }\n\n    /**\n     *\n     * Braintree Local Payment Methods\n     * braintree doc: https://braintree.github.io/braintree-web/current/module-braintree-web_local-payment.html\n     *\n     */\n    async getBraintreeLocalPayment(\n        merchantAccountId: string,\n    ): Promise<BraintreeLocalPayment | undefined> {\n        if (!this.braintreeLocalPayment) {\n            const [client, localPaymentCreator] = await Promise.all([\n                this.getClient(),\n                this.braintreeScriptLoader.loadLocalPayment(),\n            ]);\n\n            this.braintreeLocalPayment = await new Promise(\n                (\n                    resolve: (braintreeLocalPayment: BraintreeLocalPayment) => void,\n                    reject: (error: BraintreeError) => void,\n                ) => {\n                    void localPaymentCreator.create(\n                        { client, merchantAccountId },\n                        (\n                            error: BraintreeError | undefined,\n                            braintreeLocalPayment: BraintreeLocalPayment,\n                        ) => {\n                            if (error) {\n                                reject(error);\n                            }\n\n                            resolve(braintreeLocalPayment);\n                        },\n                    );\n                },\n            );\n        }\n\n        return this.braintreeLocalPayment;\n    }\n\n    /**\n     *\n     * Braintree UsBankAccount\n     * braintree doc: https://braintree.github.io/braintree-web/current/module-braintree-web_us-bank-account.html\n     *\n     */\n    async getUsBankAccount() {\n        if (!this.usBankAccount) {\n            const client = await this.getClient();\n            const usBankAccount = await this.braintreeScriptLoader.loadUsBankAccount();\n\n            this.usBankAccount = await usBankAccount.create({ client });\n        }\n\n        return this.usBankAccount;\n    }\n\n    /**\n     *\n     * Braintree Visa Checkout\n     * braintree doc: https://braintree.github.io/braintree-web/current/module-braintree-web_visa-checkout.html\n     *\n     */\n    getBraintreeVisaCheckout() {\n        if (!this.visaCheckout) {\n            this.visaCheckout = Promise.all([\n                this.getClient(),\n                this.braintreeScriptLoader.loadVisaCheckout(),\n            ]).then(([client, paypal]) => paypal.create({ client }));\n        }\n\n        return this.visaCheckout;\n    }\n\n    /**\n     *\n     * Braintree Visa Checkout SDK\n     * visa checkout doc: https://developer.visa.com/capabilities/visa_checkout/docs-how-to\n     *\n     */\n    async getVisaCheckoutSdk(testMode?: boolean) {\n        if (!this.visaCheckoutSDK) {\n            this.visaCheckoutSDK = await this.braintreeScriptLoader.loadVisaCheckoutSdk(testMode);\n        }\n\n        return this.visaCheckoutSDK;\n    }\n\n    /**\n     *\n     * Braintree Venmo Checkout\n     * braintree venmo checkout doc: https://braintree.github.io/braintree-web/current/module-braintree-web_venmo.html\n     *\n     */\n    async getVenmoCheckoutOrThrow() {\n        if (!this.braintreeVenmo) {\n            const client = await this.getClient();\n            const venmoCheckout = await this.braintreeScriptLoader.loadVenmoCheckout();\n\n            const venmoCheckoutConfig = {\n                client,\n                allowDesktop: true,\n                paymentMethodUsage: 'multi_use',\n            };\n\n            const braintreeVenmoCheckout = await venmoCheckout.create(venmoCheckoutConfig);\n\n            if (braintreeVenmoCheckout.isBrowserSupported()) {\n                this.braintreeVenmo = braintreeVenmoCheckout;\n            } else {\n                throw new UnsupportedBrowserError();\n            }\n        }\n\n        return this.braintreeVenmo;\n    }\n\n    /**\n     *\n     * Private methods\n     *\n     */\n    private setClientToken(clientToken: string): void {\n        this.clientToken = clientToken;\n    }\n\n    private getClientTokenOrThrow(): string {\n        if (!this.clientToken) {\n            throw new NotInitializedError(NotInitializedErrorType.PaymentNotInitialized);\n        }\n\n        return this.clientToken;\n    }\n\n    private teardownModule(module?: BraintreeModule): Promise<void> {\n        return module ? module.teardown() : Promise.resolve();\n    }\n}\n","export interface Features {\n    [featureName: string]: boolean | undefined;\n}\n\nexport default function isExperimentEnabled(\n    features: Features,\n    experimentName: string,\n    fallbackValue = true,\n): boolean {\n    return features[experimentName] ?? fallbackValue;\n}\n","import { find } from 'lodash';\n\nimport { PaymentIntegrationService } from '@bigcommerce/checkout-sdk/payment-integration-api';\nimport { isExperimentEnabled } from '@bigcommerce/checkout-sdk/utility';\n\nimport { BraintreeHostWindow } from './braintree';\nimport {\n    BRAINTREE_SDK_DEFAULT_VERSION,\n    BRAINTREE_SDK_HOSTED_FIELDS_FIX_VERSION,\n    BRAINTREE_SDK_STABLE_VERSION,\n} from './braintree-sdk-verison';\n\nexport default class BraintreeSDKVersionManager {\n    private braintreeWindow: BraintreeHostWindow = window;\n\n    constructor(private paymentIntegrationService: PaymentIntegrationService) {}\n\n    getSDKVersion() {\n        const state = this.paymentIntegrationService.getState();\n        const storeConfig = state.getStoreConfig();\n        const features = storeConfig?.checkoutSettings.features || {};\n\n        const preloadedVersion = this.getPreloadedSDKVersion();\n\n        if (preloadedVersion) {\n            return preloadedVersion;\n        }\n\n        if (isExperimentEnabled(features, 'PAYPAL-5809.braintree_hosted_fields_fix_version')) {\n            return BRAINTREE_SDK_HOSTED_FIELDS_FIX_VERSION;\n        }\n\n        if (isExperimentEnabled(features, 'PAYPAL-5636.update_braintree_sdk_version')) {\n            return BRAINTREE_SDK_DEFAULT_VERSION;\n        }\n\n        return BRAINTREE_SDK_STABLE_VERSION;\n    }\n\n    private getPreloadedSDKVersion(): void | string {\n        const braintree = this.braintreeWindow.braintree;\n\n        if (braintree) {\n            const preloadedVersion = find<{ VERSION?: string }>(\n                Object.values(braintree),\n                (module) => !!module.VERSION,\n            );\n\n            return preloadedVersion?.VERSION;\n        }\n    }\n}\n","import ResolvableModule from './resolvable-module';\n\nexport default function toResolvableModule<TModule, TIdentifier>(\n    module: TModule,\n    resolveIds: TIdentifier[],\n): ResolvableModule<TModule, TIdentifier> {\n    return Object.assign(module, { resolveIds });\n}\n","import StandardError from './standard-error';\n\n/**\n * This error should be thrown when a method is unable to proceed because the\n * caller has not provided all the arguments according to their requirements,\n * i.e.: if an argument is missing or it is not the expected data type.\n */\nexport default class InvalidArgumentError extends StandardError {\n    constructor(message?: string) {\n        super(message || 'Invalid arguments have been provided.');\n\n        this.name = 'InvalidArgumentError';\n        this.type = 'invalid_argument';\n    }\n}\n","import InvalidArgumentError from './invalid-argument-error';\n\n/**\n * This error should be thrown when we are unable to submit a payment because\n * the caller has not provided all the required fields, i.e.: if an argument is\n * missing or it is not the expected data type.\n */\nexport default class PaymentArgumentInvalidError extends InvalidArgumentError {\n    constructor(invalidFields?: string[]) {\n        let message = 'Unable to submit payment for the order because the payload is invalid.';\n\n        if (invalidFields) {\n            message = `${message} Make sure the following fields are provided correctly: ${invalidFields.join(\n                ', ',\n            )}.`;\n        }\n\n        super(message);\n\n        this.name = 'PaymentArgumentInvalidError';\n    }\n}\n","import {\n    FormattedPayload,\n    FormattedVaultedInstrument,\n    HostedVaultedInstrument,\n    PaymentInstrumentPayload,\n    VaultedInstrument,\n} from './payment';\n\nexport default function isVaultedInstrument(\n    instrument: PaymentInstrumentPayload,\n): instrument is VaultedInstrument {\n    return Boolean((instrument as VaultedInstrument).instrumentId);\n}\n\nexport function isHostedVaultedInstrument(\n    instrument: PaymentInstrumentPayload,\n): instrument is HostedVaultedInstrument {\n    return (\n        Boolean((instrument as HostedVaultedInstrument).instrumentId) &&\n        !Object.prototype.hasOwnProperty.call(instrument, 'ccNumber') &&\n        !Object.prototype.hasOwnProperty.call(instrument, 'ccCvv')\n    );\n}\n\nexport function isFormattedVaultedInstrument(\n    instrument: PaymentInstrumentPayload,\n): instrument is FormattedPayload<FormattedVaultedInstrument> {\n    const formattedInstrument = (instrument as FormattedPayload<FormattedVaultedInstrument>)\n        .formattedPayload;\n\n    if (!formattedInstrument) {\n        return false;\n    }\n\n    return (\n        typeof formattedInstrument.bigpay_token === 'string' ||\n        Boolean(formattedInstrument.bigpay_token && formattedInstrument.bigpay_token.token)\n    );\n}\n","import StandardError from './standard-error';\n\n/**\n * Throw this error if we are trying to make an order finalization request for a\n * payment method that does not require such procedure.\n */\nexport default class OrderFinalizationNotRequiredError extends StandardError {\n    constructor() {\n        super('The current order does not need to be finalized at this stage.');\n\n        this.name = 'OrderFinalizationNotRequiredError';\n        this.type = 'order_finalization_not_required';\n    }\n}\n","import { HostedInstrument } from './payment';\n\nexport default function isHostedInstrumentLike(\n    instrument: unknown,\n): instrument is HostedInstrument {\n    return (\n        typeof instrument === 'object' &&\n        instrument !== null &&\n        (typeof (instrument as HostedInstrument).shouldSaveInstrument === 'undefined' ||\n            typeof (instrument as HostedInstrument).shouldSaveInstrument === 'boolean') &&\n        (typeof (instrument as HostedInstrument).shouldSetAsDefaultInstrument === 'undefined' ||\n            typeof (instrument as HostedInstrument).shouldSetAsDefaultInstrument === 'boolean')\n    );\n}\n","import StandardError from './standard-error';\n\n/**\n * This error should be thrown when a payment method experiences some kind of\n * failure (i.e.: its client library returns a rejected promise). And there is\n * no other error type that is more specific than this one.\n */\nexport default class PaymentMethodFailedError extends StandardError {\n    constructor(message?: string) {\n        super(\n            message ||\n                'Unable to proceed because the client library of a payment method has thrown an unexpected error.',\n        );\n\n        this.name = 'PaymentMethodFailedError';\n        this.type = 'payment_method_client_invalid';\n    }\n}\n","import {\n    PaymentInstrumentPayload,\n    WithBankAccountInstrument,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nexport default function isUsBankAccountInstrumentLike(\n    instrument?: PaymentInstrumentPayload,\n): instrument is WithBankAccountInstrument {\n    if (!instrument) {\n        return false;\n    }\n\n    return (\n        'accountNumber' in instrument &&\n        'routingNumber' in instrument &&\n        'ownershipType' in instrument &&\n        'accountType' in instrument\n    );\n}\n","import {\n    BraintreeInitializationData,\n    BraintreeSdk,\n    BraintreeUsBankAccount,\n    BraintreeUsBankAccountDetails,\n    isBraintreeError,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    InvalidArgumentError,\n    isHostedInstrumentLike,\n    isVaultedInstrument,\n    MissingDataError,\n    MissingDataErrorType,\n    NotInitializedError,\n    NotInitializedErrorType,\n    OrderFinalizationNotRequiredError,\n    OrderPaymentRequestBody,\n    OrderRequestBody,\n    Payment,\n    PaymentArgumentInvalidError,\n    PaymentInitializeOptions,\n    PaymentIntegrationService,\n    PaymentMethodFailedError,\n    PaymentRequestOptions,\n    PaymentStrategy,\n    WithBankAccountInstrument,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport isUsBankAccountInstrumentLike from '../is-us-bank-account-instrument-like';\n\nimport { WithBraintreeAchPaymentInitializeOptions } from './braintree-ach-initialize-options';\n\nexport default class BraintreeAchPaymentStrategy implements PaymentStrategy {\n    private usBankAccount?: BraintreeUsBankAccount;\n    private getMandateText?: () => string;\n\n    constructor(\n        private paymentIntegrationService: PaymentIntegrationService,\n        private braintreeSdk: BraintreeSdk,\n    ) {}\n\n    async initialize(\n        options: PaymentInitializeOptions & WithBraintreeAchPaymentInitializeOptions,\n    ): Promise<void> {\n        const { methodId, braintreeach } = options || {};\n\n        if (!methodId) {\n            throw new InvalidArgumentError(\n                'Unable to initialize payment because \"options.methodId\" argument is not provided.',\n            );\n        }\n\n        this.getMandateText = braintreeach?.getMandateText;\n\n        await this.paymentIntegrationService.loadPaymentMethod(methodId);\n\n        const state = this.paymentIntegrationService.getState();\n        const paymentMethod = state.getPaymentMethodOrThrow<BraintreeInitializationData>(methodId);\n        const { clientToken, initializationData } = paymentMethod;\n\n        if (!clientToken || !initializationData) {\n            throw new MissingDataError(MissingDataErrorType.MissingPaymentMethod);\n        }\n\n        this.braintreeSdk.initialize(clientToken);\n\n        try {\n            this.usBankAccount = await this.braintreeSdk.getUsBankAccount();\n        } catch (error) {\n            this.handleBraintreeError(error);\n        }\n    }\n\n    async execute(orderRequest: OrderRequestBody, options?: PaymentRequestOptions): Promise<void> {\n        const { payment, ...order } = orderRequest;\n\n        if (!payment) {\n            throw new PaymentArgumentInvalidError(['payment']);\n        }\n\n        const isSubmittingWithVaultingInstrument = isVaultedInstrument(payment.paymentData || {});\n\n        const nonce = isSubmittingWithVaultingInstrument\n            ? await this.tokenizePaymentForVaultedInstrument(payment)\n            : await this.tokenizePayment(payment);\n\n        const submitPaymentPayload = isSubmittingWithVaultingInstrument\n            ? await this.preparePaymentDataForVaultedInstrument(nonce, payment)\n            : await this.preparePaymentData(nonce, payment);\n\n        await this.paymentIntegrationService.submitOrder(order, options);\n        await this.paymentIntegrationService.submitPayment(submitPaymentPayload);\n    }\n\n    finalize(): Promise<void> {\n        return Promise.reject(new OrderFinalizationNotRequiredError());\n    }\n\n    async deinitialize(): Promise<void> {\n        await this.braintreeSdk.deinitialize();\n\n        return Promise.resolve();\n    }\n\n    private async tokenizePayment({ paymentData }: OrderPaymentRequestBody): Promise<string> {\n        const usBankAccount = this.getUsBankAccountOrThrow();\n\n        if (!isUsBankAccountInstrumentLike(paymentData)) {\n            throw new PaymentArgumentInvalidError(['payment.paymentData']);\n        }\n\n        const mandateText = isVaultedInstrument(paymentData)\n            ? 'The data are used for stored instrument verification'\n            : typeof this.getMandateText === 'function' && this.getMandateText();\n\n        if (!mandateText) {\n            throw new InvalidArgumentError(\n                'Unable to proceed because getMandateText is not provided or returned undefined value.',\n            );\n        }\n\n        try {\n            const { nonce } = await usBankAccount.tokenize({\n                bankDetails: this.getBankDetails(paymentData),\n                mandateText,\n            });\n\n            return nonce;\n        } catch (error) {\n            this.handleBraintreeError(error);\n        }\n    }\n\n    private async tokenizePaymentForVaultedInstrument(\n        payment: OrderPaymentRequestBody,\n    ): Promise<string | null> {\n        const { methodId, paymentData = {} } = payment;\n\n        const state = this.paymentIntegrationService.getState();\n        const { config } = state.getPaymentMethodOrThrow(methodId);\n\n        if (!config.isVaultingEnabled) {\n            throw new InvalidArgumentError(\n                'Vaulting is disabled but a vaulted instrument was being used for this transaction',\n            );\n        }\n\n        const shouldVerifyVaultingInstrument = isUsBankAccountInstrumentLike(paymentData);\n\n        return shouldVerifyVaultingInstrument ? this.tokenizePayment(payment) : null;\n    }\n\n    private async preparePaymentData(\n        nonce: string | null,\n        payment: OrderPaymentRequestBody,\n    ): Promise<Payment> {\n        const { methodId, paymentData = {} } = payment;\n\n        if (!isUsBankAccountInstrumentLike(paymentData)) {\n            throw new PaymentArgumentInvalidError(['payment.paymentData']);\n        }\n\n        const { deviceData } = await this.braintreeSdk.getDataCollectorOrThrow();\n        const { shouldSaveInstrument, shouldSetAsDefaultInstrument, routingNumber, accountNumber } =\n            paymentData;\n\n        return {\n            methodId,\n            paymentData: {\n                deviceSessionId: deviceData,\n                shouldSetAsDefaultInstrument,\n                shouldSaveInstrument,\n                formattedPayload: {\n                    tokenized_bank_account: {\n                        issuer: routingNumber,\n                        masked_account_number: accountNumber.substr(-4),\n                        token: nonce,\n                    },\n                },\n            },\n        };\n    }\n\n    private async preparePaymentDataForVaultedInstrument(\n        nonce: string | null,\n        payment: OrderPaymentRequestBody,\n    ): Promise<Payment> {\n        const { methodId, paymentData = {} } = payment;\n\n        if (!isVaultedInstrument(paymentData) || !isHostedInstrumentLike(paymentData)) {\n            throw new PaymentArgumentInvalidError(['payment.paymentData']);\n        }\n\n        const { deviceData } = await this.braintreeSdk.getDataCollectorOrThrow();\n        const { instrumentId, shouldSetAsDefaultInstrument } = paymentData;\n\n        return {\n            methodId,\n            paymentData: {\n                deviceSessionId: deviceData,\n                instrumentId,\n                shouldSetAsDefaultInstrument,\n                ...(nonce && { nonce }),\n            },\n        };\n    }\n\n    private getBankDetails(paymentData: WithBankAccountInstrument): BraintreeUsBankAccountDetails {\n        const state = this.paymentIntegrationService.getState();\n        const billingAddress = state.getBillingAddressOrThrow();\n\n        const ownershipType = paymentData.ownershipType.toLowerCase();\n        const accountType = paymentData.accountType.toLowerCase();\n\n        return {\n            accountNumber: paymentData.accountNumber,\n            routingNumber: paymentData.routingNumber,\n            ownershipType,\n            ...(ownershipType === 'personal'\n                ? {\n                      firstName: paymentData.firstName,\n                      lastName: paymentData.lastName,\n                  }\n                : {\n                      businessName: paymentData.businessName,\n                  }),\n            accountType,\n            billingAddress: {\n                streetAddress: billingAddress.address1,\n                extendedAddress: billingAddress.address2,\n                locality: billingAddress.city,\n                region: billingAddress.stateOrProvinceCode,\n                postalCode: billingAddress.postalCode,\n            },\n        };\n    }\n\n    private getUsBankAccountOrThrow(): BraintreeUsBankAccount {\n        if (!this.usBankAccount) {\n            throw new NotInitializedError(NotInitializedErrorType.PaymentNotInitialized);\n        }\n\n        return this.usBankAccount;\n    }\n\n    private handleBraintreeError(error: unknown): never {\n        if (!isBraintreeError(error)) {\n            throw error;\n        }\n\n        throw new PaymentMethodFailedError(error.message);\n    }\n}\n","import { createBraintreeSdk } from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    PaymentStrategyFactory,\n    toResolvableModule,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport BraintreeAchPaymentStrategy from './braintree-ach-payment-strategy';\n\nconst createBraintreeAchPaymentStrategy: PaymentStrategyFactory<BraintreeAchPaymentStrategy> = (\n    paymentIntegrationService,\n) => {\n    return new BraintreeAchPaymentStrategy(\n        paymentIntegrationService,\n        createBraintreeSdk(paymentIntegrationService),\n    );\n};\n\nexport default toResolvableModule(createBraintreeAchPaymentStrategy, [{ id: 'braintreeach' }]);\n","import { getScriptLoader } from '@bigcommerce/script-loader';\n\nimport { PaymentIntegrationService } from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport BraintreeScriptLoader from './braintree-script-loader';\nimport BraintreeSdk from './braintree-sdk';\nimport BraintreeSDKVersionManager from './braintree-sdk-version-manager';\n\nconst createBraintreeSdk = (paymentIntegrationService: PaymentIntegrationService) => {\n    const braintreeSDKVersionManager = new BraintreeSDKVersionManager(paymentIntegrationService);\n    const braintreeScriptLoader = new BraintreeScriptLoader(\n        getScriptLoader(),\n        window,\n        braintreeSDKVersionManager,\n    );\n\n    return new BraintreeSdk(braintreeScriptLoader);\n};\n\nexport default createBraintreeSdk;\n","import StandardError from './standard-error';\n\nexport interface PaymentInvalidFormErrorDetails {\n    [key: string]: Array<{ message: string; type: string }>;\n}\n\nexport default class PaymentInvalidFormError extends StandardError {\n    constructor(public details: PaymentInvalidFormErrorDetails, message?: string) {\n        super(message || 'Unable to proceed because the payment form contains invalid data.');\n\n        this.name = 'PaymentInvalidFormError';\n        this.type = 'payment_invalid_form';\n    }\n}\n","import StandardError from './standard-error';\n\n/**\n * This error should be thrown when the payment flow is cancelled. It could be\n * due to a deliberate user interaction, i.e.: the user clicks on a cancel\n * button which dismisses the payment modal.\n */\nexport default class PaymentMethodCancelledError extends StandardError {\n    constructor(message?: string) {\n        super(message || 'Payment process was cancelled.');\n\n        this.name = 'PaymentMethodCancelledError';\n        this.type = 'payment_cancelled';\n    }\n}\n","export default class CancellablePromise<T> {\n    promise: Promise<T>;\n    cancel!: (reason?: any) => void;\n\n    constructor(promise: Promise<T>) {\n        const cancellable = new Promise<T>((_, reject) => {\n            this.cancel = reject;\n        });\n\n        this.promise = Promise.race([promise, cancellable]);\n    }\n}\n","// the PayPal side of things uses uppercase keys instead of camel case\n\n/**\n *\n * PayPal constants\n *\n */\nexport const PAYPAL_COMPONENTS = ['buttons', 'messages'];\n\nexport enum PaypalButtonStyleLayoutOption {\n    HORIZONTAL = 'horizontal',\n    VERTICAL = 'vertical',\n}\n\nexport enum PaypalButtonStyleSizeOption {\n    SMALL = 'small',\n    MEDIUM = 'medium',\n    LARGE = 'large',\n    RESPONSIVE = 'responsive',\n}\n\nexport enum PaypalButtonStyleColorOption {\n    GOLD = 'gold',\n    BLUE = 'blue',\n    SIlVER = 'silver',\n    BLACK = 'black',\n    WHITE = 'white',\n}\n\nexport enum PaypalButtonStyleLabelOption {\n    CHECKOUT = 'checkout',\n    PAY = 'pay',\n    BUYNOW = 'buynow',\n    PAYPAL = 'paypal',\n    CREDIT = 'credit',\n}\n\nexport enum PaypalButtonStyleShapeOption {\n    PILL = 'pill',\n    RECT = 'rect',\n}\n\n/**\n *\n * PayPal interfaces\n *\n */\nexport interface PaypalSDK {\n    Button: PaypalButton;\n    checkout: PaypalExpressCheckout;\n    FUNDING: PaypalFundingTypeList;\n    Buttons(options: PaypalButtonOptions): PaypalButtonRender;\n    Messages(options: MessagingOptions): MessagingRender;\n}\n\nexport interface PaypalButton {\n    render(options: PaypalButtonOptions, container: string): void;\n}\n\nexport interface PaypalExpressCheckout {\n    initXO(): void;\n    startFlow(url: string): void;\n    closeFlow(): void;\n    setup(merchantId: string, options: PaypalExpressCheckoutOptions): void;\n}\n\nexport interface PaypalExpressCheckoutOptions {\n    button: string;\n    environment: string;\n}\n\nexport interface MessagingOptions {\n    amount: number;\n    buyerCountry?: string;\n    placement: string;\n    style?: MessagesStyleOptions;\n}\n\nexport interface MessagesStyleOptions {\n    color?: string; // 'blue' | 'black' | 'white' | 'white-no-border' | 'gray' | 'monochrome' | 'grayscale'\n    layout?: string; // 'text' | 'flex'\n    logo?: {\n        type?: string; // 'primary' | 'alternative' | 'inline' | 'none'\n        position?: string; // 'left' | 'right' | 'top'\n    };\n    ratio?: string; // '1x1' | '1x4' | '8x1' | '20x1'\n    text?: {\n        align?: string; // 'left' | 'right' | 'center'\n        color?: string; // 'black' | 'white' | 'monochrome' | 'grayscale'\n        size?: number; // from 10 to 16\n    };\n}\n\nexport enum MessagingPlacements {\n    CART = 'cart',\n    HOME = 'homepage',\n    PAYMENT = 'payment',\n    PRODUCT = 'product',\n}\n\nexport interface MessagingRender {\n    render(container: string): void;\n}\n\nexport interface PaypalButtonOptions {\n    env?: string;\n    commit?: boolean;\n    style?: PaypalStyleOptions;\n    funding?: PaypalFundingType;\n    fundingSource?: string;\n    client?: PaypalClientToken;\n    payment?(data?: PaypalAuthorizeData, actions?: PaypalActions): Promise<unknown>;\n    onAuthorize?(data: PaypalAuthorizeData, actions?: PaypalActions): Promise<unknown>;\n    createOrder?(data?: PaypalAuthorizeData, actions?: PaypalActions): Promise<unknown>;\n    onApprove?(data?: PaypalAuthorizeData, actions?: PaypalActions): Promise<unknown>;\n    onClick?(): void;\n    onCancel?(): void;\n    onError?(error: Error): void;\n}\n\nexport interface PaypalStyleOptions {\n    layout?: PaypalButtonStyleLayoutOption;\n    size?: PaypalButtonStyleSizeOption;\n    color?: PaypalButtonStyleColorOption;\n    label?: PaypalButtonStyleLabelOption;\n    shape?: PaypalButtonStyleShapeOption;\n    tagline?: boolean;\n    fundingicons?: boolean;\n    height?: number | string;\n}\n\nexport interface PaypalClientToken {\n    production?: string;\n    sandbox?: string;\n}\n\nexport interface PaypalFundingType {\n    allowed?: string[];\n    disallowed?: string[];\n}\n\nexport interface PaypalActions {\n    payment: PaypalPaymentActions;\n    request: PaypalRequestActions;\n}\n\nexport interface PaypalButtonRender {\n    render(container: string): void;\n    isEligible(): boolean;\n    close(): void;\n}\n\nexport interface PaypalAuthorizeData {\n    payerId: string;\n    paymentId?: string;\n    billingToken?: string;\n    payerID?: string;\n    paymentID?: string;\n}\n\nexport interface PaypalFundingTypeList {\n    CARD?: string;\n    CREDIT?: string;\n    PAYPAL?: string;\n    PAYLATER?: string;\n}\n\nexport interface PaypalPaymentActions {\n    get(id: string): Promise<unknown>;\n}\n\nexport interface PaypalRequestActions {\n    post(url: string, payload?: object, options?: object): Promise<{ id: string }>;\n}\n","import { supportsPopups } from '@braintree/browser-detection';\n\nimport {\n    Address,\n    CancellablePromise,\n    CreditCardInstrument,\n    LegacyAddress,\n    NonceInstrument,\n    NotInitializedError,\n    NotInitializedErrorType,\n    Payment,\n    PaymentArgumentInvalidError,\n    PaymentInvalidFormError,\n    PaymentInvalidFormErrorDetails,\n    PaymentMethodCancelledError,\n    UnsupportedBrowserError,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\nimport { Overlay } from '@bigcommerce/checkout-sdk/ui';\n\nimport BraintreeScriptLoader from './braintree-script-loader';\nimport {\n    BraintreeClient,\n    BraintreeDataCollector,\n    BraintreeDataCollectorCreatorConfig,\n    BraintreeDataCollectors,\n    BraintreeEnv,\n    BraintreeError,\n    BraintreeFastlane,\n    BraintreeFastlaneStylesOption,\n    BraintreeHostWindow,\n    BraintreeModule,\n    BraintreePaypal,\n    BraintreePaypalCheckout,\n    BraintreePaypalSdkCreatorConfig,\n    BraintreeRequestData,\n    BraintreeShippingAddressOverride,\n    BraintreeThreeDSecure,\n    BraintreeThreeDSecureOptions,\n    BraintreeTokenizationDetails,\n    BraintreeTokenizePayload,\n    BraintreeVenmoCheckout,\n    BraintreeVenmoCreatorConfig,\n    BraintreeVerifyPayload,\n    PAYPAL_COMPONENTS,\n    TokenizationPayload,\n} from './types';\nimport isBraintreeError from './utils/is-braintree-error';\nimport { isEmpty } from 'lodash';\nimport isCreditCardInstrumentLike from './utils/is-credit-card-instrument-like';\n\nexport interface PaypalConfig {\n    amount: number;\n    currency: string;\n    locale: string;\n    offerCredit?: boolean;\n    shippingAddressEditable?: boolean;\n    shippingAddressOverride?: BraintreeShippingAddressOverride;\n    shouldSaveInstrument?: boolean;\n}\n\n// Info: this class is deprecated and will be removed in a nearest future. Please, do not add anything here.\nexport default class BraintreeIntegrationService {\n    private client?: Promise<BraintreeClient>;\n    private clientToken?: string;\n    private dataCollectors: BraintreeDataCollectors = {};\n    private paypalCheckout?: BraintreePaypalCheckout;\n    private braintreePaypal?: Promise<BraintreePaypal>;\n    private threeDSecureOptions?: BraintreeThreeDSecureOptions;\n    private threeDS?: Promise<BraintreeThreeDSecure>;\n    private venmoCheckout?: BraintreeVenmoCheckout;\n\n    constructor(\n        private braintreeScriptLoader: BraintreeScriptLoader,\n        private braintreeHostWindow: BraintreeHostWindow,\n        private overlay?: Overlay,\n    ) {}\n\n    initialize(clientToken: string, threeDSecureOptions?: BraintreeThreeDSecureOptions) {\n        this.clientToken = clientToken;\n        this.threeDSecureOptions = threeDSecureOptions;\n    }\n\n    async getBraintreeFastlane(\n        cardId?: string,\n        isTestModeEnabled?: boolean,\n        styles?: BraintreeFastlaneStylesOption,\n    ): Promise<BraintreeFastlane> {\n        if (isTestModeEnabled) {\n            window.localStorage.setItem('axoEnv', 'sandbox');\n            window.localStorage.setItem('fastlaneEnv', 'sandbox');\n        }\n\n        if (!this.braintreeHostWindow.braintreeFastlane) {\n            const clientToken = this.getClientTokenOrThrow();\n            const client = await this.getClient();\n            const deviceData = await this.getSessionId(cardId);\n\n            const braintreeFastlaneCreator = await this.braintreeScriptLoader.loadFastlane();\n\n            const defaultStyles = {\n                root: {\n                    backgroundColorPrimary: 'transparent',\n                },\n            };\n\n            this.braintreeHostWindow.braintreeFastlane = await braintreeFastlaneCreator.create({\n                authorization: clientToken,\n                client,\n                deviceData,\n                styles: styles || defaultStyles,\n            });\n        }\n\n        return this.braintreeHostWindow.braintreeFastlane;\n    }\n\n    // Info: This method is deprecated. Use getClient method from BraintreeSdk class instead\n    async getClient(): Promise<BraintreeClient> {\n        if (!this.client) {\n            const clientToken = this.getClientTokenOrThrow();\n            const clientCreator = await this.braintreeScriptLoader.loadClient();\n\n            this.client = clientCreator.create({ authorization: clientToken });\n        }\n\n        return this.client;\n    }\n\n    getPaypal(): Promise<BraintreePaypal> {\n        if (!this.braintreePaypal) {\n            this.braintreePaypal = Promise.all([\n                this.getClient(),\n                this.braintreeScriptLoader.loadPaypal(),\n            ]).then(([client, paypal]) => paypal.create({ client }));\n        }\n\n        return this.braintreePaypal;\n    }\n\n    paypal({ shouldSaveInstrument, ...config }: PaypalConfig): Promise<BraintreeTokenizePayload> {\n        const newWindowFlow = supportsPopups();\n\n        return this.getPaypal()\n            .then((paypal) => {\n                if (newWindowFlow) {\n                    this.overlay?.show({\n                        onClick: () => paypal.focusWindow(),\n                    });\n                }\n\n                return paypal.tokenize({\n                    enableShippingAddress: true,\n                    flow: shouldSaveInstrument ? 'vault' : 'checkout',\n                    useraction: 'commit',\n                    ...config,\n                });\n            })\n            .then((response) => {\n                this.overlay?.remove();\n\n                return response;\n            })\n            .catch((error) => {\n                this.overlay?.remove();\n\n                throw error;\n            });\n    }\n\n    async getPaypalCheckout(\n        config: Partial<BraintreePaypalSdkCreatorConfig>,\n        onSuccess: (instance: BraintreePaypalCheckout) => void,\n        onError: (error: BraintreeError) => void,\n    ): Promise<BraintreePaypalCheckout> {\n        const client = await this.getClient();\n        const paypalCheckout = await this.braintreeScriptLoader.loadPaypalCheckout();\n\n        const paypalCheckoutConfig = { client };\n        const paypalCheckoutCallback = (\n            error: BraintreeError | undefined,\n            braintreePaypalCheckout: BraintreePaypalCheckout,\n        ) => {\n            if (error) {\n                return onError(error);\n            }\n\n            const paypalSdkLoadCallback = () => onSuccess(braintreePaypalCheckout);\n            const paypalSdkLoadConfig = {\n                currency: config.currency,\n                ...(config.isCreditEnabled && { 'enable-funding': 'paylater' }),\n                components: PAYPAL_COMPONENTS.toString(),\n                intent: config.intent,\n                commit: config.commit ?? true,\n            };\n\n            if (!this.braintreeHostWindow.paypal) {\n                braintreePaypalCheckout.loadPayPalSDK(paypalSdkLoadConfig, paypalSdkLoadCallback);\n            } else {\n                onSuccess(braintreePaypalCheckout);\n            }\n        };\n\n        this.paypalCheckout = await paypalCheckout.create(\n            paypalCheckoutConfig,\n            paypalCheckoutCallback,\n        );\n\n        return this.paypalCheckout;\n    }\n\n    async getDataCollector(\n        options?: Partial<BraintreeDataCollectorCreatorConfig>,\n    ): Promise<BraintreeDataCollector> {\n        const cacheKey: keyof BraintreeDataCollectors = options?.paypal ? 'paypal' : 'default';\n\n        let cached = this.dataCollectors[cacheKey];\n\n        if (!cached) {\n            try {\n                const client = await this.getClient();\n                const dataCollector = await this.braintreeScriptLoader.loadDataCollector();\n\n                const dataCollectorConfig: BraintreeDataCollectorCreatorConfig = {\n                    client,\n                    kount: true,\n                    ...options,\n                };\n\n                cached = await dataCollector.create(dataCollectorConfig);\n            } catch (error) {\n                if (isBraintreeError(error) && error.code === 'DATA_COLLECTOR_KOUNT_NOT_ENABLED') {\n                    cached = {\n                        deviceData: undefined,\n                        teardown: () => Promise.resolve(),\n                    };\n                } else {\n                    throw error;\n                }\n            }\n\n            this.dataCollectors[cacheKey] = cached;\n        }\n\n        return cached;\n    }\n\n    getBraintreeEnv(isTestMode = false): BraintreeEnv {\n        return isTestMode ? BraintreeEnv.Sandbox : BraintreeEnv.Production;\n    }\n\n    mapToBraintreeShippingAddressOverride(address: Address): BraintreeShippingAddressOverride {\n        return {\n            recipientName: `${address.firstName} ${address.lastName}`,\n            line1: address.address1,\n            line2: address.address2,\n            city: address.city,\n            state: address.stateOrProvinceCode,\n            postalCode: address.postalCode,\n            countryCode: address.countryCode,\n            phone: address.phone,\n        };\n    }\n\n    mapToLegacyShippingAddress(details: BraintreeTokenizationDetails): Partial<LegacyAddress> {\n        const { email, phone, shippingAddress } = details;\n        const recipientName = shippingAddress?.recipientName || '';\n        const [firstName, lastName] = recipientName.split(' ');\n\n        return {\n            email,\n            first_name: firstName || '',\n            last_name: lastName || '',\n            phone_number: phone,\n            address_line_1: shippingAddress?.line1,\n            address_line_2: shippingAddress?.line2,\n            city: shippingAddress?.city,\n            state: shippingAddress?.state,\n            country_code: shippingAddress?.countryCode,\n            postal_code: shippingAddress?.postalCode,\n        };\n    }\n\n    mapToLegacyBillingAddress(details: BraintreeTokenizationDetails): Partial<LegacyAddress> {\n        const { billingAddress, email, firstName, lastName, phone, shippingAddress } = details;\n\n        const address = billingAddress || shippingAddress;\n\n        return {\n            email,\n            first_name: firstName,\n            last_name: lastName,\n            phone_number: phone,\n            address_line_1: address?.line1,\n            address_line_2: address?.line2,\n            city: address?.city,\n            state: address?.state,\n            country_code: address?.countryCode,\n            postal_code: address?.postalCode,\n        };\n    }\n\n    removeElement(elementId?: string): void {\n        const element = elementId && document.getElementById(elementId);\n\n        if (element) {\n            element.remove();\n        }\n    }\n\n    async getSessionId(cartId?: string): Promise<string | undefined> {\n        const { deviceData } = await this.getDataCollector({\n            riskCorrelationId: cartId,\n        });\n\n        return deviceData;\n    }\n\n    async teardown(): Promise<void> {\n        await this.teardownModule(this.dataCollectors.default);\n        await this.teardownModule(this.dataCollectors.paypal);\n        this.dataCollectors = {};\n\n        await this.teardownModule(this.paypalCheckout);\n        this.paypalCheckout = undefined;\n\n        // await this.teardownModule(this._venmoCheckout);\n        // this._venmoCheckout = undefined;\n\n        // await this.teardownModule(this._visaCheckout);\n        // this._visaCheckout = undefined;\n    }\n\n    async get3DS(): Promise<BraintreeThreeDSecure> {\n        if (!this.threeDS) {\n            this.threeDS = Promise.all([\n                this.getClient(),\n                this.braintreeScriptLoader.load3DS(),\n            ]).then(([client, threeDSecure]) => threeDSecure.create({ client, version: 2 }));\n        }\n\n        return this.threeDS;\n    }\n\n    async getVenmoCheckout(\n        venmoConfig?: BraintreeVenmoCreatorConfig,\n    ): Promise<BraintreeVenmoCheckout> {\n        if (!this.venmoCheckout) {\n            const client = await this.getClient();\n            const venmoCheckout = await this.braintreeScriptLoader.loadVenmoCheckout();\n\n            const venmoCheckoutConfig = {\n                client,\n                allowDesktop: true,\n                paymentMethodUsage: 'multi_use',\n                ...(venmoConfig || {}),\n            };\n\n            this.venmoCheckout = await new Promise<BraintreeVenmoCheckout>((resolve, reject) => {\n                // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                venmoCheckout.create(\n                    venmoCheckoutConfig,\n                    (error: BraintreeError, braintreeVenmoCheckout: BraintreeVenmoCheckout) => {\n                        // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n                        if (error) {\n                            return reject(error);\n                        }\n\n                        if (!braintreeVenmoCheckout.isBrowserSupported()) {\n                            return reject(new UnsupportedBrowserError());\n                        }\n\n                        resolve(braintreeVenmoCheckout);\n                    },\n                );\n            });\n        }\n\n        return this.venmoCheckout;\n    }\n\n    /*\n       Braintree Credit Card and Braintree Hosted Form\n   */\n    async verifyCard(\n        payment: Payment,\n        billingAddress: Address,\n        amount: number,\n    ): Promise<NonceInstrument> {\n        const tokenizationPayload = await this.tokenizeCard(payment, billingAddress);\n\n        return this.challenge3DSVerification(tokenizationPayload, amount);\n    }\n\n    async tokenizeCard(payment: Payment, billingAddress: Address): Promise<TokenizationPayload> {\n        const { paymentData } = payment;\n\n        if (!isCreditCardInstrumentLike(paymentData)) {\n            throw new PaymentArgumentInvalidError(['payment.paymentData']);\n        }\n\n        const errors = this.getErrorsRequiredFields(paymentData);\n\n        if (!isEmpty(errors)) {\n            throw new PaymentInvalidFormError(errors);\n        }\n\n        const requestData = this.mapToCreditCard(paymentData, billingAddress);\n        const client = await this.getClient();\n        const { creditCards } = await client.request(requestData);\n\n        return {\n            nonce: creditCards[0].nonce,\n            bin: creditCards[0].details.bin,\n        };\n    }\n\n    async challenge3DSVerification(\n        tokenizationPayload: TokenizationPayload,\n        amount: number,\n    ): Promise<BraintreeVerifyPayload> {\n        const threeDSecure = await this.get3DS();\n\n        return this.present3DSChallenge(threeDSecure, amount, tokenizationPayload);\n    }\n\n    private teardownModule(module?: BraintreeModule) {\n        return module ? module.teardown() : Promise.resolve();\n    }\n\n    private getClientTokenOrThrow(): string {\n        if (!this.clientToken) {\n            throw new NotInitializedError(NotInitializedErrorType.PaymentNotInitialized);\n        }\n\n        return this.clientToken;\n    }\n\n    private getErrorsRequiredFields(\n        paymentData: CreditCardInstrument,\n    ): PaymentInvalidFormErrorDetails {\n        const { ccNumber, ccExpiry } = paymentData;\n        const errors: PaymentInvalidFormErrorDetails = {};\n\n        if (!ccNumber) {\n            errors.ccNumber = [\n                {\n                    message: 'Credit card number is required',\n                    type: 'required',\n                },\n            ];\n        }\n\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n        if (!ccExpiry) {\n            errors.ccExpiry = [\n                {\n                    message: 'Expiration date is required',\n                    type: 'required',\n                },\n            ];\n        }\n\n        return errors;\n    }\n\n    private mapToCreditCard(\n        creditCard: CreditCardInstrument,\n        billingAddress?: Address,\n    ): BraintreeRequestData {\n        return {\n            data: {\n                creditCard: {\n                    cardholderName: creditCard.ccName,\n                    number: creditCard.ccNumber,\n                    cvv: creditCard.ccCvv,\n                    expirationDate: `${creditCard.ccExpiry.month}/${creditCard.ccExpiry.year}`,\n                    options: {\n                        validate: false,\n                    },\n                    billingAddress: billingAddress && {\n                        countryCodeAlpha2: billingAddress.countryCode,\n                        locality: billingAddress.city,\n                        countryName: billingAddress.country,\n                        postalCode: billingAddress.postalCode,\n                        streetAddress: billingAddress.address2\n                            ? `${billingAddress.address1} ${billingAddress.address2}`\n                            : billingAddress.address1,\n                    },\n                },\n            },\n            endpoint: 'payment_methods/credit_cards',\n            method: 'post',\n        };\n    }\n\n    private present3DSChallenge(\n        threeDSecure: BraintreeThreeDSecure,\n        amount: number,\n        tokenizationPayload: TokenizationPayload,\n    ): Promise<BraintreeVerifyPayload> {\n        const { nonce, bin } = tokenizationPayload;\n\n        if (!this.threeDSecureOptions || !nonce) {\n            throw new NotInitializedError(NotInitializedErrorType.PaymentNotInitialized);\n        }\n\n        const {\n            addFrame,\n            removeFrame,\n            challengeRequested = true,\n            additionalInformation,\n        } = this.threeDSecureOptions;\n        const cancelVerifyCard = async () => {\n            const response = await threeDSecure.cancelVerifyCard();\n            // eslint-disable-next-line @typescript-eslint/no-use-before-define\n            verification.cancel(new PaymentMethodCancelledError());\n\n            return response;\n        };\n\n        const roundedAmount = amount.toFixed(2);\n\n        const verification = new CancellablePromise(\n            threeDSecure.verifyCard({\n                addFrame: (error, iframe) => {\n                    if (addFrame) {\n                        addFrame(error, iframe, cancelVerifyCard);\n                    }\n                },\n                amount: Number(roundedAmount),\n                bin,\n                challengeRequested,\n                nonce,\n                removeFrame,\n                onLookupComplete: (_data, next) => {\n                    next();\n                },\n                collectDeviceData: true,\n                additionalInformation,\n            }),\n        );\n\n        return verification.promise;\n    }\n}\n","import { CreditCardInstrument } from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nexport default function isCreditCardInstrumentLike(\n    instrument: unknown,\n): instrument is CreditCardInstrument {\n    if (typeof instrument !== 'object' || instrument === null) {\n        return false;\n    }\n\n    // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n    const creditCardInstrument = instrument as Partial<Record<string, unknown>>;\n\n    return (\n        typeof creditCardInstrument.ccExpiry === 'object' &&\n        creditCardInstrument.ccExpiry !== null &&\n        typeof creditCardInstrument.ccNumber === 'string' &&\n        typeof creditCardInstrument.ccName === 'string'\n    );\n}\n","import { PaymentIntegrationService } from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport {\n    BraintreeHostWindow,\n    BraintreeInitializationData,\n    PayPalBNPLConfigurationItem,\n} from './braintree';\nimport { MessagesStyleOptions, MessagingPlacements } from './paypal';\n\nexport default class BraintreeMessages {\n    private braintreeHostWindow: BraintreeHostWindow = window;\n\n    constructor(private paymentIntegrationService: PaymentIntegrationService) {}\n\n    render(methodId: string, containerId: string, placement: MessagingPlacements): void {\n        const messagingContainer = containerId && document.getElementById(containerId);\n\n        if (this.braintreeHostWindow.paypal && messagingContainer) {\n            const state = this.paymentIntegrationService.getState();\n            const cart = state.getCartOrThrow();\n            const billingAddress = state.getBillingAddressOrThrow();\n            const paymentMethod =\n                state.getPaymentMethodOrThrow<BraintreeInitializationData>(methodId);\n\n            if (!paymentMethod.initializationData) {\n                return;\n            }\n\n            const { paypalBNPLConfiguration = [] } = paymentMethod.initializationData;\n\n            const bannedId = placement === MessagingPlacements.PAYMENT ? 'checkout' : placement;\n            const bannerConfiguration =\n                paypalBNPLConfiguration &&\n                paypalBNPLConfiguration.find(({ id }) => id === bannedId);\n\n            if (!bannerConfiguration || !bannerConfiguration.status) {\n                return;\n            }\n\n            // TODO: remove this code when this data attributes will be removed from banner div container in content service\n            if (placement === MessagingPlacements.CART) {\n                messagingContainer.removeAttribute('data-pp-style-logo-type');\n                messagingContainer.removeAttribute('data-pp-style-logo-position');\n                messagingContainer.removeAttribute('data-pp-style-text-color');\n                messagingContainer.removeAttribute('data-pp-style-text-size');\n            }\n\n            this.braintreeHostWindow.paypal\n                .Messages({\n                    amount: cart.cartAmount,\n                    buyerCountry: billingAddress.countryCode,\n                    placement,\n                    style: this.getPaypalMessagesStylesFromBNPLConfig(bannerConfiguration),\n                })\n                .render(`#${containerId}`);\n        }\n    }\n\n    private getPaypalMessagesStylesFromBNPLConfig({\n        styles,\n    }: PayPalBNPLConfigurationItem): MessagesStyleOptions {\n        const messagesStyles: MessagesStyleOptions = {};\n\n        if (styles.color) {\n            messagesStyles.color = styles.color;\n        }\n\n        if (styles.layout) {\n            messagesStyles.layout = styles.layout;\n        }\n\n        if (styles['logo-type'] || styles['logo-position']) {\n            messagesStyles.logo = {};\n\n            if (styles['logo-type']) {\n                messagesStyles.logo.type = styles['logo-type'];\n            }\n\n            if (styles['logo-position']) {\n                messagesStyles.logo.position = styles['logo-position'];\n            }\n        }\n\n        if (styles.ratio) {\n            messagesStyles.ratio = styles.ratio;\n        }\n\n        if (styles['text-color'] || styles['text-size']) {\n            messagesStyles.text = {};\n\n            if (styles['text-color']) {\n                messagesStyles.text.color = styles['text-color'];\n            }\n\n            if (styles['text-size']) {\n                messagesStyles.text.size = +styles['text-size'];\n            }\n        }\n\n        return messagesStyles;\n    }\n}\n","import getOverlayStyle from './overlay-style';\n\nexport interface OverlayOptions {\n    background?: string;\n    id?: string;\n    transitionDuration?: number;\n    hasCloseButton?: boolean;\n    innerHtml?: HTMLElement | DocumentFragment;\n}\n\nexport interface OverlayShowOptions {\n    onClick?(event: MouseEvent): void;\n    onClickClose?(event: MouseEvent): void;\n}\n\nexport interface Elements {\n    element: HTMLElement;\n    mainElement: HTMLElement;\n    closeElement?: HTMLElement;\n}\n\nexport default class Overlay {\n    private _element: HTMLElement;\n    private _mainElement: HTMLElement;\n    private _closeElement?: HTMLElement;\n    private _unregisterClick?: () => void;\n\n    constructor(options?: OverlayOptions) {\n        const { element, closeElement, mainElement } = this._createElements(options);\n\n        this._element = element;\n        this._closeElement = closeElement;\n        this._mainElement = mainElement;\n    }\n\n    show(options?: OverlayShowOptions): void {\n        if (this._mainElement.parentElement) {\n            return;\n        }\n\n        this._registerClick(options);\n\n        document.body.appendChild(this._mainElement);\n\n        // Fade In\n        setTimeout(() => (this._element.style.opacity = '1'));\n    }\n\n    remove(): void {\n        if (!this._mainElement.parentElement) {\n            return;\n        }\n\n        if (this._unregisterClick) {\n            this._unregisterClick();\n        }\n\n        this._removeAfterTransition();\n\n        setTimeout(() => (this._element.style.opacity = '0'));\n    }\n\n    private _createElements(options?: OverlayOptions): Elements {\n        const element = document.createElement('div');\n        const {\n            background = 'rgba(0, 0, 0, 0.8)',\n            id = 'checkoutOverlay',\n            transitionDuration = 400,\n            hasCloseButton = false,\n            innerHtml = null,\n        } = options || {};\n        let mainElement = element;\n        let closeElement: HTMLElement | undefined;\n        let classLayout: string | undefined;\n        let classClose: string | undefined;\n        let classOverlayText: string | undefined;\n\n        if (id) {\n            element.id = id;\n        }\n\n        if (innerHtml) {\n            const overlayText = document.createElement('div');\n\n            classOverlayText = `${id}--overlayText`;\n            overlayText.className = classOverlayText;\n            overlayText.appendChild(innerHtml);\n\n            element.appendChild(overlayText);\n        }\n\n        if (hasCloseButton) {\n            classClose = `${id}--close`;\n            closeElement = document.createElement('div');\n            closeElement.className = classClose;\n\n            classLayout = `${id}--layout`;\n            mainElement = document.createElement('div');\n            mainElement.className = classLayout;\n\n            mainElement.appendChild(element);\n            mainElement.appendChild(closeElement);\n        }\n\n        mainElement.appendChild(\n            getOverlayStyle({\n                id,\n                background,\n                transitionDuration,\n                classLayout,\n                classOverlayText,\n                classClose,\n            }),\n        );\n\n        return { element, closeElement, mainElement };\n    }\n\n    private _addEventListener(element?: HTMLElement, onClick?: (event: MouseEvent) => void): void {\n        if (!element || !onClick) {\n            return;\n        }\n\n        element.addEventListener('click', onClick);\n    }\n\n    private _removeEventListener(\n        element?: HTMLElement,\n        onClick?: (event: MouseEvent) => void,\n    ): void {\n        if (!element || !onClick) {\n            return;\n        }\n\n        element.removeEventListener('click', onClick);\n    }\n\n    private _registerClick(options?: OverlayShowOptions): void {\n        if (this._unregisterClick) {\n            this._unregisterClick();\n        }\n\n        if (options) {\n            const { onClick, onClickClose } = options;\n\n            this._addEventListener(this._element, onClick);\n            this._addEventListener(this._closeElement, onClickClose);\n\n            this._unregisterClick = () => {\n                this._removeEventListener(this._element, onClick);\n                this._removeEventListener(this._closeElement, onClickClose);\n                this._unregisterClick = undefined;\n            };\n        }\n    }\n\n    private _removeAfterTransition(): void {\n        const handleTransition: (event: Event) => void = (event) => {\n            // NOTE: `event` is not correctly typed in this version of TS\n            // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n            if ((event as TransitionEvent).propertyName !== 'opacity') {\n                return;\n            }\n\n            if (this._mainElement.parentElement) {\n                this._mainElement.remove();\n            }\n\n            this._element.removeEventListener('transitionend', handleTransition);\n        };\n\n        this._element.addEventListener('transitionend', handleTransition);\n    }\n}\n","interface OverlayStyleOptions {\n    background?: string;\n    id?: string;\n    transitionDuration?: number;\n    classLayout?: string;\n    classOverlayText?: string;\n    classClose?: string;\n}\n\nexport default function getOverlayStyle(options: OverlayStyleOptions): HTMLElement {\n    const { id, background, transitionDuration, classLayout, classOverlayText, classClose } =\n        options;\n    const styles = document.createElement('style');\n    const addClassLayout = classLayout ? `, .${classLayout}` : '';\n\n    styles.id = `${id}--styles`;\n    styles.type = 'text/css';\n    styles.innerText = `\n        #${id}${addClassLayout} {\n            display: block;\n            height: 100%;\n            width: 100%;\n            left: 0;\n            top: 0;\n            position: fixed;\n            z-index: 2147483647;\n        }\n        #${id} {\n            transition: opacity ${transitionDuration}ms ease-out;\n            background: ${background};\n            opacity: 0;\n        }\n    `;\n\n    if (classOverlayText) {\n        styles.innerText += `\n             #${id} {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n             }\n             #${id} .${classOverlayText} {\n                color: white;\n                max-width: 330px;\n                font-size: 1.2em;\n                text-align: center;\n             }\n        `;\n    }\n\n    if (classClose) {\n        styles.innerText += `\n            #${id} {\n                opacity: 1;\n            }\n            .${classLayout} .${classClose} {\n                position: fixed;\n                right: 16px;\n                top: 16px;\n                width: 16px;\n                height: 16px;\n                opacity: 0.6;\n                cursor: pointer;\n                z-index: 3147483647;\n            }\n            .${classLayout} .${classClose}::after, .${classLayout} .${classClose}::before {\n                position: absolute;\n                left: 8px;\n                content: '';\n                height: 16px;\n                width: 2px;\n                background-color: #fff;\n            }\n            .${classLayout} .${classClose}::after {\n                transform: rotate(-45deg);\n            }\n            .${classLayout} .${classClose}::before {\n                transform: rotate(45deg);\n            }\n        `;\n    }\n\n    return styles;\n}\n","import {\n    LoadingIndicatorContainerStyles,\n    LoadingIndicatorStyles,\n} from './loading-indicator-styles';\n\nconst DEFAULT_STYLES: LoadingIndicatorStyles = {\n    size: 70,\n    color: '#d9d9d9',\n    backgroundColor: '#ffffff',\n};\n\nexport const DEFAULT_CONTAINER_STYLES = {\n    position: 'fixed',\n    'background-color': 'rgba(0, 0, 0, 0.4)',\n    'z-index': '1000',\n};\n\nconst ROTATION_ANIMATION = 'embedded-checkout-loading-indicator-rotation';\n\ninterface LoadingIndicatorOptions {\n    styles?: LoadingIndicatorStyles;\n    containerStyles?: LoadingIndicatorContainerStyles;\n}\n\nexport default class LoadingIndicator {\n    private container: HTMLElement;\n    private indicator: HTMLElement;\n    private styles: LoadingIndicatorStyles;\n    private containerStyles: LoadingIndicatorContainerStyles;\n\n    constructor(options?: LoadingIndicatorOptions) {\n        this.styles = { ...DEFAULT_STYLES, ...(options && options.styles) };\n        this.containerStyles = { ...(options && options.containerStyles) };\n\n        this.defineAnimation();\n\n        this.container = this.buildContainer();\n        this.indicator = this.buildIndicator();\n\n        this.container.appendChild(this.indicator);\n    }\n\n    show(parentId?: string): void {\n        if (parentId) {\n            const parent = document.getElementById(parentId);\n\n            if (!parent) {\n                throw new Error(\n                    'Unable to attach the loading indicator because the parent ID is not valid.',\n                );\n            }\n\n            parent.appendChild(this.container);\n        }\n\n        this.container.style.visibility = 'visible';\n        this.container.style.opacity = '1';\n    }\n\n    hide(): void {\n        const handleTransitionEnd = () => {\n            this.container.style.visibility = 'hidden';\n\n            this.container.removeEventListener('transitionend', handleTransitionEnd);\n        };\n\n        this.container.addEventListener('transitionend', handleTransitionEnd);\n\n        this.container.style.opacity = '0';\n    }\n\n    private buildContainer(): HTMLElement {\n        const container = document.createElement('div');\n\n        container.style.display = 'block';\n        container.style.bottom = '0';\n        container.style.left = '0';\n        container.style.height = '100%';\n        container.style.width = '100%';\n        container.style.position = 'absolute';\n        container.style.right = '0';\n        container.style.top = '0';\n        container.style.transition = 'all 250ms ease-out';\n        container.style.opacity = '0';\n\n        this.setStyleAttribute(container, this.containerStyles);\n\n        return container;\n    }\n\n    private buildIndicator(): HTMLElement {\n        const indicator = document.createElement('div');\n\n        indicator.style.display = 'block';\n        indicator.style.width = `${this.styles.size}px`;\n        indicator.style.height = `${this.styles.size}px`;\n        indicator.style.borderRadius = `${this.styles.size}px`;\n        indicator.style.border = 'solid 1px';\n        indicator.style.borderColor = `${this.styles.backgroundColor} ${this.styles.backgroundColor} ${this.styles.color} ${this.styles.color}`;\n        indicator.style.margin = '0 auto';\n        indicator.style.position = 'absolute';\n        indicator.style.left = '0';\n        indicator.style.right = '0';\n        indicator.style.top = '50%';\n        indicator.style.transform = 'translateY(-50%) rotate(0deg)';\n        indicator.style.transformStyle = 'preserve-3d';\n        indicator.style.animation = `${ROTATION_ANIMATION} 500ms infinite cubic-bezier(0.69, 0.31, 0.56, 0.83)`;\n\n        return indicator;\n    }\n\n    private setStyleAttribute(element: HTMLElement, attrs: { [key: string]: string }): void {\n        Object.keys(attrs).forEach((k) => {\n            element.style.setProperty(k, attrs[k]);\n        });\n    }\n\n    private defineAnimation(): void {\n        // In order to define CSS animation, we need to insert a stylesheet into the host frame.\n        // We only have to do it once.\n        if (document.getElementById(ROTATION_ANIMATION)) {\n            return;\n        }\n\n        const style = document.createElement('style');\n\n        style.id = ROTATION_ANIMATION;\n\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n        document.head?.appendChild(style);\n\n        if (style.sheet instanceof CSSStyleSheet) {\n            // We need to provide the 2nd parameter for IE11, even though it is\n            // 0 by default for all other browsers.\n            style.sheet.insertRule(\n                `\n                @keyframes ${ROTATION_ANIMATION} {\n                    0% { transform: translateY(-50%) rotate(0deg); }\n                    100% { transform: translateY(-50%) rotate(360deg); }\n                }\n            `,\n                0,\n            );\n        }\n    }\n}\n","export const LOADING_INDICATOR_STYLES = {\n    'background-color': 'rgba(0, 0, 0, 0.4)',\n    'z-index': '1000',\n};\n","import { BraintreeError } from '@bigcommerce/checkout-sdk/braintree-utils';\n\nexport default function isBraintreeError(\n    error: BraintreeError | Error | unknown,\n): error is BraintreeError {\n    return (\n        typeof error === 'object' &&\n        error !== null &&\n        'name' in error &&\n        (error as BraintreeError).name === 'BraintreeError'\n    );\n}\n","import { BraintreeShippingAddressOverride } from '@bigcommerce/checkout-sdk/braintree-utils';\nimport { Address } from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nexport default function mapToBraintreeShippingAddressOverride(\n    address: Address,\n): BraintreeShippingAddressOverride {\n    return {\n        recipientName: `${address.firstName} ${address.lastName}`,\n        line1: address.address1,\n        line2: address.address2,\n        city: address.city,\n        state: address.stateOrProvinceCode,\n        postalCode: address.postalCode,\n        countryCode: address.countryCode,\n        phone: address.phone,\n    };\n}\n","import {\n    BraintreeError,\n    BraintreeHostWindow,\n    BraintreeInitializationData,\n    BraintreeIntegrationService,\n    BraintreeMessages,\n    BraintreePaypalCheckout,\n    BraintreePaypalSdkCreatorConfig,\n    BraintreeTokenizePayload,\n    MessagingPlacements,\n    PaypalAuthorizeData,\n    PaypalButtonRender,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    FormattedPayload,\n    InvalidArgumentError,\n    isHostedInstrumentLike,\n    isHostedVaultedInstrument,\n    isVaultedInstrument,\n    MissingDataError,\n    MissingDataErrorType,\n    NotInitializedError,\n    NotInitializedErrorType,\n    OrderFinalizationNotRequiredError,\n    OrderPaymentRequestBody,\n    OrderRequestBody,\n    Payment,\n    PaymentArgumentInvalidError,\n    PaymentInitializeOptions,\n    PaymentIntegrationService,\n    PaymentMethod,\n    PaymentMethodCancelledError,\n    PaymentMethodFailedError,\n    PaymentRequestOptions,\n    PaymentStrategy,\n    PaypalInstrument,\n    StandardError,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\nimport { LoadingIndicator } from '@bigcommerce/checkout-sdk/ui';\n\nimport isBraintreeError from '../is-braintree-error';\nimport isBraintreePaypalProviderError from '../is-braintree-paypal-provider-error';\nimport mapToBraintreeShippingAddressOverride from '../map-to-braintree-shipping-address-override';\n\nimport {\n    BraintreePaypalPaymentInitializeOptions,\n    WithBraintreePaypalPaymentInitializeOptions,\n} from './braintree-paypal-payment-initialize-options';\n\nexport default class BraintreePaypalPaymentStrategy implements PaymentStrategy {\n    private paymentMethod?: PaymentMethod<BraintreeInitializationData>;\n    private braintreeHostWindow: BraintreeHostWindow = window;\n    private braintree?: BraintreePaypalPaymentInitializeOptions;\n    private braintreeTokenizePayload?: BraintreeTokenizePayload;\n    private paypalButtonRender?: PaypalButtonRender;\n    private loadingIndicatorContainer?: string;\n\n    constructor(\n        private paymentIntegrationService: PaymentIntegrationService,\n        private braintreeIntegrationService: BraintreeIntegrationService,\n        private braintreeMessages: BraintreeMessages,\n        private loadingIndicator: LoadingIndicator,\n    ) {}\n\n    async initialize(\n        options: PaymentInitializeOptions & WithBraintreePaypalPaymentInitializeOptions,\n    ) {\n        const { braintree: braintreeOptions, methodId } = options;\n\n        this.braintree = braintreeOptions;\n\n        if (!this.paymentMethod || !this.paymentMethod.nonce) {\n            this.paymentMethod = this.paymentIntegrationService\n                .getState()\n                .getPaymentMethodOrThrow(methodId);\n        }\n\n        if (this.paymentMethod.clientToken && braintreeOptions?.bannerContainerId) {\n            await this.loadPaypal();\n\n            return this.loadPaypalCheckoutInstance();\n        }\n\n        if (this.paymentMethod.clientToken) {\n            return this.loadPaypal();\n        }\n\n        const state = await this.paymentIntegrationService.loadPaymentMethod(methodId);\n\n        this.paymentMethod = state.getPaymentMethodOrThrow(methodId);\n\n        if (braintreeOptions?.bannerContainerId) {\n            return this.loadPaypalCheckoutInstance();\n        }\n\n        if (!this.paymentMethod.clientToken) {\n            throw new MissingDataError(MissingDataErrorType.MissingPaymentMethod);\n        }\n\n        return this.loadPaypal();\n    }\n\n    async execute(orderRequest: OrderRequestBody, options?: PaymentRequestOptions): Promise<void> {\n        const { payment, ...order } = orderRequest;\n\n        const { onError } = this.braintree || {};\n\n        if (!payment) {\n            throw new PaymentArgumentInvalidError(['payment']);\n        }\n\n        try {\n            const paymentData = await this.preparePaymentData(payment, order.useStoreCredit);\n\n            await this.paymentIntegrationService.submitOrder(order, options);\n            await this.paymentIntegrationService.submitPayment(paymentData);\n        } catch (error) {\n            if (this.isProviderError(error)) {\n                await this.loadPaypal();\n\n                this.paypalButtonRender?.close();\n\n                await this.loadPaypalCheckoutInstance();\n\n                await new Promise((_resolve, reject) => {\n                    if (onError && typeof onError === 'function') {\n                        onError(new Error('INSTRUMENT_DECLINED'));\n                    }\n\n                    reject();\n                });\n            }\n\n            this.handleError(error);\n        }\n    }\n\n    finalize(): Promise<void> {\n        return Promise.reject(new OrderFinalizationNotRequiredError());\n    }\n\n    deinitialize(): Promise<void> {\n        this.braintreeTokenizePayload = undefined;\n\n        this.paypalButtonRender?.close();\n\n        return this.braintreeIntegrationService.teardown();\n    }\n\n    private async preparePaymentData(\n        payment: OrderPaymentRequestBody,\n        useStoreCredit?: boolean,\n    ): Promise<Payment> {\n        const state = this.paymentIntegrationService.getState();\n\n        const grandTotal = state.getOutstandingBalance(useStoreCredit);\n        const config = state.getStoreConfig();\n\n        if (!grandTotal) {\n            throw new MissingDataError(MissingDataErrorType.MissingCheckout);\n        }\n\n        if (!config) {\n            throw new MissingDataError(MissingDataErrorType.MissingCheckoutConfig);\n        }\n\n        if (!this.paymentMethod) {\n            throw new NotInitializedError(NotInitializedErrorType.PaymentNotInitialized);\n        }\n\n        const {\n            currency,\n            storeProfile: { storeLanguage },\n        } = config;\n        const {\n            nonce,\n            config: { isVaultingEnabled },\n        } = this.paymentMethod;\n        const { methodId, paymentData = {} } = payment;\n\n        const token = this.braintreeTokenizePayload?.nonce || nonce;\n\n        if (token) {\n            const state = await this.paymentIntegrationService.loadPaymentMethod(methodId);\n\n            this.paymentMethod = state.getPaymentMethod(methodId);\n\n            return {\n                ...payment,\n                paymentData: this.formattedPayload(token),\n            };\n        }\n\n        if (isVaultedInstrument(paymentData) || isHostedVaultedInstrument(paymentData)) {\n            if (!isVaultingEnabled) {\n                throw new InvalidArgumentError(\n                    'Vaulting is disabled but a vaulted instrument was being used for this transaction',\n                );\n            }\n\n            return Promise.resolve(payment);\n        }\n\n        if (!isHostedInstrumentLike(paymentData)) {\n            throw new MissingDataError(MissingDataErrorType.MissingPayment);\n        }\n\n        const { shouldSaveInstrument, shouldSetAsDefaultInstrument } = paymentData;\n\n        if (shouldSaveInstrument && !isVaultingEnabled) {\n            throw new InvalidArgumentError(\n                'Vaulting is disabled but shouldSaveInstrument is set to true',\n            );\n        }\n\n        const shippingAddress = state.getShippingAddress();\n\n        const shippingAddressOverride = shippingAddress\n            ? mapToBraintreeShippingAddressOverride(shippingAddress)\n            : undefined;\n\n        return Promise.all([\n            this.braintreeIntegrationService.paypal({\n                amount: grandTotal,\n                locale: storeLanguage,\n                currency: currency.code,\n                offerCredit: this.paymentMethod.id === 'braintreepaypalcredit',\n                shippingAddressOverride,\n                shouldSaveInstrument: shouldSaveInstrument || false,\n                shippingAddressEditable: false,\n            }),\n            this.braintreeIntegrationService.getSessionId(),\n        ]).then(([{ nonce, details } = {} as any, sessionId]) => ({\n            ...payment,\n            paymentData: this.formattedPayload(\n                nonce,\n                details && details.email,\n                sessionId,\n                shouldSaveInstrument,\n                shouldSetAsDefaultInstrument,\n            ),\n        }));\n    }\n\n    private formattedPayload(\n        token: string,\n        email?: string,\n        sessionId?: string,\n        vaultPaymentInstrument?: boolean,\n        shouldSetAsDefaultInstrument?: boolean,\n    ): FormattedPayload<PaypalInstrument> {\n        return {\n            formattedPayload: {\n                vault_payment_instrument: vaultPaymentInstrument || null,\n                set_as_default_stored_instrument: shouldSetAsDefaultInstrument || null,\n                device_info: sessionId || null,\n                paypal_account: {\n                    token,\n                    email: email || null,\n                },\n            },\n        };\n    }\n\n    private async loadPaypalCheckoutInstance() {\n        const { clientToken, initializationData, id: paymentMethodId } = this.paymentMethod || {};\n\n        if (!clientToken) {\n            throw new MissingDataError(MissingDataErrorType.MissingPaymentMethod);\n        }\n\n        try {\n            this.braintreeIntegrationService.initialize(clientToken);\n\n            const currencyCode = this.paymentIntegrationService.getState().getCartOrThrow()\n                .currency.code;\n\n            const paypalCheckoutConfig: Partial<BraintreePaypalSdkCreatorConfig> = {\n                currency: currencyCode,\n                intent: initializationData?.intent,\n                isCreditEnabled: initializationData?.isCreditEnabled,\n            };\n\n            const isBraintreePaypalCredit = paymentMethodId === 'braintreepaypalcredit';\n            const shouldShowPayPalCreditBanner =\n                isBraintreePaypalCredit || !initializationData?.isCreditEnabled;\n\n            await this.braintreeIntegrationService.getPaypalCheckout(\n                paypalCheckoutConfig,\n                (braintreePaypalCheckout) => {\n                    if (\n                        shouldShowPayPalCreditBanner &&\n                        paymentMethodId &&\n                        this.braintree?.bannerContainerId\n                    ) {\n                        this.renderPayPalMessages(\n                            paymentMethodId,\n                            this.braintree.bannerContainerId,\n                        );\n                    }\n\n                    this.renderPayPalButton(braintreePaypalCheckout);\n                },\n                this.handleError,\n            );\n        } catch (error) {\n            this.handleError(error);\n        }\n    }\n\n    private renderPayPalMessages(methodId: string, containerId: string) {\n        this.braintreeMessages.render(methodId, containerId, MessagingPlacements.PAYMENT);\n    }\n\n    private renderPayPalButton(braintreePaypalCheckout: BraintreePaypalCheckout) {\n        const { onPaymentError, submitForm, onRenderButton, containerId, onError } =\n            this.braintree || {};\n\n        if (!containerId) {\n            return;\n        }\n\n        if (!this.paymentMethod) {\n            throw new NotInitializedError(NotInitializedErrorType.PaymentNotInitialized);\n        }\n\n        this.loadingIndicatorContainer = containerId.split('#')[1];\n\n        const {\n            id,\n            config: { testMode },\n        } = this.paymentMethod;\n\n        const { paypal } = this.braintreeHostWindow;\n        const fundingSource = paypal?.FUNDING.PAYPAL;\n\n        if (paypal && fundingSource) {\n            this.paypalButtonRender = paypal.Buttons({\n                env: testMode ? 'sandbox' : 'production',\n                commit: false,\n                fundingSource,\n                onClick: () => {\n                    this.toggleLoadingIndicator(true);\n                },\n                createOrder: () => this.setupPayment(braintreePaypalCheckout, id, onPaymentError),\n                onApprove: async (authorizeData: PaypalAuthorizeData) => {\n                    this.braintreeTokenizePayload = await this.tokenizePaymentOrThrow(\n                        authorizeData,\n                        braintreePaypalCheckout,\n                    );\n\n                    if (submitForm && typeof submitForm === 'function') {\n                        submitForm();\n                    }\n                },\n                onCancel: () => {\n                    this.toggleLoadingIndicator(false);\n                },\n                onError: (error: Error) => {\n                    this.toggleLoadingIndicator(false);\n\n                    onError?.(error);\n                },\n            });\n\n            if (onRenderButton && typeof onRenderButton === 'function') {\n                onRenderButton();\n            }\n\n            if (this.paypalButtonRender.isEligible()) {\n                this.paypalButtonRender.render(`${containerId}`);\n            }\n        } else {\n            this.removeElement(containerId.split('#')[1]);\n        }\n    }\n\n    private async setupPayment(\n        braintreePaypalCheckout: BraintreePaypalCheckout,\n        method: string,\n        onPaymentError: BraintreePaypalPaymentInitializeOptions['onPaymentError'],\n    ): Promise<string> {\n        const state = this.paymentIntegrationService.getState();\n\n        try {\n            const customer = state.getCustomer();\n\n            const paymentMethod: PaymentMethod = state.getPaymentMethodOrThrow(method);\n\n            const amount = state.getCheckoutOrThrow().outstandingBalance;\n            const currencyCode = state.getStoreConfigOrThrow().currency.code;\n\n            const shippingAddress = state.getShippingAddress();\n\n            const address = shippingAddress || customer?.addresses[0];\n\n            const shippingAddressOverride = address\n                ? mapToBraintreeShippingAddressOverride(address)\n                : undefined;\n\n            return await braintreePaypalCheckout.createPayment({\n                flow: 'checkout',\n                enableShippingAddress: true,\n                shippingAddressEditable: false,\n                shippingAddressOverride,\n                amount,\n                currency: currencyCode,\n                offerCredit: false,\n                intent: paymentMethod.initializationData.intent,\n            });\n        } catch (error) {\n            if (onPaymentError && (isBraintreeError(error) || error instanceof StandardError)) {\n                onPaymentError(error);\n            }\n\n            throw error;\n        }\n    }\n\n    private async tokenizePaymentOrThrow(\n        authorizeData: PaypalAuthorizeData,\n        braintreePaypalCheckout: BraintreePaypalCheckout,\n        onError?: (error: BraintreeError | StandardError) => void,\n    ): Promise<BraintreeTokenizePayload> {\n        try {\n            return await braintreePaypalCheckout.tokenizePayment(authorizeData);\n        } catch (error) {\n            if (onError && (isBraintreeError(error) || error instanceof StandardError)) {\n                onError(error);\n            }\n\n            throw error;\n        }\n    }\n\n    private async loadPaypal() {\n        const { clientToken, initializationData } = this.paymentMethod || {};\n\n        if (!clientToken || !initializationData) {\n            throw new MissingDataError(MissingDataErrorType.MissingPaymentMethod);\n        }\n\n        try {\n            this.braintreeIntegrationService.initialize(clientToken);\n\n            await this.braintreeIntegrationService.getPaypal();\n        } catch (error) {\n            this.handleError(error);\n        }\n\n        return Promise.resolve();\n    }\n\n    private handleError(error: BraintreeError | Error | unknown): never {\n        if (!isBraintreeError(error)) {\n            throw error;\n        }\n\n        if (error.code === 'PAYPAL_POPUP_CLOSED') {\n            throw new PaymentMethodCancelledError(error.message);\n        }\n\n        throw new PaymentMethodFailedError(error.message);\n    }\n\n    private isProviderError(error: unknown): boolean {\n        if (isBraintreePaypalProviderError(error)) {\n            const paypalProviderError = error?.errors?.filter((e) => e.provider_error) || [];\n\n            return paypalProviderError[0]?.provider_error?.code === '2046';\n        }\n\n        return false;\n    }\n\n    private removeElement(elementId?: string): void {\n        const element = elementId && document.getElementById(elementId);\n\n        if (element) {\n            element.remove();\n        }\n    }\n\n    /**\n     *\n     * Loading Indicator methods\n     *\n     * */\n    private toggleLoadingIndicator(isLoading: boolean): void {\n        if (isLoading && this.loadingIndicatorContainer) {\n            this.loadingIndicator.show(this.loadingIndicatorContainer);\n        } else {\n            this.loadingIndicator.hide();\n        }\n    }\n}\n","export interface ProviderError extends Error {\n    errors?: ErrorElement[];\n    status?: string;\n    three_ds_result?: {\n        acs_url: unknown;\n        payer_auth_request: unknown;\n        merchant_data: unknown;\n        callback_url: unknown;\n    };\n}\n\nexport interface ErrorElement {\n    code: string;\n    message: string;\n    provider_error?: {\n        code: string;\n    };\n}\n\nexport default function isBraintreePaypalProviderError(error: unknown): error is ProviderError {\n    return typeof error === 'object' && error !== null && 'errors' in error;\n}\n","import { getScriptLoader } from '@bigcommerce/script-loader';\n\nimport {\n    BraintreeHostWindow,\n    BraintreeIntegrationService,\n    BraintreeMessages,\n    BraintreeScriptLoader,\n    BraintreeSDKVersionManager,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    PaymentStrategyFactory,\n    toResolvableModule,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\nimport { LoadingIndicator, Overlay } from '@bigcommerce/checkout-sdk/ui';\n\nimport { LOADING_INDICATOR_STYLES } from '../braintree-paypal-constants';\n\nimport BraintreePaypalPaymentStrategy from './braintree-paypal-payment-strategy';\n\nconst createBraintreePaypalPaymentStrategy: PaymentStrategyFactory<\n    BraintreePaypalPaymentStrategy\n> = (paymentIntegrationService) => {\n    const braintreeHostWindow: BraintreeHostWindow = window;\n    const overlay = new Overlay();\n\n    const braintreeSDKVersionManager = new BraintreeSDKVersionManager(paymentIntegrationService);\n    const braintreeIntegrationService = new BraintreeIntegrationService(\n        new BraintreeScriptLoader(\n            getScriptLoader(),\n            braintreeHostWindow,\n            braintreeSDKVersionManager,\n        ),\n        braintreeHostWindow,\n        overlay,\n    );\n    const braintreeMessages = new BraintreeMessages(paymentIntegrationService);\n\n    return new BraintreePaypalPaymentStrategy(\n        paymentIntegrationService,\n        braintreeIntegrationService,\n        braintreeMessages,\n        new LoadingIndicator({\n            containerStyles: LOADING_INDICATOR_STYLES,\n        }),\n    );\n};\n\nexport default toResolvableModule(createBraintreePaypalPaymentStrategy, [\n    { id: 'braintreepaypal' },\n    { id: 'braintreepaypalcredit' },\n]);\n","enum ContentType {\n    Json = 'application/json',\n    JsonV1 = 'application/vnd.bc.v1+json',\n}\n\nexport default ContentType;\n","export const SDK_VERSION_HEADERS = { 'X-Checkout-SDK-Version': LIBRARY_VERSION };\n","import { RequestSender } from '@bigcommerce/request-sender';\n\nimport { BraintreeOrderStatusData } from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    ContentType,\n    INTERNAL_USE_ONLY,\n    RequestOptions,\n    SDK_VERSION_HEADERS,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nexport default class BraintreeRequestSender {\n    constructor(private requestSender: RequestSender) {}\n\n    async getOrderStatus(\n        methodId = 'braintreelocalmethods',\n        options?: RequestOptions,\n    ): Promise<BraintreeOrderStatusData> {\n        const url = `/api/storefront/initialization/${methodId}`;\n        const headers = {\n            'X-API-INTERNAL': INTERNAL_USE_ONLY,\n            'Content-Type': ContentType.Json,\n            ...SDK_VERSION_HEADERS,\n        };\n\n        const res = await this.requestSender.get<BraintreeOrderStatusData>(url, {\n            headers,\n            ...options,\n        });\n\n        return res.body;\n    }\n}\n","export const INTERNAL_USE_ONLY =\n    'This API endpoint is for internal use only and may change in the future';\n","import { Response } from '@bigcommerce/request-sender';\n\nimport StandardError from './standard-error';\n\nconst DEFAULT_RESPONSE = {\n    body: {},\n    headers: {},\n    status: 0,\n};\n\n/**\n * Throw this error if we are unable to make a request to the server. It wraps\n * any server response into a JS error object.\n */\nexport default class RequestError<TBody = any> extends StandardError {\n    body: TBody | {};\n    headers: { [key: string]: any };\n    errors: Array<{ code: string; message?: string }>;\n    status: number;\n\n    constructor(\n        response?: Response<TBody | {}>,\n        {\n            message,\n            errors,\n        }: {\n            message?: string;\n            errors?: Array<{ code: string; message?: string }>;\n        } = {},\n    ) {\n        const { body, headers, status } = response || DEFAULT_RESPONSE;\n\n        super(message || 'An unexpected error has occurred.');\n\n        this.name = 'RequestError';\n        this.type = 'request';\n        this.body = body;\n        this.headers = headers;\n        this.status = status;\n        this.errors = errors || [];\n    }\n}\n","import { Response } from '@bigcommerce/request-sender';\n\nimport RequestError from './request-error';\n\n/**\n * Throw this error if we are unable to successfully submit a server request\n * using a payment method because the method has invalid configuration or is in\n * an invalid state.\n */\nexport default class PaymentMethodInvalidError<T = any> extends RequestError<T> {\n    constructor(response?: Response<T>) {\n        super(response, {\n            message: 'There is a problem processing your payment. Please try again later.',\n        });\n\n        this.name = 'PaymentMethodInvalidError';\n        this.type = 'payment_method_invalid';\n    }\n}\n","import { Response } from '@bigcommerce/request-sender';\n\nimport RequestError from './request-error';\n\n/**\n * Throw this error if a request fails to complete within its required timeframe\n * because of a network issue.\n */\nexport default class TimeoutError<T = any> extends RequestError<T> {\n    constructor(response?: Response<T>) {\n        super(response, {\n            message: 'The request has timed out or aborted.',\n        });\n\n        this.name = 'TimeoutError';\n        this.type = 'timeout';\n    }\n}\n","import { noop } from 'lodash';\n\nimport {\n    BraintreeInitializationData,\n    BraintreeLocalPayment,\n    BraintreeLocalPaymentConfig,\n    BraintreeLocalPaymentMethodRedirectAction,\n    BraintreeLocalPaymentsPayload,\n    BraintreeLPMPaymentStartData,\n    BraintreeLPMStartPaymentError,\n    BraintreeOrderSavedResponse,\n    BraintreeOrderStatus,\n    BraintreeRedirectError,\n    BraintreeSdk,\n    NonInstantLocalPaymentMethods,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    InvalidArgumentError,\n    MissingDataError,\n    MissingDataErrorType,\n    OrderFinalizationNotRequiredError,\n    OrderRequestBody,\n    PaymentArgumentInvalidError,\n    PaymentInitializeOptions,\n    PaymentInstrumentMeta,\n    PaymentIntegrationService,\n    PaymentMethodInvalidError,\n    PaymentRequestOptions,\n    PaymentStrategy,\n    RequestOptions,\n    TimeoutError,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\nimport { LoadingIndicator } from '@bigcommerce/checkout-sdk/ui';\nimport { isExperimentEnabled } from '@bigcommerce/checkout-sdk/utility';\n\nimport BraintreeRequestSender from '../braintree-request-sender';\n\nimport {\n    BraintreeLocalMethodsPaymentInitializeOptions,\n    WithBraintreeLocalMethodsPaymentInitializeOptions,\n} from './braintree-local-methods-payment-initialize-options';\n\nconst POLLING_INTERVAL = 3000;\nconst MAX_POLLING_TIME = 300000;\n\nexport default class BraintreeLocalMethodsPaymentStrategy implements PaymentStrategy {\n    private braintreelocalmethods?: BraintreeLocalMethodsPaymentInitializeOptions;\n    private braintreeLocalPayment?: BraintreeLocalPayment;\n    private loadingIndicatorContainer?: string;\n    private orderId?: string;\n    private gatewayId?: string;\n    private isLPMsUpdateExperimentEnabled = false;\n    private pollingTimer = 0;\n    private stopPolling = noop;\n    private isPollingEnabled = false;\n\n    constructor(\n        private paymentIntegrationService: PaymentIntegrationService,\n        private braintreeSdk: BraintreeSdk,\n        private braintreeRequestSender: BraintreeRequestSender,\n        private loadingIndicator: LoadingIndicator,\n        private pollingInterval: number = POLLING_INTERVAL,\n        private maxPollingIntervalTime: number = MAX_POLLING_TIME,\n    ) {}\n\n    async initialize(\n        options: PaymentInitializeOptions & WithBraintreeLocalMethodsPaymentInitializeOptions,\n    ): Promise<void> {\n        const { gatewayId, methodId, braintreelocalmethods } = options;\n\n        this.gatewayId = gatewayId;\n\n        if (!methodId) {\n            throw new InvalidArgumentError(\n                'Unable to initialize payment because \"options.methodId\" argument is not provided.',\n            );\n        }\n\n        if (!gatewayId) {\n            throw new InvalidArgumentError(\n                'Unable to initialize payment because \"options.gatewayId\" argument is not provided.',\n            );\n        }\n\n        if (!braintreelocalmethods) {\n            throw new InvalidArgumentError(\n                `Unable to initialize payment because \"options.braintreelocalmethods\" argument is not provided.`,\n            );\n        }\n\n        this.braintreelocalmethods = braintreelocalmethods;\n        this.loadingIndicatorContainer = braintreelocalmethods.container.split('#')[1];\n\n        await this.paymentIntegrationService.loadPaymentMethod(gatewayId);\n\n        const state = this.paymentIntegrationService.getState();\n        const paymentMethod = state.getPaymentMethodOrThrow<BraintreeInitializationData>(gatewayId);\n        const { clientToken, config, initializationData } = paymentMethod;\n        const features = state.getStoreConfigOrThrow().checkoutSettings.features;\n\n        this.isPollingEnabled = isExperimentEnabled(\n            features,\n            'PAYPAL-5258.braintree_local_methods_polling',\n        );\n\n        this.isLPMsUpdateExperimentEnabled = isExperimentEnabled(\n            features,\n            'PAYPAL-4853.add_new_payment_flow_for_braintree_lpms',\n        );\n\n        if (!clientToken || !initializationData || !config.merchantId) {\n            throw new MissingDataError(MissingDataErrorType.MissingPaymentMethod);\n        }\n\n        try {\n            this.braintreeSdk.initialize(clientToken);\n\n            if (!this.isNonInstantPaymentMethod(methodId)) {\n                this.braintreeLocalPayment = await this.braintreeSdk.getBraintreeLocalPayment(\n                    config.merchantId,\n                );\n            }\n        } catch (error: unknown) {\n            this.handleError(error);\n        }\n    }\n\n    finalize(): Promise<void> {\n        return Promise.reject(new OrderFinalizationNotRequiredError());\n    }\n\n    async deinitialize(): Promise<void> {\n        this.toggleLoadingIndicator(false);\n\n        return Promise.resolve();\n    }\n\n    async execute(payload: OrderRequestBody, options?: PaymentRequestOptions): Promise<void> {\n        const { payment, ...order } = payload;\n\n        if (!payment) {\n            throw new PaymentArgumentInvalidError(['payment']);\n        }\n\n        const { methodId } = payment;\n\n        this.toggleLoadingIndicator(true);\n\n        if (this.isNonInstantPaymentMethod(methodId)) {\n            await this.executeWithNotInstantLPM(methodId);\n        } else {\n            await this.executeWithInstantLPM(methodId, order, options);\n        }\n    }\n\n    private async executeWithNotInstantLPM(methodId: string): Promise<void> {\n        try {\n            const basicPaymentData = await this.getLPMsBasicPaymentData();\n\n            await this.paymentIntegrationService.submitOrder();\n            await this.paymentIntegrationService.submitPayment({\n                methodId,\n                paymentData: {\n                    ...basicPaymentData,\n                    formattedPayload: {\n                        method: methodId,\n                    },\n                },\n            });\n        } catch (error: unknown) {\n            if (this.isBraintreeRedirectError(error)) {\n                const redirectUrl = error.body.additional_action_required.data.redirect_url;\n\n                return new Promise((_, reject) => {\n                    window.location.replace(redirectUrl);\n\n                    this.toggleLoadingIndicator(false);\n\n                    reject();\n                });\n            }\n\n            this.handleError(error);\n\n            return Promise.reject(error);\n        }\n    }\n\n    private async executeWithInstantLPM(\n        methodId: string,\n        order: Omit<OrderRequestBody, 'payment'>,\n        options?: PaymentRequestOptions,\n    ): Promise<void> {\n        if (!this.braintreeLocalPayment) {\n            throw new PaymentMethodInvalidError();\n        }\n\n        await new Promise((resolve, reject): void => {\n            this.braintreeLocalPayment?.startPayment(\n                this.getInstantLPMConfig(methodId, order, options),\n                this.getInstantLPMCallback(resolve, reject, methodId, order, options),\n            );\n        });\n    }\n\n    private async getLPMsBasicPaymentData(): Promise<PaymentInstrumentMeta> {\n        const { deviceData } = await this.braintreeSdk.getDataCollectorOrThrow();\n\n        return { deviceSessionId: deviceData };\n    }\n\n    private getInstantLPMConfig(\n        methodId: string,\n        order: Omit<OrderRequestBody, 'payment'>,\n        options?: RequestOptions,\n    ): BraintreeLocalPaymentConfig {\n        const state = this.paymentIntegrationService.getState();\n        const cart = state.getCartOrThrow();\n        const billing = state.getBillingAddressOrThrow();\n        const { firstName, lastName, countryCode } = billing;\n        const { currency, email, lineItems } = cart;\n        const isShippingRequired = lineItems.physicalItems.length > 0;\n        const grandTotal = state.getCheckoutOrThrow().outstandingBalance;\n        const checkoutUrl = state.getStoreConfigOrThrow().links.checkoutLink;\n\n        return {\n            paymentType: methodId,\n            amount: grandTotal,\n            fallback: {\n                url: checkoutUrl,\n                buttonText: 'Complete Payment',\n            },\n            currencyCode: currency.code,\n            shippingAddressRequired: isShippingRequired,\n            email,\n            givenName: firstName,\n            surname: lastName,\n            address: {\n                countryCode,\n            },\n            onPaymentStart: async (data: BraintreeLPMPaymentStartData, start: () => void) => {\n                if (!this.isLPMsUpdateExperimentEnabled) {\n                    this.orderId = data.paymentId;\n\n                    start();\n\n                    return;\n                }\n\n                const basicPaymentData = await this.getLPMsBasicPaymentData();\n                const paymentData = {\n                    ...basicPaymentData,\n                    formattedPayload: {\n                        method: methodId,\n                        [`${methodId}_account`]: {\n                            order_id: data.paymentId,\n                        },\n                    },\n                };\n\n                try {\n                    // Submit order and payment should be performed to pass order_id to the backend\n                    await this.paymentIntegrationService.submitOrder(order, options);\n                    await this.paymentIntegrationService.submitPayment({\n                        methodId,\n                        paymentData,\n                    });\n                } catch (error: unknown) {\n                    if (\n                        this.isBraintreeOrderSavedResponse(error) &&\n                        error.body.additional_action_required.data.order_id_saved_successfully\n                    ) {\n                        // Start method call initiates the popup\n                        start();\n\n                        if (this.isPollingEnabled) {\n                            return new Promise((resolve, reject) => {\n                                void this.initializePollingMechanism(\n                                    methodId,\n                                    resolve,\n                                    reject,\n                                    this.gatewayId,\n                                );\n                            });\n                        }\n\n                        return;\n                    }\n\n                    throw error;\n                }\n            },\n        };\n    }\n\n    private getInstantLPMCallback(\n        resolve: (value: unknown) => void,\n        reject: (reason?: unknown) => void,\n        methodId: string,\n        order: Omit<OrderRequestBody, 'payment'>,\n        options?: RequestOptions,\n    ) {\n        const state = this.paymentIntegrationService.getState();\n        const cart = state.getCartOrThrow();\n\n        return async (\n            startPaymentError: BraintreeLPMStartPaymentError | undefined,\n            payloadData: BraintreeLocalPaymentsPayload,\n        ) => {\n            if (startPaymentError) {\n                if (startPaymentError.code === 'LOCAL_PAYMENT_WINDOW_CLOSED') {\n                    this.toggleLoadingIndicator(false);\n                    this.resetPollingMechanism();\n\n                    return reject();\n                }\n\n                if (this.isPollingEnabled) {\n                    this.resetPollingMechanism();\n                }\n\n                this.toggleLoadingIndicator(false);\n\n                return reject(new PaymentMethodInvalidError());\n            }\n\n            const basicPaymentData = await this.getLPMsBasicPaymentData();\n            const paymentData = {\n                ...basicPaymentData,\n                formattedPayload: {\n                    method: methodId,\n                    [`${methodId}_account`]: {\n                        email: cart.email,\n                        token: payloadData.nonce,\n                        ...(!this.isLPMsUpdateExperimentEnabled ? { order_id: this.orderId } : {}),\n                    },\n                },\n            };\n\n            try {\n                if (!this.isLPMsUpdateExperimentEnabled) {\n                    await this.paymentIntegrationService.submitOrder(order, options);\n                }\n\n                await this.paymentIntegrationService.submitPayment({\n                    methodId,\n                    paymentData,\n                });\n\n                return resolve(undefined);\n            } catch (error: unknown) {\n                this.handleError(error);\n\n                return reject(error);\n            }\n        };\n    }\n\n    /**\n     *\n     * Loading Indicator methods\n     *\n     * */\n    private toggleLoadingIndicator(isLoading: boolean): void {\n        if (isLoading && this.loadingIndicatorContainer) {\n            this.loadingIndicator.show(this.loadingIndicatorContainer);\n        } else {\n            this.loadingIndicator.hide();\n        }\n    }\n\n    private handleError(error: unknown) {\n        const { onError } = this.braintreelocalmethods || {};\n\n        if (this.isPollingEnabled) {\n            this.resetPollingMechanism();\n        }\n\n        this.toggleLoadingIndicator(false);\n\n        if (onError && typeof onError === 'function') {\n            onError(error);\n        }\n    }\n\n    /**\n     *\n     * Utils\n     *\n     * */\n    private isNonInstantPaymentMethod(methodId: string): boolean {\n        return methodId.toUpperCase() in NonInstantLocalPaymentMethods;\n    }\n\n    private isBraintreeRedirectError(error: unknown): error is BraintreeRedirectError {\n        if (typeof error !== 'object' || error === null) {\n            return false;\n        }\n\n        const { body }: Partial<BraintreeLocalPaymentMethodRedirectAction> = error;\n\n        if (!body) {\n            return false;\n        }\n\n        return !!body.additional_action_required?.data.redirect_url;\n    }\n\n    private isBraintreeOrderSavedResponse(\n        response: unknown,\n    ): response is BraintreeOrderSavedResponse {\n        if (typeof response !== 'object' || response === null) {\n            return false;\n        }\n\n        const { body }: Partial<BraintreeOrderSavedResponse> = response;\n\n        if (!body) {\n            return false;\n        }\n\n        return body.additional_action_required?.data.hasOwnProperty('order_id_saved_successfully');\n    }\n\n    /**\n     *\n     * Polling mechanism\n     *\n     *\n     * */\n    private async initializePollingMechanism(\n        methodId: string,\n        resolvePromise: () => void,\n        rejectPromise: () => void,\n        gatewayId?: string,\n    ): Promise<void> {\n        await new Promise<void>((resolve, reject) => {\n            const timeout = setTimeout(resolve, this.pollingInterval);\n\n            this.stopPolling = () => {\n                clearTimeout(timeout);\n                this.toggleLoadingIndicator(false);\n\n                return reject();\n            };\n        });\n\n        try {\n            this.pollingTimer += this.pollingInterval;\n\n            const orderStatus = await this.braintreeRequestSender.getOrderStatus(gatewayId, {\n                params: {\n                    useMetadata: false,\n                },\n            });\n\n            const isOrderPending = orderStatus.status === BraintreeOrderStatus.Pending;\n            const isOrderApproved = orderStatus.status === BraintreeOrderStatus.Completed;\n            const isPollingError = orderStatus.status === BraintreeOrderStatus.Failed;\n\n            if (isOrderApproved) {\n                this.deinitializePollingMechanism();\n\n                return resolvePromise();\n            }\n\n            if (isPollingError) {\n                return rejectPromise();\n            }\n\n            if (\n                !isOrderApproved &&\n                isOrderPending &&\n                this.pollingTimer < this.maxPollingIntervalTime\n            ) {\n                return await this.initializePollingMechanism(\n                    methodId,\n                    resolvePromise,\n                    rejectPromise,\n                    gatewayId,\n                );\n            }\n\n            await this.reinitializeStrategy({\n                methodId,\n                gatewayId,\n                braintreelocalmethods: this.braintreelocalmethods,\n            });\n\n            this.handleError(new TimeoutError());\n        } catch (error) {\n            rejectPromise();\n        }\n    }\n\n    private deinitializePollingMechanism(): void {\n        this.stopPolling();\n        this.pollingTimer = 0;\n    }\n\n    private resetPollingMechanism(): void {\n        this.deinitializePollingMechanism();\n    }\n\n    private async reinitializeStrategy(\n        options: PaymentInitializeOptions & WithBraintreeLocalMethodsPaymentInitializeOptions,\n    ) {\n        await this.deinitialize();\n        await this.initialize(options);\n    }\n}\n","import { createRequestSender } from '@bigcommerce/request-sender';\nimport { getScriptLoader } from '@bigcommerce/script-loader';\n\nimport {\n    BraintreeHostWindow,\n    BraintreeScriptLoader,\n    BraintreeSdk,\n    BraintreeSDKVersionManager,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    PaymentStrategyFactory,\n    toResolvableModule,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\nimport { LoadingIndicator } from '@bigcommerce/checkout-sdk/ui';\n\nimport BraintreeRequestSender from '../braintree-request-sender';\n\nimport BraintreeLocalMethodsPaymentStrategy from './braintree-local-methods-payment-strategy';\n\nconst createBraintreeLocalMethodsPaymentStrategy: PaymentStrategyFactory<\n    BraintreeLocalMethodsPaymentStrategy\n> = (paymentIntegrationService) => {\n    const braintreeHostWindow: BraintreeHostWindow = window;\n    const braintreeSDKVersionManager = new BraintreeSDKVersionManager(paymentIntegrationService);\n    const braintreeSdk = new BraintreeSdk(\n        new BraintreeScriptLoader(\n            getScriptLoader(),\n            braintreeHostWindow,\n            braintreeSDKVersionManager,\n        ),\n    );\n    const requestSender = createRequestSender();\n    const braintreeRequestSender = new BraintreeRequestSender(requestSender);\n\n    return new BraintreeLocalMethodsPaymentStrategy(\n        paymentIntegrationService,\n        braintreeSdk,\n        braintreeRequestSender,\n        new LoadingIndicator({ styles: { backgroundColor: 'black' } }),\n    );\n};\n\nexport default toResolvableModule(createBraintreeLocalMethodsPaymentStrategy, [\n    { gateway: 'braintreelocalmethods' },\n]);\n","import { omitBy } from 'lodash';\n\nimport { BraintreeFastlaneStylesOption, FastlaneStylesSettings } from '../index';\n\nfunction isInvalidStyleOption(styleOption: unknown) {\n    return typeof styleOption !== 'string';\n}\n\nexport default function getFastlaneStyles(\n    styleSettings?: FastlaneStylesSettings,\n    uiStyles?: BraintreeFastlaneStylesOption,\n): BraintreeFastlaneStylesOption | undefined {\n    if (!uiStyles && !styleSettings) {\n        return undefined;\n    }\n\n    return cleanUpFastlaneStyles(mergeFastlaneStyles(styleSettings, uiStyles));\n}\n\nfunction mergeFastlaneStyles(\n    styleSettings?: FastlaneStylesSettings,\n    uiStyles?: BraintreeFastlaneStylesOption,\n): BraintreeFastlaneStylesOption {\n    return {\n        root: {\n            backgroundColorPrimary:\n                styleSettings?.fastlaneRootSettingsBackgroundColor ||\n                uiStyles?.root?.backgroundColorPrimary,\n            errorColor: styleSettings?.fastlaneRootSettingsErrorColor || uiStyles?.root?.errorColor,\n            fontFamily: styleSettings?.fastlaneRootSettingsFontFamily || uiStyles?.root?.fontFamily,\n            fontSizeBase:\n                styleSettings?.fastlaneRootSettingsFontSize || uiStyles?.root?.fontSizeBase,\n            padding: styleSettings?.fastlaneRootSettingsPadding || uiStyles?.root?.padding,\n            primaryColor:\n                styleSettings?.fastlaneRootSettingsPrimaryColor || uiStyles?.root?.primaryColor,\n        },\n        input: {\n            borderRadius:\n                styleSettings?.fastlaneInputSettingsBorderRadius || uiStyles?.input?.borderRadius,\n            borderColor:\n                styleSettings?.fastlaneInputSettingsBorderColor || uiStyles?.input?.borderColor,\n            focusBorderColor:\n                styleSettings?.fastlaneInputSettingsFocusBorderBase ||\n                uiStyles?.input?.focusBorderColor,\n            backgroundColor:\n                styleSettings?.fastlaneInputSettingsBackgroundColor ||\n                uiStyles?.input?.backgroundColor,\n            borderWidth:\n                styleSettings?.fastlaneInputSettingsBorderWidth || uiStyles?.input?.borderWidth,\n            textColorBase:\n                styleSettings?.fastlaneInputSettingsTextColorBase || uiStyles?.input?.textColorBase,\n        },\n        toggle: {\n            colorPrimary:\n                styleSettings?.fastlaneToggleSettingsColorPrimary || uiStyles?.toggle?.colorPrimary,\n            colorSecondary:\n                styleSettings?.fastlaneToggleSettingsColorSecondary ||\n                uiStyles?.toggle?.colorSecondary,\n        },\n        text: {\n            body: {\n                color: styleSettings?.fastlaneTextBodySettingsColor || uiStyles?.text?.body?.color,\n                fontSize:\n                    styleSettings?.fastlaneTextBodySettingsFontSize ||\n                    uiStyles?.text?.body?.fontSize,\n            },\n            caption: {\n                color:\n                    styleSettings?.fastlaneTextCaptionSettingsColor ||\n                    uiStyles?.text?.caption?.color,\n                fontSize:\n                    styleSettings?.fastlaneTextCaptionSettingsFontSize ||\n                    uiStyles?.text?.caption?.fontSize,\n            },\n        },\n        branding: styleSettings?.fastlaneBrandingSettings || uiStyles?.branding,\n    };\n}\n\nfunction cleanUpFastlaneStyles(styles: BraintreeFastlaneStylesOption) {\n    const fastlaneStyles: BraintreeFastlaneStylesOption = {};\n\n    const root = omitBy(styles.root, isInvalidStyleOption);\n    const input = omitBy(styles.input, isInvalidStyleOption);\n    const toggle = omitBy(styles.toggle, isInvalidStyleOption);\n    const textBody = omitBy(styles.text?.body, isInvalidStyleOption);\n    const textCaption = omitBy(styles.text?.caption, isInvalidStyleOption);\n    const branding = styles.branding;\n\n    if (Object.keys(root).length) {\n        fastlaneStyles.root = root;\n    }\n\n    if (Object.keys(input).length) {\n        fastlaneStyles.input = input;\n    }\n\n    if (Object.keys(toggle).length) {\n        fastlaneStyles.toggle = toggle;\n    }\n\n    if (Object.keys(textBody).length) {\n        fastlaneStyles.text = {};\n        fastlaneStyles.text.body = textBody;\n    }\n\n    if (Object.keys(textCaption).length) {\n        fastlaneStyles.text = {\n            ...fastlaneStyles.text,\n        };\n        fastlaneStyles.text.caption = textCaption;\n    }\n\n    if (branding) {\n        fastlaneStyles.branding = branding;\n    }\n\n    return fastlaneStyles;\n}\n","import {\n    PaymentProviderCustomer,\n    PayPalConnectCustomer,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nexport default function isBraintreeAcceleratedCheckoutCustomer(\n    customer?: PaymentProviderCustomer,\n): customer is PayPalConnectCustomer {\n    if (!customer) {\n        return false;\n    }\n\n    return (\n        'authenticationState' in customer || 'addresses' in customer || 'instruments' in customer\n    );\n}\n","import { HostedInstrument, NonceInstrument } from './payment';\n\ntype PaymentInstrument = CardInstrument | AccountInstrument | HostedInstrument | NonceInstrument;\n\nexport default PaymentInstrument;\n\nexport interface BaseInstrument {\n    bigpayToken: string;\n    defaultInstrument: boolean;\n    provider: string;\n    trustedShippingAddress: boolean;\n    method: string;\n    type: string;\n}\n\nexport enum UntrustedShippingCardVerificationType {\n    CVV = 'cvv',\n    PAN = 'pan',\n}\n\nexport interface CardInstrument extends BaseInstrument {\n    brand: string;\n    expiryMonth: string;\n    expiryYear: string;\n    iin: string;\n    last4: string;\n    type: 'card';\n    untrustedShippingCardVerificationMode: UntrustedShippingCardVerificationType;\n}\n\ninterface BaseAccountInstrument extends BaseInstrument {\n    method: string;\n    type: 'account' | 'bank';\n}\n\nexport interface PayPalInstrument extends BaseAccountInstrument {\n    externalId: string;\n    method: 'paypal';\n}\n\nexport interface AchInstrument extends BaseAccountInstrument {\n    issuer: string;\n    accountNumber: string;\n    type: 'bank';\n    method: 'ach' | 'ecp';\n}\n\nexport interface BankInstrument extends BaseAccountInstrument {\n    accountNumber: string;\n    issuer: string;\n    iban: string;\n    method: string;\n    type: 'bank';\n}\n\nexport type AccountInstrument = PayPalInstrument | BankInstrument | AchInstrument;\n\nexport interface VaultAccessToken {\n    vaultAccessToken: string;\n    vaultAccessExpiry: number;\n}\n\nexport interface SessionContext {\n    customerId: number;\n    storeId: string;\n    currencyCode?: string;\n}\n\nexport interface InstrumentRequestContext extends SessionContext {\n    authToken: string;\n}\n","import {\n    Braintree3DSVerifyCardError,\n    Braintree3DSVerifyCardPayload,\n    BraintreeFastlaneAddress,\n    BraintreeFastlaneAuthenticationState,\n    BraintreeFastlaneCardComponent,\n    BraintreeFastlaneCardComponentOptions,\n    BraintreeInitializationData,\n    BraintreeSdk,\n    getFastlaneStyles,\n    isBraintreeAcceleratedCheckoutCustomer,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    Address,\n    CardInstrument,\n    InvalidArgumentError,\n    OrderFinalizationNotRequiredError,\n    OrderRequestBody,\n    Payment,\n    PaymentArgumentInvalidError,\n    PaymentInitializeOptions,\n    PaymentIntegrationService,\n    PaymentMethodCancelledError,\n    PaymentMethodClientUnavailableError,\n    PaymentRequestOptions,\n    PaymentStrategy,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\nimport { isExperimentEnabled } from '@bigcommerce/checkout-sdk/utility';\n\nimport { WithBraintreeFastlanePaymentInitializeOptions } from './braintree-fastlane-payment-initialize-options';\nimport BraintreeFastlaneUtils from './braintree-fastlane-utils';\n\nexport default class BraintreeFastlanePaymentStrategy implements PaymentStrategy {\n    private braintreeCardComponent?: BraintreeFastlaneCardComponent;\n    private is3DSEnabled?: boolean;\n    private onError?: (error: Error) => void;\n\n    constructor(\n        private paymentIntegrationService: PaymentIntegrationService,\n        private braintreeFastlaneUtils: BraintreeFastlaneUtils,\n        private braintreeSdk: BraintreeSdk,\n    ) {}\n\n    /**\n     *\n     * Default methods\n     *\n     */\n    async initialize(\n        options: PaymentInitializeOptions & WithBraintreeFastlanePaymentInitializeOptions,\n    ): Promise<void> {\n        const { methodId, braintreefastlane } = options;\n\n        if (!methodId) {\n            throw new InvalidArgumentError(\n                'Unable to initialize payment because \"options.methodId\" argument is not provided.',\n            );\n        }\n\n        if (!braintreefastlane) {\n            throw new InvalidArgumentError(\n                'Unable to initialize payment because \"options.braintreefastlane\" argument is not provided.',\n            );\n        }\n\n        if (!braintreefastlane.onInit || typeof braintreefastlane.onInit !== 'function') {\n            throw new InvalidArgumentError(\n                'Unable to initialize payment because \"options.braintreefastlane.onInit\" argument is not provided or it is not a function.',\n            );\n        }\n\n        if (!braintreefastlane.onChange || typeof braintreefastlane.onChange !== 'function') {\n            throw new InvalidArgumentError(\n                'Unable to initialize payment because \"options.braintreefastlane.onChange\" argument is not provided or it is not a function.',\n            );\n        }\n\n        await this.paymentIntegrationService.loadPaymentMethod(methodId);\n\n        const state = this.paymentIntegrationService.getState();\n        const paymentMethod = state.getPaymentMethodOrThrow<BraintreeInitializationData>(methodId);\n        const { initializationData, clientToken } = paymentMethod || {};\n        const { isFastlaneStylingEnabled } = initializationData || {};\n        const features = state.getStoreConfigOrThrow().checkoutSettings.features;\n        const isThreeDSExperimentEnabled = isExperimentEnabled(\n            features,\n            'PROJECT-7080.braintree_fastlane_three_ds',\n        );\n\n        this.is3DSEnabled = paymentMethod.config.is3dsEnabled;\n\n        if (clientToken && isThreeDSExperimentEnabled) {\n            this.braintreeSdk.initialize(clientToken);\n        }\n\n        const paypalFastlaneStyleSettings = isFastlaneStylingEnabled\n            ? paymentMethod.initializationData?.fastlaneStyles\n            : undefined;\n\n        const fastlaneStyles = getFastlaneStyles(\n            paypalFastlaneStyleSettings,\n            braintreefastlane.styles,\n        );\n\n        await this.braintreeFastlaneUtils.initializeBraintreeFastlaneOrThrow(\n            methodId,\n            fastlaneStyles,\n        );\n\n        if (this.shouldRunAuthenticationFlow()) {\n            await this.braintreeFastlaneUtils.runPayPalAuthenticationFlowOrThrow();\n        }\n\n        await this.initializeCardComponent();\n\n        this.onError = braintreefastlane.onError;\n\n        braintreefastlane.onInit((container) => this.renderBraintreeCardComponent(container));\n        braintreefastlane.onChange(() => this.handleBraintreeStoredInstrumentChange(methodId));\n    }\n\n    async execute(orderRequest: OrderRequestBody, options?: PaymentRequestOptions): Promise<void> {\n        const { payment, ...order } = orderRequest;\n\n        if (!payment) {\n            throw new PaymentArgumentInvalidError(['payment']);\n        }\n\n        await this.paymentIntegrationService.submitOrder(order, options);\n\n        const paymentPayload = await this.preparePaymentPayload(payment.methodId);\n\n        await this.paymentIntegrationService.submitPayment(paymentPayload);\n\n        this.braintreeFastlaneUtils.removeSessionIdFromCookies();\n    }\n\n    finalize(): Promise<void> {\n        return Promise.reject(new OrderFinalizationNotRequiredError());\n    }\n\n    async deinitialize(): Promise<void> {\n        this.braintreeCardComponent = undefined;\n\n        return Promise.resolve();\n    }\n\n    /**\n     *\n     * Braintree Fastlane Component rendering method\n     *\n     */\n    private async initializeCardComponent() {\n        const state = this.paymentIntegrationService.getState();\n        const { phone, firstName, lastName } = state.getBillingAddressOrThrow();\n        const fullName = `${firstName} ${lastName}`;\n\n        const cardComponentOptions: BraintreeFastlaneCardComponentOptions = {\n            styles: {},\n            fields: {\n                cardholderName: {\n                    prefill: fullName,\n                    enabled: true,\n                },\n                ...(phone && {\n                    phoneNumber: {\n                        prefill: phone,\n                    },\n                }),\n            },\n        };\n\n        const paypalPaymentComponent =\n            this.braintreeFastlaneUtils.getBraintreeFastlaneComponentOrThrow();\n\n        this.braintreeCardComponent = await paypalPaymentComponent(cardComponentOptions);\n    }\n\n    private renderBraintreeCardComponent(container?: string) {\n        const braintreeCardComponent = this.getBraintreeCardComponentOrThrow();\n\n        if (!container) {\n            throw new InvalidArgumentError(\n                'Unable to initialize payment because \"container\" argument is not provided.',\n            );\n        }\n\n        braintreeCardComponent.render(container);\n    }\n\n    /**\n     *\n     * Payment Payload preparation methods\n     *\n     */\n    private async preparePaymentPayload(methodId: string): Promise<Payment> {\n        const state = this.paymentIntegrationService.getState();\n        const billingAddress = state.getBillingAddressOrThrow();\n        const fullName = `${billingAddress.firstName} ${billingAddress.lastName}`;\n\n        const paypalInstrument = this.getPayPalInstruments()[0];\n\n        const deviceSessionId = await this.braintreeFastlaneUtils.getDeviceSessionId();\n        const features = state.getStoreConfigOrThrow().checkoutSettings.features;\n        const isThreeDSExperimentEnabled = isExperimentEnabled(\n            features,\n            'PROJECT-7080.braintree_fastlane_three_ds',\n        );\n\n        if (paypalInstrument) {\n            const threeDSToken =\n                this.is3DSEnabled && isThreeDSExperimentEnabled\n                    ? await this.get3DS(paypalInstrument.bigpayToken, paypalInstrument?.iin || '')\n                    : undefined;\n\n            return {\n                methodId,\n                paymentData: {\n                    deviceSessionId,\n                    formattedPayload: {\n                        paypal_fastlane_token: {\n                            token: threeDSToken || paypalInstrument.bigpayToken,\n                        },\n                    },\n                },\n            };\n        }\n\n        const { getPaymentToken } = this.getBraintreeCardComponentOrThrow();\n\n        const paymentToken = await getPaymentToken({\n            name: { fullName },\n            billingAddress: this.mapToPayPalAddress(billingAddress),\n        });\n\n        const binGuest = paymentToken.paymentSource.card?.binDetails?.bin || '';\n        const threeDSToken =\n            this.is3DSEnabled && isThreeDSExperimentEnabled\n                ? await this.get3DS(paymentToken.id, binGuest)\n                : undefined;\n\n        return {\n            methodId,\n            paymentData: {\n                deviceSessionId,\n                nonce: threeDSToken || paymentToken.id,\n            },\n        };\n    }\n\n    /**\n     * 3DS\n     */\n    private async get3DS(nonce: string, bin: string): Promise<string> {\n        const state = this.paymentIntegrationService.getState();\n        const threeDSecure = await this.braintreeSdk.getBraintreeThreeDS();\n        const order = state.getOrderOrThrow();\n\n        return new Promise<string>((resolve, reject) => {\n            void threeDSecure.verifyCard(\n                {\n                    amount: order?.orderAmount,\n                    nonce,\n                    bin,\n                    onLookupComplete: (_data, next) => {\n                        threeDSecure.on('customer-canceled', () => {\n                            if (typeof this.onError === 'function') {\n                                this.onError(new PaymentMethodCancelledError());\n                            }\n\n                            reject(new PaymentMethodCancelledError());\n                        });\n\n                        next();\n                    },\n                },\n                (\n                    verifyError: Braintree3DSVerifyCardError,\n                    payload: Braintree3DSVerifyCardPayload,\n                ) => {\n                    if (\n                        verifyError &&\n                        verifyError.code === 'THREEDS_VERIFY_CARD_CANCELED_BY_MERCHANT'\n                    ) {\n                        if (typeof this.onError === 'function') {\n                            this.onError(new PaymentMethodCancelledError());\n                        }\n\n                        reject(new PaymentMethodCancelledError());\n                    }\n\n                    return resolve(payload.nonce);\n                },\n            );\n        });\n    }\n\n    /**\n     *\n     * Mapper methods\n     *\n     */\n    private mapToPayPalAddress(address?: Address): BraintreeFastlaneAddress {\n        return {\n            streetAddress: address?.address1 || '',\n            locality: address?.city || '',\n            region: address?.stateOrProvinceCode || address?.stateOrProvince || '',\n            postalCode: address?.postalCode || '',\n            countryCodeAlpha2: address?.countryCode || '',\n        };\n    }\n\n    /**\n     *\n     * Other methods\n     *\n     */\n    private shouldRunAuthenticationFlow(): boolean {\n        const state = this.paymentIntegrationService.getState();\n        const cart = state.getCartOrThrow();\n        const customer = state.getCustomerOrThrow();\n        const paymentProviderCustomer = state.getPaymentProviderCustomer();\n        const braintreePaymentProviderCustomer = isBraintreeAcceleratedCheckoutCustomer(\n            paymentProviderCustomer,\n        )\n            ? paymentProviderCustomer\n            : {};\n\n        const paypalFastlaneSessionId = this.braintreeFastlaneUtils.getSessionIdFromCookies();\n\n        if (\n            !customer.isGuest ||\n            braintreePaymentProviderCustomer?.authenticationState ===\n                BraintreeFastlaneAuthenticationState.CANCELED\n        ) {\n            return false;\n        }\n\n        return (\n            !braintreePaymentProviderCustomer?.authenticationState &&\n            paypalFastlaneSessionId === cart.id\n        );\n    }\n\n    private getBraintreeCardComponentOrThrow() {\n        if (!this.braintreeCardComponent) {\n            throw new PaymentMethodClientUnavailableError();\n        }\n\n        return this.braintreeCardComponent;\n    }\n\n    private getPayPalInstruments(): CardInstrument[] {\n        const state = this.paymentIntegrationService.getState();\n        const paymentProviderCustomer = state.getPaymentProviderCustomerOrThrow();\n        const braintreePaymentProviderCustomer = isBraintreeAcceleratedCheckoutCustomer(\n            paymentProviderCustomer,\n        )\n            ? paymentProviderCustomer\n            : {};\n\n        return braintreePaymentProviderCustomer.instruments || [];\n    }\n\n    /**\n     *\n     * Braintree Fastlane instrument change\n     *\n     */\n    private async handleBraintreeStoredInstrumentChange(\n        methodId: string,\n    ): Promise<CardInstrument | undefined> {\n        const paypalAxoSdk = this.braintreeFastlaneUtils.getBraintreeFastlaneOrThrow();\n\n        const { selectionChanged, selectedCard } = await paypalAxoSdk.profile.showCardSelector();\n\n        if (selectionChanged) {\n            const state = this.paymentIntegrationService.getState();\n            const paymentProviderCustomer = state.getPaymentProviderCustomer();\n            const braintreeFastlaneCustomer = isBraintreeAcceleratedCheckoutCustomer(\n                paymentProviderCustomer,\n            )\n                ? paymentProviderCustomer\n                : {};\n\n            const selectedInstruments = this.braintreeFastlaneUtils.mapPayPalToBcInstrument(\n                methodId,\n                [selectedCard],\n            );\n\n            if (selectedInstruments && selectedInstruments.length > 0) {\n                await this.paymentIntegrationService.updatePaymentProviderCustomer({\n                    ...braintreeFastlaneCustomer,\n                    instruments: [...selectedInstruments],\n                });\n\n                return selectedInstruments[0];\n            }\n        }\n\n        return undefined;\n    }\n}\n","interface CookieOptions {\n    expires?: Date;\n    path?: string;\n    domain?: string;\n    secure?: boolean;\n}\n\nexport default class CookieStorage {\n    static get(name: string): string | null {\n        const cookieKey = `${encodeURIComponent(`${name}`)}=`;\n        const cookie = document.cookie;\n\n        let value = null;\n\n        const firstIndex = cookie.indexOf(cookieKey);\n\n        if (firstIndex > -1) {\n            let lastIndex = cookie.indexOf(';', firstIndex);\n\n            if (lastIndex === -1) {\n                lastIndex = cookie.length;\n            }\n\n            value = decodeURIComponent(cookie.substring(firstIndex + cookieKey.length, lastIndex));\n        }\n\n        return value;\n    }\n\n    static set(name: string, value: string, options: CookieOptions = { secure: true }) {\n        let cookieText = `${encodeURIComponent(name)}=${encodeURIComponent(value)}`;\n\n        const { expires, path, domain, secure } = options;\n\n        if (expires) {\n            cookieText += `; expires=${expires.toUTCString()}`;\n        } else {\n            const now = new Date();\n            // info: default cookie expiration time after setup\n            const minutes = 60;\n\n            now.setTime(now.getTime() + minutes * 60 * 1000);\n\n            cookieText += `; expires=${now.toUTCString()}`;\n        }\n\n        if (path) {\n            cookieText += `; path=${path}`;\n        }\n\n        if (domain) {\n            cookieText += `; domain=${domain}`;\n        }\n\n        if (secure) {\n            cookieText += '; secure';\n        }\n\n        document.cookie = cookieText;\n    }\n\n    static remove(name: string, options?: CookieOptions) {\n        CookieStorage.set(name, '', { expires: new Date(0), ...options });\n    }\n}\n","import { isEqual, omit } from 'lodash';\n\nimport {\n    BraintreeFastlane,\n    BraintreeFastlaneAddress,\n    BraintreeFastlaneAuthenticationState,\n    BraintreeFastlaneProfileData,\n    BraintreeFastlaneStylesOption,\n    BraintreeFastlaneVaultedInstrument,\n    BraintreeInitializationData,\n    BraintreeIntegrationService,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    CardInstrument,\n    CustomerAddress,\n    InvalidArgumentError,\n    MissingDataError,\n    MissingDataErrorType,\n    PaymentIntegrationService,\n    PaymentMethodClientUnavailableError,\n    UntrustedShippingCardVerificationType,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\nimport { CookieStorage } from '@bigcommerce/checkout-sdk/storage';\n\nexport default class BraintreeFastlaneUtils {\n    private braintreeFastlane?: BraintreeFastlane;\n    private methodId?: string;\n\n    constructor(\n        private paymentIntegrationService: PaymentIntegrationService,\n        private braintreeIntegrationService: BraintreeIntegrationService,\n    ) {}\n\n    async getDeviceSessionId(): Promise<string | undefined> {\n        const cart = this.paymentIntegrationService.getState().getCart();\n\n        return this.braintreeIntegrationService.getSessionId(cart?.id);\n    }\n\n    /**\n     *\n     * Initialization method\n     *\n     */\n    async initializeBraintreeFastlaneOrThrow(\n        methodId: string,\n        styles?: BraintreeFastlaneStylesOption,\n    ) {\n        const state = this.paymentIntegrationService.getState();\n        const cart = state.getCart();\n        const { clientToken, config } =\n            state.getPaymentMethodOrThrow<BraintreeInitializationData>(methodId);\n\n        if (!clientToken) {\n            throw new MissingDataError(MissingDataErrorType.MissingPaymentMethod);\n        }\n\n        this.methodId = methodId;\n\n        this.braintreeIntegrationService.initialize(clientToken);\n\n        this.braintreeFastlane = await this.braintreeIntegrationService.getBraintreeFastlane(\n            cart?.id,\n            config.testMode,\n            styles,\n        );\n    }\n\n    getBraintreeFastlaneOrThrow(): BraintreeFastlane {\n        if (!this.braintreeFastlane) {\n            throw new PaymentMethodClientUnavailableError();\n        }\n\n        return this.braintreeFastlane;\n    }\n\n    getBraintreeFastlaneComponentOrThrow(): BraintreeFastlane['FastlaneCardComponent'] {\n        const braintreeFastlane = this.getBraintreeFastlaneOrThrow();\n\n        return braintreeFastlane.FastlaneCardComponent;\n    }\n\n    /**\n     *\n     * Authentication methods\n     *\n     * */\n    // Remove this rule disabling after method refactor\n    // eslint-disable-next-line complexity\n    async runPayPalAuthenticationFlowOrThrow(\n        email?: string,\n        shouldSetShippingOption?: boolean,\n    ): Promise<void> {\n        try {\n            const methodId = this.getMethodIdOrThrow();\n            const braintreeFastlane = this.getBraintreeFastlaneOrThrow();\n            const { lookupCustomerByEmail, triggerAuthenticationFlow } = braintreeFastlane.identity;\n\n            const state = this.paymentIntegrationService.getState();\n            const cart = state.getCartOrThrow();\n            const customer = state.getCustomer();\n            const billingAddress = state.getBillingAddress();\n            const { isFastlaneShippingOptionAutoSelectEnabled } =\n                state.getPaymentMethodOrThrow<BraintreeInitializationData>(methodId)\n                    .initializationData || {};\n\n            const customerEmail = email || customer?.email || billingAddress?.email || '';\n\n            const { customerContextId } = await lookupCustomerByEmail(customerEmail);\n\n            if (!customerContextId) {\n                // Info: we should clean up previous experience with default data and related authenticationState\n                await this.paymentIntegrationService.updatePaymentProviderCustomer({\n                    authenticationState: BraintreeFastlaneAuthenticationState.UNRECOGNIZED,\n                    addresses: [],\n                    instruments: [],\n                });\n\n                this.saveSessionIdToCookies(cart.id);\n\n                return;\n            }\n\n            const { authenticationState, profileData } = await triggerAuthenticationFlow(\n                customerContextId,\n            );\n\n            const phoneNumber = profileData?.shippingAddress?.phoneNumber || '';\n\n            if (authenticationState === BraintreeFastlaneAuthenticationState.CANCELED) {\n                await this.paymentIntegrationService.updatePaymentProviderCustomer({\n                    authenticationState,\n                    addresses: [],\n                    instruments: [],\n                });\n\n                this.removeSessionIdFromCookies();\n\n                return;\n            }\n\n            const shippingAddresses =\n                this.mapPayPalToBcAddress([profileData.shippingAddress], [phoneNumber]) || [];\n            const paypalBillingAddress = this.getPayPalBillingAddresses(profileData);\n            const billingAddresses = paypalBillingAddress\n                ? this.mapPayPalToBcAddress([paypalBillingAddress], [phoneNumber])\n                : [];\n            const instruments = profileData.card\n                ? this.mapPayPalToBcInstrument(methodId, [profileData.card])\n                : [];\n            const addresses = this.mergeShippingAndBillingAddresses(\n                shippingAddresses,\n                billingAddresses,\n            );\n\n            this.saveSessionIdToCookies(cart.id);\n\n            await this.paymentIntegrationService.updatePaymentProviderCustomer({\n                authenticationState,\n                addresses,\n                instruments,\n            });\n\n            if (billingAddresses.length > 0 && cart.lineItems.physicalItems.length > 0) {\n                await this.paymentIntegrationService.updateBillingAddress(billingAddresses[0]);\n            }\n\n            // Prefill billing form if only digital items in cart with billing data and firstName and lastName\n            // from shippingAddresses because there are empty in billing\n            if (\n                billingAddresses.length > 0 &&\n                cart.lineItems.digitalItems.length > 0 &&\n                cart.lineItems.physicalItems.length === 0\n            ) {\n                const { firstName, lastName } = addresses[0];\n                const digitalItemBilling = {\n                    ...billingAddresses[0],\n                    firstName,\n                    lastName,\n                };\n\n                await this.paymentIntegrationService.updateBillingAddress(digitalItemBilling);\n            }\n\n            if (shippingAddresses.length > 0 && cart.lineItems.physicalItems.length > 0) {\n                await this.paymentIntegrationService.updateShippingAddress(shippingAddresses[0]);\n\n                if (shouldSetShippingOption && isFastlaneShippingOptionAutoSelectEnabled) {\n                    await this.setShippingOption();\n                }\n            }\n        } catch (error) {\n            // TODO: we should figure out what to do here\n            // TODO: because we should not to stop the flow if the error occurs on paypal side\n        }\n    }\n\n    /**\n     *\n     * Session id management\n     *\n     */\n    getSessionIdFromCookies(): string {\n        return CookieStorage.get('bc-fastlane-sessionId') || '';\n    }\n\n    saveSessionIdToCookies(sessionId: string): void {\n        const expires = new Date();\n\n        expires.setDate(expires.getDate() + 14); // 2 weeks expiry\n\n        CookieStorage.set('bc-fastlane-sessionId', sessionId, {\n            expires,\n            secure: true,\n        });\n    }\n\n    removeSessionIdFromCookies(): void {\n        CookieStorage.remove('bc-fastlane-sessionId');\n    }\n\n    /**\n     *\n     * PayPal to BC data mappers\n     *\n     * */\n    mapPayPalToBcInstrument(\n        methodId: string,\n        instruments?: BraintreeFastlaneVaultedInstrument[],\n    ): CardInstrument[] | undefined {\n        if (!instruments) {\n            return;\n        }\n\n        return instruments.map((instrument) => {\n            const { id, paymentSource } = instrument;\n            const { brand, expiry, lastDigits, binDetails } = paymentSource.card;\n\n            const [expiryYear, expiryMonth] = expiry.split('-');\n\n            return {\n                bigpayToken: id,\n                brand,\n                defaultInstrument: false,\n                expiryMonth,\n                expiryYear,\n                iin: binDetails?.bin || '',\n                last4: lastDigits,\n                method: methodId,\n                provider: methodId,\n                trustedShippingAddress: false,\n                type: 'card',\n                untrustedShippingCardVerificationMode: UntrustedShippingCardVerificationType.PAN,\n            };\n        });\n    }\n\n    private mapPayPalToBcAddress(\n        addresses?: BraintreeFastlaneAddress[],\n        phones?: string[],\n    ): CustomerAddress[] {\n        if (!addresses) {\n            return [];\n        }\n\n        const countries = this.paymentIntegrationService.getState().getCountries() || [];\n\n        const getCountryNameByCountryCode = (countryCode: string) => {\n            const matchedCountry = countries.find((country) => country.code === countryCode);\n\n            return matchedCountry?.name || '';\n        };\n\n        return addresses.map((address) => ({\n            id: Date.now(),\n            type: 'paypal-address',\n            firstName: address.firstName || '',\n            lastName: address.lastName || '',\n            company: address.company || '',\n            address1: address.streetAddress,\n            address2: address.extendedAddress || '',\n            city: address.locality,\n            stateOrProvince: address.region,\n            stateOrProvinceCode: address.region,\n            country: getCountryNameByCountryCode(address.countryCodeAlpha2),\n            countryCode: address.countryCodeAlpha2,\n            postalCode: address.postalCode,\n            phone: (phones && phones[0]) || '',\n            customFields: [],\n        }));\n    }\n\n    /**\n     *\n     * Get PayPal billing addresses from stored braintree instruments info\n     *\n     * */\n    private getPayPalBillingAddresses(\n        profileData?: BraintreeFastlaneProfileData,\n    ): BraintreeFastlaneAddress | undefined {\n        const { card, name } = profileData || {};\n\n        if (!card) {\n            return;\n        }\n\n        const { firstName, lastName } = card.paymentSource.card.billingAddress;\n        const { firstName: given_name, lastName: surname } = name || {};\n        const { shippingAddress } = profileData || {};\n        const address = {\n            ...card.paymentSource.card.billingAddress,\n            firstName: firstName || given_name,\n            lastName: lastName || surname,\n        };\n\n        const isAddressExist =\n            shippingAddress &&\n            isEqual(this.normalizeAddress(address), this.normalizeAddress(shippingAddress));\n\n        return isAddressExist ? shippingAddress : address;\n    }\n\n    private normalizeAddress(address: CustomerAddress | BraintreeFastlaneAddress) {\n        return omit(address, ['id']);\n    }\n\n    private mergeShippingAndBillingAddresses(\n        shippingAddresses: CustomerAddress[],\n        billingAddresses: CustomerAddress[],\n    ): CustomerAddress[] {\n        const filteredBillingAddresses = billingAddresses.filter(\n            (billingAddress: CustomerAddress) =>\n                !shippingAddresses.some((shippingAddress: CustomerAddress) => {\n                    return isEqual(\n                        this.normalizeAddress(shippingAddress),\n                        this.normalizeAddress(billingAddress),\n                    );\n                }),\n        );\n\n        return [...shippingAddresses, ...filteredBillingAddresses];\n    }\n\n    /**\n     *\n     * Other\n     *\n     * */\n    private getMethodIdOrThrow(): string {\n        if (!this.methodId) {\n            throw new InvalidArgumentError(\n                'Unable to proceed because \"methodId\" argument is not provided.',\n            );\n        }\n\n        return this.methodId;\n    }\n\n    private async setShippingOption(): Promise<void> {\n        const state = this.paymentIntegrationService.getState();\n        const consignments = state.getConsignments() || [];\n        const availableShippingOptions = consignments[0]?.availableShippingOptions || [];\n        const recommendedShippingOption = availableShippingOptions.find(\n            (option) => option.isRecommended,\n        );\n\n        if (recommendedShippingOption || availableShippingOptions.length) {\n            const selectedOption = recommendedShippingOption || availableShippingOptions[0];\n\n            await this.paymentIntegrationService.selectShippingOption(selectedOption.id);\n        }\n    }\n}\n","import { getScriptLoader } from '@bigcommerce/script-loader';\n\nimport {\n    BraintreeHostWindow,\n    BraintreeIntegrationService,\n    BraintreeScriptLoader,\n    BraintreeSdk,\n    BraintreeSDKVersionManager,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    PaymentStrategyFactory,\n    toResolvableModule,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport BraintreeFastlanePaymentStrategy from './braintree-fastlane-payment-strategy';\nimport BraintreeFastlaneUtils from './braintree-fastlane-utils';\n\nconst createBraintreeFastlanePaymentStrategy: PaymentStrategyFactory<\n    BraintreeFastlanePaymentStrategy\n> = (paymentIntegrationService) => {\n    const braintreeHostWindow: BraintreeHostWindow = window;\n    const braintreeSDKVersionManager = new BraintreeSDKVersionManager(paymentIntegrationService);\n    const braintreeIntegrationService = new BraintreeIntegrationService(\n        new BraintreeScriptLoader(\n            getScriptLoader(),\n            braintreeHostWindow,\n            braintreeSDKVersionManager,\n        ),\n        braintreeHostWindow,\n    );\n\n    const braintreeFastlaneUtils = new BraintreeFastlaneUtils(\n        paymentIntegrationService,\n        braintreeIntegrationService,\n    );\n\n    const braintreeScriptLoader = new BraintreeScriptLoader(\n        getScriptLoader(),\n        braintreeHostWindow,\n        braintreeSDKVersionManager,\n    );\n\n    const braintreeSdk = new BraintreeSdk(braintreeScriptLoader);\n\n    return new BraintreeFastlanePaymentStrategy(\n        paymentIntegrationService,\n        braintreeFastlaneUtils,\n        braintreeSdk,\n    );\n};\n\nexport default toResolvableModule(createBraintreeFastlanePaymentStrategy, [\n    { id: 'braintreeacceleratedcheckout' },\n]);\n","import { FormPoster } from '@bigcommerce/form-poster';\nimport { noop } from 'lodash';\n\nimport {\n    BraintreeDataCollector,\n    BraintreeInitializationData,\n    BraintreeSdk,\n    BraintreeVisaCheckout,\n    VisaCheckoutAddress,\n    VisaCheckoutPaymentSuccessPayload,\n    VisaCheckoutTokenizedPayload,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    Address,\n    InvalidArgumentError,\n    LegacyAddress,\n    MissingDataError,\n    MissingDataErrorType,\n    OrderFinalizationNotRequiredError,\n    OrderRequestBody,\n    PaymentInitializeOptions,\n    PaymentIntegrationService,\n    PaymentMethod,\n    PaymentMethodFailedError,\n    PaymentRequestOptions,\n    PaymentStrategy,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport { WithBraintreeVisaCheckoutPaymentInitializeOptions } from './braintree-visa-checkout-payment-options';\n\nexport default class BraintreeVisaCheckoutPaymentStrategy implements PaymentStrategy {\n    private paymentMethod?: PaymentMethod<BraintreeInitializationData>;\n\n    constructor(\n        private paymentIntegrationService: PaymentIntegrationService,\n        private formPoster: FormPoster,\n        private braintreeSdk: BraintreeSdk,\n    ) {}\n\n    async initialize(\n        options: PaymentInitializeOptions & WithBraintreeVisaCheckoutPaymentInitializeOptions,\n    ): Promise<void> {\n        const { braintreevisacheckout: visaCheckoutOptions, methodId } = options;\n\n        if (!visaCheckoutOptions) {\n            throw new InvalidArgumentError(\n                'Unable to initialize payment because \"options.braintreevisacheckout\" argument is not provided.',\n            );\n        }\n\n        await this.paymentIntegrationService.loadPaymentMethod(methodId);\n\n        const state = this.paymentIntegrationService.getState();\n\n        this.paymentMethod = state.getPaymentMethodOrThrow(methodId);\n\n        const checkout = state.getCheckoutOrThrow();\n        const storeConfig = state.getStoreConfigOrThrow();\n\n        const { clientToken, config } = this.paymentMethod || {};\n\n        if (!clientToken) {\n            throw new MissingDataError(MissingDataErrorType.MissingPaymentMethod);\n        }\n\n        const { onError = noop, onPaymentSelect = noop } = visaCheckoutOptions;\n\n        this.braintreeSdk.initialize(clientToken);\n\n        const braintreeVisaCheckout = await this.braintreeSdk.getBraintreeVisaCheckout();\n\n        const visaCheckoutSdk = await this.braintreeSdk.getVisaCheckoutSdk(config?.testMode);\n\n        const initOptions = braintreeVisaCheckout.createInitOptions({\n            settings: {\n                locale: storeConfig.storeProfile.storeLanguage,\n                shipping: {\n                    collectShipping: false,\n                },\n            },\n            paymentRequest: {\n                currencyCode: storeConfig.currency.code,\n                subtotal: String(checkout.subtotal),\n            },\n        });\n\n        await visaCheckoutSdk.init(initOptions);\n\n        visaCheckoutSdk.on(\n            'payment.success',\n            (paymentSuccessPayload: VisaCheckoutPaymentSuccessPayload) =>\n                this.tokenizePayment(braintreeVisaCheckout, paymentSuccessPayload)\n                    .then(() =>\n                        Promise.all([\n                            this.paymentIntegrationService.loadCheckout(),\n                            this.paymentIntegrationService.loadPaymentMethod(methodId),\n                        ]),\n                    )\n                    .then(() => onPaymentSelect())\n                    .catch((error) => onError(error)),\n        );\n        visaCheckoutSdk.on('payment.error', (_, error) => onError(error));\n    }\n\n    async execute(payload: OrderRequestBody, options?: PaymentRequestOptions): Promise<void> {\n        const { payment, ...order } = payload;\n\n        if (!payment) {\n            throw new InvalidArgumentError(\n                'Unable to submit payment because \"payload.payment\" argument is not provided.',\n            );\n        }\n\n        if (!this.paymentMethod?.initializationData?.nonce) {\n            throw new MissingDataError(MissingDataErrorType.MissingPaymentMethod);\n        }\n\n        const { nonce } = this.paymentMethod.initializationData;\n\n        try {\n            await this.paymentIntegrationService.submitOrder(order, options);\n            await this.paymentIntegrationService.submitPayment({\n                ...payment,\n                paymentData: { nonce },\n            });\n        } catch (error) {\n            this.handleError(error);\n        }\n    }\n\n    finalize(): Promise<any> {\n        return Promise.reject(new OrderFinalizationNotRequiredError());\n    }\n\n    async deinitialize(): Promise<void> {\n        await this.braintreeSdk.deinitialize();\n    }\n\n    private async tokenizePayment(\n        braintreeVisaCheckout: BraintreeVisaCheckout,\n        payment: VisaCheckoutPaymentSuccessPayload,\n    ) {\n        return Promise.all([\n            braintreeVisaCheckout.tokenize(payment),\n            this.braintreeSdk.getDataCollectorOrThrow(),\n        ]).then(([payload, deviceData]) => {\n            const state = this.paymentIntegrationService.getState();\n\n            const shipping = state.getShippingAddress();\n            const billing = state.getBillingAddress();\n\n            const {\n                shippingAddress = this.mapToVisaCheckoutAddress(shipping),\n                billingAddress = this.mapToVisaCheckoutAddress(billing),\n            } = payload;\n\n            return this.postForm(\n                {\n                    ...payload,\n                    shippingAddress,\n                    billingAddress,\n                },\n                deviceData,\n            );\n        });\n    }\n\n    private mapToVisaCheckoutAddress(address?: Address): VisaCheckoutAddress {\n        if (!address) {\n            return {};\n        }\n\n        return {\n            firstName: address.firstName,\n            lastName: address.lastName,\n            phoneNumber: address.phone,\n            streetAddress: address.address1,\n            extendedAddress: address.address2,\n            locality: address.city,\n            region: address.stateOrProvinceCode,\n            countryCode: address.countryCode,\n            postalCode: address.postalCode,\n        };\n    }\n\n    private postForm(\n        paymentData: VisaCheckoutTokenizedPayload,\n        dataCollector: BraintreeDataCollector,\n    ) {\n        const { userData, billingAddress, shippingAddress, details: cardInformation } = paymentData;\n        const { userEmail } = userData;\n        const { deviceData } = dataCollector;\n\n        return this.formPoster.postForm('/checkout.php', {\n            payment_type: paymentData.type,\n            nonce: paymentData.nonce,\n            provider: 'braintreevisacheckout',\n            action: 'set_external_checkout',\n            device_data: deviceData,\n            card_information: JSON.stringify({\n                type: cardInformation.cardType,\n                number: cardInformation.lastTwo,\n            }),\n            billing_address: JSON.stringify(this.getAddress(userEmail, billingAddress)),\n            shipping_address: JSON.stringify(this.getAddress(userEmail, shippingAddress)),\n        });\n    }\n\n    private getAddress(email: string, address: VisaCheckoutAddress = {}): Partial<LegacyAddress> {\n        return {\n            email,\n            first_name: address.firstName,\n            last_name: address.lastName,\n            phone_number: address.phoneNumber,\n            address_line_1: address.streetAddress,\n            address_line_2: address.extendedAddress,\n            city: address.locality,\n            state: address.region,\n            country_code: address.countryCode,\n            postal_code: address.postalCode,\n        };\n    }\n\n    private handleError(error: unknown): never {\n        if (error instanceof Error && error.name === 'BraintreeError') {\n            throw new PaymentMethodFailedError(error.message);\n        }\n\n        throw error;\n    }\n}\n","import { createFormPoster } from '@bigcommerce/form-poster';\nimport { getScriptLoader } from '@bigcommerce/script-loader';\n\nimport {\n    BraintreeHostWindow,\n    BraintreeScriptLoader,\n    BraintreeSdk,\n    BraintreeSDKVersionManager,\n    VisaCheckoutHostWindow,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    PaymentStrategyFactory,\n    toResolvableModule,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport BraintreeVisaCheckoutPaymentStrategy from './braintree-visa-checkout-payment-strategy';\n\nconst createBraintreeVisaCheckoutPaymentStrategy: PaymentStrategyFactory<\n    BraintreeVisaCheckoutPaymentStrategy\n> = (paymentIntegrationService) => {\n    const hostWindow: VisaCheckoutHostWindow & BraintreeHostWindow = window;\n    const braintreeSDKVersionManager = new BraintreeSDKVersionManager(paymentIntegrationService);\n    const braintreeSdk = new BraintreeSdk(\n        new BraintreeScriptLoader(getScriptLoader(), hostWindow, braintreeSDKVersionManager),\n    );\n\n    return new BraintreeVisaCheckoutPaymentStrategy(\n        paymentIntegrationService,\n        createFormPoster(),\n        braintreeSdk,\n    );\n};\n\nexport default toResolvableModule(createBraintreeVisaCheckoutPaymentStrategy, [\n    { id: 'braintreevisacheckout' },\n]);\n","import {\n    BraintreeError,\n    BraintreeIntegrationService,\n    BraintreeTokenizePayload,\n    BraintreeVenmoCheckout,\n    isBraintreeError,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    FormattedPayload,\n    MissingDataError,\n    MissingDataErrorType,\n    OrderFinalizationNotRequiredError,\n    OrderPaymentRequestBody,\n    OrderRequestBody,\n    Payment,\n    PaymentArgumentInvalidError,\n    PaymentInitializeOptions,\n    PaymentIntegrationService,\n    PaymentMethod,\n    PaymentMethodCancelledError,\n    PaymentMethodFailedError,\n    PaymentStrategy,\n    PaypalInstrument,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\nimport { isExperimentEnabled } from '@bigcommerce/checkout-sdk/utility';\nimport BraintreeVenmoPaymentStrategyInitializeOptions, {\n    WithBraintreeVenmoInitializeOptions,\n} from './braintree-venmo-payment-strategy-initialize-options';\n\nexport default class BraintreeVenmoPaymentStrategy implements PaymentStrategy {\n    private braintreeVenmoCheckout?: BraintreeVenmoCheckout;\n    private venmoOptions?: BraintreeVenmoPaymentStrategyInitializeOptions;\n\n    constructor(\n        private paymentIntegrationService: PaymentIntegrationService,\n        private braintreeIntegrationService: BraintreeIntegrationService,\n    ) {}\n\n    async initialize(\n        options: PaymentInitializeOptions & WithBraintreeVenmoInitializeOptions,\n    ): Promise<void> {\n        const { methodId } = options;\n\n        await this.paymentIntegrationService.loadPaymentMethod(methodId);\n        const state = this.paymentIntegrationService.getState();\n\n        this.venmoOptions = options.braintreevenmo;\n\n        const paymentMethod = state.getPaymentMethodOrThrow(methodId);\n\n        await this.initializeBraintreeVenmo(paymentMethod);\n    }\n\n    async execute(orderRequest: OrderRequestBody): Promise<void> {\n        const { payment, ...order } = orderRequest;\n\n        if (!payment) {\n            throw new PaymentArgumentInvalidError(['payment']);\n        }\n\n        try {\n            const paymentData = await this.preparePaymentData(payment);\n            await this.paymentIntegrationService.submitOrder(order);\n            await this.paymentIntegrationService.submitPayment(paymentData);\n        } catch (error) {\n            this.handleError(error);\n        }\n    }\n\n    finalize(): Promise<void> {\n        return Promise.reject(new OrderFinalizationNotRequiredError());\n    }\n\n    async deinitialize(): Promise<void> {\n        await this.braintreeIntegrationService.teardown();\n\n        return Promise.resolve();\n    }\n\n    private handleError(error: unknown): never {\n        if (!isBraintreeError(error)) {\n            throw error;\n        }\n\n        if (error.code === 'PAYPAL_POPUP_CLOSED') {\n            throw new PaymentMethodCancelledError(error.message);\n        }\n\n        throw new PaymentMethodFailedError(error.message);\n    }\n\n    private async initializeBraintreeVenmo(paymentMethod: PaymentMethod): Promise<void> {\n        const { clientToken } = paymentMethod;\n\n        if (!clientToken) {\n            throw new MissingDataError(MissingDataErrorType.MissingPaymentMethod);\n        }\n\n        const state = this.paymentIntegrationService.getState();\n        const features = state.getStoreConfigOrThrow().checkoutSettings.features;\n        const isBraintreeVenmoWebFallbackSupport = isExperimentEnabled(\n            features,\n            'PAYPAL-5406.braintree_venmo_web_fallback_support',\n        );\n\n        try {\n            this.braintreeIntegrationService.initialize(clientToken);\n            this.braintreeVenmoCheckout = await this.braintreeIntegrationService.getVenmoCheckout({\n                ...(this.venmoOptions?.allowDesktop !== undefined\n                    ? { allowDesktop: this.venmoOptions.allowDesktop }\n                    : {}),\n                ...(isBraintreeVenmoWebFallbackSupport\n                    ? {\n                          mobileWebFallBack: isBraintreeVenmoWebFallbackSupport,\n                      }\n                    : {}),\n            });\n        } catch (error) {\n            this.handleError(error);\n        }\n    }\n\n    private async preparePaymentData(payment: OrderPaymentRequestBody): Promise<Payment> {\n        const state = this.paymentIntegrationService.getState();\n        const { nonce } = state.getPaymentMethodOrThrow(payment.methodId);\n\n        if (nonce) {\n            return { ...payment, paymentData: this.formattedPayload(nonce) };\n        }\n        const tokenizeResult = await this.braintreeVenmoTokenize();\n        const sessionId = await this.braintreeIntegrationService.getSessionId();\n\n        return {\n            ...payment,\n            paymentData: this.formattedPayload(\n                tokenizeResult.nonce,\n                tokenizeResult.details.email,\n                sessionId,\n            ),\n        };\n    }\n\n    private formattedPayload(\n        token: string,\n        email?: string,\n        sessionId?: string,\n    ): FormattedPayload<PaypalInstrument> {\n        return {\n            formattedPayload: {\n                vault_payment_instrument: null,\n                set_as_default_stored_instrument: null,\n                device_info: sessionId || null,\n                paypal_account: {\n                    token,\n                    email: email || null,\n                },\n            },\n        };\n    }\n\n    private braintreeVenmoTokenize(): Promise<BraintreeTokenizePayload> {\n        return new Promise((resolve, reject) => {\n            this.braintreeVenmoCheckout?.tokenize(\n                (error: BraintreeError | undefined, payload: BraintreeTokenizePayload) => {\n                    if (error) {\n                        return reject(error);\n                    }\n\n                    resolve(payload);\n                },\n            );\n        });\n    }\n}\n","import {\n    CheckoutButtonStrategyFactory,\n    toResolvableModule,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\nimport BraintreeVenmoPaymentStrategy from './braintree-venmo-payment-strategy';\nimport {\n    BraintreeHostWindow,\n    BraintreeIntegrationService,\n    BraintreeScriptLoader,\n    BraintreeSDKVersionManager,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport { getScriptLoader } from '@bigcommerce/script-loader';\n\nconst createBraintreeVenmoPaymentStrategy: CheckoutButtonStrategyFactory<\n    BraintreeVenmoPaymentStrategy\n> = (paymentIntegrationService) => {\n    const braintreeHostWindow: BraintreeHostWindow = window;\n    const scriptLoader = getScriptLoader();\n    const braintreeSDKVersionManager = new BraintreeSDKVersionManager(paymentIntegrationService);\n    const braintreeScriptLoader = new BraintreeScriptLoader(\n        scriptLoader,\n        braintreeHostWindow,\n        braintreeSDKVersionManager,\n    );\n    const braintreeIntegrationService = new BraintreeIntegrationService(\n        braintreeScriptLoader,\n        braintreeHostWindow,\n    );\n\n    return new BraintreeVenmoPaymentStrategy(\n        paymentIntegrationService,\n        braintreeIntegrationService,\n    );\n};\n\nexport default toResolvableModule(createBraintreeVenmoPaymentStrategy, [{ id: 'braintreevenmo' }]);\n","import { some } from 'lodash';\n\nimport {\n    BraintreeIntegrationService,\n    BraintreeThreeDSecureOptions,\n    isBraintreeAcceleratedCheckoutCustomer,\n    isBraintreePaymentRequest3DSError,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    Address,\n    isHostedInstrumentLike,\n    isRequestError,\n    isVaultedInstrument,\n    MissingDataError,\n    MissingDataErrorType,\n    NonceInstrument,\n    OrderFinalizationNotRequiredError,\n    OrderPaymentRequestBody,\n    OrderRequestBody,\n    PaymentArgumentInvalidError,\n    PaymentInitializeOptions,\n    PaymentInstrument,\n    PaymentInstrumentMeta,\n    PaymentIntegrationService,\n    PaymentMethod,\n    PaymentMethodFailedError,\n    PaymentStrategy,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport BraintreeHostedForm from '../braintree-hosted-form/braintree-hosted-form';\nimport isBraintreeError from '../is-braintree-error';\n\nimport { WithBraintreeCreditCardPaymentInitializeOptions } from './braintree-credit-card-payment-initialize-options';\n\nexport default class BraintreeCreditCardPaymentStrategy implements PaymentStrategy {\n    private is3dsEnabled?: boolean;\n    private isHostedFormInitialized?: boolean;\n    private deviceSessionId?: string;\n    private paymentMethod?: PaymentMethod;\n    private threeDSecure?: BraintreeThreeDSecureOptions;\n\n    constructor(\n        private paymentIntegrationService: PaymentIntegrationService,\n        private braintreeIntegrationService: BraintreeIntegrationService,\n        private braintreeHostedForm: BraintreeHostedForm,\n    ) {}\n\n    async initialize(\n        options: PaymentInitializeOptions & WithBraintreeCreditCardPaymentInitializeOptions,\n    ): Promise<void> {\n        const { methodId, gatewayId, braintree } = options;\n\n        await this.paymentIntegrationService.loadPaymentMethod(methodId);\n\n        const state = this.paymentIntegrationService.getState();\n\n        this.paymentMethod = state.getPaymentMethodOrThrow(methodId);\n\n        const { clientToken } = this.paymentMethod;\n\n        if (!clientToken) {\n            throw new MissingDataError(MissingDataErrorType.MissingPaymentMethod);\n        }\n\n        this.threeDSecure = braintree?.threeDSecure;\n\n        try {\n            this.braintreeIntegrationService.initialize(clientToken, this.threeDSecure);\n\n            if (this.isHostedPaymentFormEnabled(methodId, gatewayId) && braintree?.form) {\n                await this.braintreeHostedForm.initialize(\n                    braintree.form,\n                    braintree.unsupportedCardBrands,\n                    clientToken,\n                );\n\n                this.isHostedFormInitialized = this.braintreeHostedForm.isInitialized();\n            }\n\n            this.is3dsEnabled = this.paymentMethod.config.is3dsEnabled;\n            this.deviceSessionId = await this.braintreeIntegrationService.getSessionId();\n\n            // TODO: Remove when BT AXO A/B testing is finished\n            if (this.shouldInitializeBraintreeFastlane()) {\n                await this.initializeBraintreeFastlaneOrThrow(methodId);\n            }\n        } catch (error) {\n            return this.handleError(error, methodId);\n        }\n    }\n\n    async execute(orderRequest: OrderRequestBody): Promise<void> {\n        const { payment, ...order } = orderRequest;\n\n        if (!payment) {\n            throw new PaymentArgumentInvalidError(['payment']);\n        }\n\n        if (this.isHostedFormInitialized) {\n            this.braintreeHostedForm.validate();\n        }\n\n        await this.paymentIntegrationService.submitOrder(order);\n\n        const state = this.paymentIntegrationService.getState();\n        const billingAddress = state.getBillingAddressOrThrow();\n        const orderAmount = state.getOrderOrThrow().orderAmount;\n\n        try {\n            const paymentData = this.isHostedFormInitialized\n                ? await this.prepareHostedPaymentData(payment, billingAddress, orderAmount)\n                : await this.preparePaymentData(payment, billingAddress, orderAmount);\n\n            await this.paymentIntegrationService.submitPayment({\n                ...payment,\n                paymentData,\n            });\n        } catch (error) {\n            return this.processAdditionalAction(error, payment, orderAmount);\n        }\n    }\n\n    finalize(): Promise<void> {\n        return Promise.reject(new OrderFinalizationNotRequiredError());\n    }\n\n    async deinitialize(): Promise<void> {\n        this.isHostedFormInitialized = false;\n\n        await Promise.all([\n            this.braintreeIntegrationService.teardown(),\n            this.braintreeHostedForm.deinitialize(),\n        ]);\n\n        return Promise.resolve();\n    }\n\n    private handleError(error: unknown, methodId?: string): void {\n        if (isBraintreeError(error)) {\n            const isPaymentMethodInitialized = !!(\n                methodId &&\n                this.paymentIntegrationService.getState().isPaymentMethodInitialized({ methodId })\n            );\n\n            if (\n                !isPaymentMethodInitialized &&\n                error.code === 'HOSTED_FIELDS_INVALID_FIELD_SELECTOR'\n            ) {\n                return;\n            }\n\n            throw new PaymentMethodFailedError(error.message);\n        }\n\n        throw error;\n    }\n\n    private async preparePaymentData(\n        payment: OrderPaymentRequestBody,\n        billingAddress: Address,\n        orderAmount: number,\n    ): Promise<PaymentInstrument & PaymentInstrumentMeta> {\n        const { paymentData } = payment;\n        const commonPaymentData = { deviceSessionId: this.deviceSessionId };\n\n        if (this.isSubmittingWithStoredCard(payment)) {\n            return {\n                ...commonPaymentData,\n                ...paymentData,\n            };\n        }\n\n        const { shouldSaveInstrument = false, shouldSetAsDefaultInstrument = false } =\n            isHostedInstrumentLike(paymentData) ? paymentData : {};\n\n        const { nonce } = this.shouldPerform3DSVerification(payment)\n            ? await this.braintreeIntegrationService.verifyCard(\n                  payment,\n                  billingAddress,\n                  orderAmount,\n              )\n            : await this.braintreeIntegrationService.tokenizeCard(payment, billingAddress);\n\n        return {\n            ...commonPaymentData,\n            nonce,\n            shouldSaveInstrument,\n            shouldSetAsDefaultInstrument,\n        };\n    }\n\n    private async prepareHostedPaymentData(\n        payment: OrderPaymentRequestBody,\n        billingAddress: Address,\n        orderAmount: number,\n    ): Promise<PaymentInstrument & PaymentInstrumentMeta> {\n        const { paymentData } = payment;\n        const commonPaymentData = { deviceSessionId: this.deviceSessionId };\n\n        if (this.isSubmittingWithStoredCard(payment)) {\n            const { nonce } = await this.braintreeHostedForm.tokenizeForStoredCardVerification();\n\n            return {\n                ...commonPaymentData,\n                ...paymentData,\n                nonce,\n            };\n        }\n\n        const { shouldSaveInstrument = false, shouldSetAsDefaultInstrument = false } =\n            isHostedInstrumentLike(paymentData) ? paymentData : {};\n\n        const { nonce } = this.shouldPerform3DSVerification(payment)\n            ? await this.verifyCardWithHostedForm(billingAddress, orderAmount)\n            : await this.braintreeHostedForm.tokenize(billingAddress);\n\n        return {\n            ...commonPaymentData,\n            shouldSaveInstrument,\n            shouldSetAsDefaultInstrument,\n            nonce,\n        };\n    }\n\n    private async verifyCardWithHostedForm(\n        billingAddress: Address,\n        orderAmount: number,\n    ): Promise<NonceInstrument> {\n        const tokenizationPayload = await this.braintreeHostedForm.tokenize(billingAddress);\n\n        return this.braintreeIntegrationService.challenge3DSVerification(\n            tokenizationPayload,\n            orderAmount,\n        );\n    }\n\n    private async processAdditionalAction(\n        error: unknown,\n        payment: OrderPaymentRequestBody,\n        orderAmount: number,\n    ): Promise<void> {\n        if (\n            !isRequestError(error) ||\n            !some(error.body.errors, { code: 'three_d_secure_required' })\n        ) {\n            return this.handleError(error);\n        }\n\n        try {\n            const { payer_auth_request: storedCreditCardNonce } =\n                (isBraintreePaymentRequest3DSError(error) && error.body.three_ds_result) || {};\n            const { paymentData } = payment;\n            const state = this.paymentIntegrationService.getState();\n\n            if (!paymentData || !isVaultedInstrument(paymentData)) {\n                throw new PaymentArgumentInvalidError(['instrumentId']);\n            }\n\n            const instrument = state.getCardInstrumentOrThrow(paymentData.instrumentId);\n            const { nonce } = await this.braintreeIntegrationService.challenge3DSVerification(\n                {\n                    nonce: storedCreditCardNonce || '',\n                    bin: instrument.iin,\n                },\n                orderAmount,\n            );\n\n            await this.paymentIntegrationService.submitPayment({\n                ...payment,\n                paymentData: {\n                    deviceSessionId: this.deviceSessionId,\n                    nonce,\n                },\n            });\n        } catch (error) {\n            return this.handleError(error);\n        }\n    }\n\n    private isHostedPaymentFormEnabled(methodId?: string, gatewayId?: string): boolean {\n        if (!methodId) {\n            return false;\n        }\n\n        const state = this.paymentIntegrationService.getState();\n        const paymentMethod = state.getPaymentMethodOrThrow(methodId, gatewayId);\n\n        return paymentMethod.config.isHostedFormEnabled === true;\n    }\n\n    private isSubmittingWithStoredCard(payment: OrderPaymentRequestBody): boolean {\n        return !!(payment.paymentData && isVaultedInstrument(payment.paymentData));\n    }\n\n    private shouldPerform3DSVerification(payment: OrderPaymentRequestBody): boolean {\n        return !!(this.is3dsEnabled && !this.isSubmittingWithStoredCard(payment));\n    }\n\n    // TODO: Remove when BT AXO A/B testing is finished\n    private shouldInitializeBraintreeFastlane(): boolean {\n        const state = this.paymentIntegrationService.getState();\n        const paymentProviderCustomer = state.getPaymentProviderCustomerOrThrow();\n        const braintreeCustomer = isBraintreeAcceleratedCheckoutCustomer(paymentProviderCustomer)\n            ? paymentProviderCustomer\n            : {};\n        const isFastlaneEnabled: boolean =\n            this.paymentMethod?.initializationData.isAcceleratedCheckoutEnabled;\n\n        return isFastlaneEnabled && !braintreeCustomer?.authenticationState;\n    }\n\n    // TODO: Remove when BT AXO A/B testing is finished\n    private async initializeBraintreeFastlaneOrThrow(methodId: string): Promise<void> {\n        const state = this.paymentIntegrationService.getState();\n        const cart = state.getCartOrThrow();\n        const paymentMethod = state.getPaymentMethodOrThrow(methodId);\n        const { clientToken, config } = paymentMethod;\n\n        if (!clientToken) {\n            throw new MissingDataError(MissingDataErrorType.MissingPaymentMethod);\n        }\n\n        this.braintreeIntegrationService.initialize(clientToken, this.threeDSecure);\n\n        await this.braintreeIntegrationService.getBraintreeFastlane(cart.id, config.testMode);\n    }\n}\n","import RequestError from './request-error';\n\n// Have to use `as` https://stackoverflow.com/questions/73987044/typeguarding-an-unknown-nested-object should be fixed in 4.8+\nconst isRequestError = (error: unknown): error is RequestError => {\n    return typeof error === 'object' && error !== null && 'body' in error;\n};\n\nexport default isRequestError;\n","export interface BraintreePayment3DSRequestErrors {\n    code: string;\n}\n\nexport interface BraintreePaymentRequest3DSError {\n    name: string;\n    body: {\n        status: string;\n        three_ds_result: {\n            payer_auth_request: string;\n        };\n        errors: BraintreePayment3DSRequestErrors[];\n    };\n}\n\nexport default function isBraintreePaymentRequest3DSError(\n    error: unknown,\n): error is BraintreePaymentRequest3DSError {\n    if (typeof error !== 'object' || error === null) {\n        return false;\n    }\n    /* eslint-disable @typescript-eslint/consistent-type-assertions */\n    return (\n        'name' in error &&\n        'body' in error &&\n        'status' in (error as BraintreePaymentRequest3DSError).body &&\n        'three_ds_result' in (error as BraintreePaymentRequest3DSError).body &&\n        'payer_auth_request' in (error as BraintreePaymentRequest3DSError).body.three_ds_result &&\n        'errors' in (error as BraintreePaymentRequest3DSError).body\n    );\n}\n","import { BraintreeFormFieldsMap, BraintreeStoredCardFieldsMap } from '../index';\n\nexport function isBraintreeFormFieldsMap(\n    fields: BraintreeFormFieldsMap | BraintreeStoredCardFieldsMap,\n): fields is BraintreeFormFieldsMap {\n    return 'cardNumber' in fields;\n}\n\nexport function isBraintreeStoredCardFieldsMap(\n    fields: BraintreeFormFieldsMap | BraintreeStoredCardFieldsMap,\n): fields is BraintreeStoredCardFieldsMap {\n    return !!(\n        Object.keys(fields).length > 0 &&\n        // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n        ((fields as BraintreeStoredCardFieldsMap).cardCodeVerification ||\n            // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n            (fields as BraintreeStoredCardFieldsMap).cardNumberVerification)\n    );\n}\n","import isBraintreeError from './is-braintree-error';\nimport { BraintreeHostedFormError } from '../types';\n\nfunction isValidInvalidFieldKeys(invalidFieldKeys: unknown): invalidFieldKeys is string[] {\n    return (\n        Array.isArray(invalidFieldKeys) && invalidFieldKeys.every((key) => typeof key === 'string')\n    );\n}\n\nexport default function isBraintreeHostedFormError(\n    error: unknown,\n): error is BraintreeHostedFormError {\n    if (!isBraintreeError(error)) {\n        return false;\n    }\n\n    const { details } = error;\n\n    return (\n        details === undefined ||\n        (typeof details === 'object' &&\n            details !== null &&\n            // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n            (details as { invalidFieldKeys?: unknown }).invalidFieldKeys === undefined) ||\n        isValidInvalidFieldKeys(details)\n    );\n}\n","import { Dictionary, isEmpty, isNil, omitBy } from 'lodash';\n\nimport {\n    BRAINTREE_SDK_HOSTED_FIELDS_FIX_VERSION,\n    BraintreeBillingAddressRequestData,\n    BraintreeClient,\n    BraintreeFormErrorDataKeys,\n    BraintreeFormErrorsData,\n    BraintreeFormFieldsMap,\n    BraintreeFormFieldStyles,\n    BraintreeFormFieldStylesMap,\n    BraintreeFormFieldType,\n    BraintreeFormFieldValidateErrorData,\n    BraintreeFormFieldValidateEventData,\n    BraintreeFormOptions,\n    BraintreeHostedFields,\n    BraintreeHostedFieldsCreatorConfig,\n    BraintreeHostedFieldsState,\n    BraintreeHostedFormError,\n    BraintreeScriptLoader,\n    BraintreeSDKVersionManager,\n    BraintreeStoredCardFieldsMap,\n    isBraintreeFormFieldsMap,\n    isBraintreeHostedFormError,\n    isBraintreeSupportedCardBrand,\n    TokenizationPayload,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    Address,\n    NotInitializedError,\n    NotInitializedErrorType,\n    PaymentInvalidFormError,\n    PaymentInvalidFormErrorDetails,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nenum BraintreeHostedFormType {\n    CreditCard,\n    StoredCardVerification,\n}\n\nexport default class BraintreeHostedForm {\n    private cardFields?: BraintreeHostedFields;\n    private formOptions?: BraintreeFormOptions;\n    private type?: BraintreeHostedFormType;\n    private client?: Promise<BraintreeClient>;\n    private clientToken?: string;\n    private isInitializedHostedForm = false;\n\n    constructor(\n        private braintreeScriptLoader: BraintreeScriptLoader,\n        private braintreeSDKVersionManager: BraintreeSDKVersionManager,\n    ) {}\n\n    async initialize(\n        options: BraintreeFormOptions,\n        unsupportedCardBrands?: string[],\n        clientToken?: string,\n    ): Promise<void> {\n        this.clientToken = clientToken;\n        this.formOptions = options;\n        this.type = isBraintreeFormFieldsMap(options.fields)\n            ? BraintreeHostedFormType.CreditCard\n            : BraintreeHostedFormType.StoredCardVerification;\n\n        const fields = this.mapFieldOptions(options.fields, unsupportedCardBrands);\n\n        if (isEmpty(fields)) {\n            this.isInitializedHostedForm = false;\n\n            return;\n        }\n\n        this.cardFields = await this.createHostedFields({\n            fields,\n            styles: options.styles && this.mapStyleOptions(options.styles),\n        });\n\n        this.cardFields?.on('blur', this.handleBlur);\n        this.cardFields?.on('focus', this.handleFocus);\n        this.cardFields?.on('cardTypeChange', this.handleCardTypeChange);\n        this.cardFields?.on('validityChange', this.handleValidityChange);\n        this.cardFields?.on('inputSubmitRequest', this.handleInputSubmitRequest);\n\n        this.isInitializedHostedForm = true;\n    }\n\n    isInitialized(): boolean {\n        return !!this.isInitializedHostedForm;\n    }\n\n    async deinitialize(): Promise<void> {\n        if (this.isInitializedHostedForm) {\n            this.isInitializedHostedForm = false;\n            await this.cardFields?.teardown();\n        }\n    }\n\n    validate(): void {\n        if (!this.cardFields) {\n            throw new NotInitializedError(NotInitializedErrorType.PaymentNotInitialized);\n        }\n\n        const state = this.cardFields.getState();\n\n        if (!this.isValidForm(state)) {\n            this.handleValidityChange(state);\n\n            const errors = this.mapValidationErrors(state.fields);\n\n            throw new PaymentInvalidFormError(errors as PaymentInvalidFormErrorDetails);\n        }\n    }\n\n    async tokenize(billingAddress: Address): Promise<TokenizationPayload> {\n        if (!this.cardFields) {\n            throw new NotInitializedError(NotInitializedErrorType.PaymentNotInitialized);\n        }\n\n        try {\n            const payload = await this.cardFields.tokenize(\n                omitBy(\n                    {\n                        billingAddress: billingAddress && this.mapBillingAddress(billingAddress),\n                    },\n                    isNil,\n                ),\n            );\n\n            this.formOptions?.onValidate?.({ isValid: true, errors: {} });\n\n            return {\n                nonce: payload.nonce,\n                bin: payload.details?.bin,\n            };\n        } catch (error) {\n            if (isBraintreeHostedFormError(error)) {\n                const errors = this.mapTokenizeError(error);\n\n                if (errors) {\n                    this.formOptions?.onValidate?.({ isValid: false, errors });\n                    throw new PaymentInvalidFormError(errors as PaymentInvalidFormErrorDetails);\n                }\n            }\n\n            throw error;\n        }\n    }\n\n    async tokenizeForStoredCardVerification(): Promise<TokenizationPayload> {\n        if (!this.cardFields) {\n            throw new NotInitializedError(NotInitializedErrorType.PaymentNotInitialized);\n        }\n\n        try {\n            const payload = await this.cardFields.tokenize();\n\n            this.formOptions?.onValidate?.({ isValid: true, errors: {} });\n\n            return {\n                nonce: payload.nonce,\n                bin: payload.details?.bin,\n            };\n        } catch (error) {\n            if (isBraintreeHostedFormError(error)) {\n                const errors = this.mapTokenizeError(error, true);\n\n                if (errors) {\n                    this.formOptions?.onValidate?.({ isValid: false, errors });\n                    throw new PaymentInvalidFormError(errors as PaymentInvalidFormErrorDetails);\n                }\n            }\n\n            throw error;\n        }\n    }\n\n    async createHostedFields(\n        options: Pick<BraintreeHostedFieldsCreatorConfig, 'fields' | 'styles'>,\n    ): Promise<BraintreeHostedFields> {\n        const client = await this.getClient();\n        const hostedFields = await this.braintreeScriptLoader.loadHostedFields();\n\n        const currentSdkVersion = this.braintreeSDKVersionManager.getSDKVersion();\n        const hostedFieldsOptions =\n            currentSdkVersion === BRAINTREE_SDK_HOSTED_FIELDS_FIX_VERSION\n                ? { ...options, preventCursorJumps: true }\n                : options;\n\n        return hostedFields.create({ ...hostedFieldsOptions, client });\n    }\n\n    async getClient(): Promise<BraintreeClient> {\n        if (!this.clientToken) {\n            throw new NotInitializedError(NotInitializedErrorType.PaymentNotInitialized);\n        }\n\n        if (!this.client) {\n            const client = await this.braintreeScriptLoader.loadClient();\n\n            this.client = client.create({ authorization: this.clientToken });\n        }\n\n        return this.client;\n    }\n\n    private mapBillingAddress(billingAddress: Address): BraintreeBillingAddressRequestData {\n        return {\n            countryName: billingAddress.country,\n            postalCode: billingAddress.postalCode,\n            streetAddress: billingAddress.address2\n                ? `${billingAddress.address1} ${billingAddress.address2}`\n                : billingAddress.address1,\n        };\n    }\n\n    private mapFieldOptions(\n        fields: BraintreeFormFieldsMap | BraintreeStoredCardFieldsMap,\n        unsupportedCardBrands?: string[],\n    ): BraintreeHostedFieldsCreatorConfig['fields'] {\n        if (isBraintreeFormFieldsMap(fields)) {\n            const supportedCardBrands: Partial<Record<string, boolean>> = {};\n\n            unsupportedCardBrands?.forEach((cardBrand) => {\n                if (isBraintreeSupportedCardBrand(cardBrand)) {\n                    supportedCardBrands[cardBrand] = false;\n                }\n            });\n\n            return omitBy(\n                {\n                    number: {\n                        container: `#${fields.cardNumber.containerId}`,\n                        placeholder: fields.cardNumber.placeholder,\n                        internalLabel: fields.cardNumber.accessibilityLabel,\n                        ...(Object.keys(supportedCardBrands).length > 0\n                            ? { supportedCardBrands }\n                            : {}),\n                    },\n                    expirationDate: {\n                        container: `#${fields.cardExpiry.containerId}`,\n                        placeholder: fields.cardExpiry.placeholder,\n                        internalLabel: fields.cardExpiry.accessibilityLabel,\n                    },\n                    cvv: fields.cardCode && {\n                        container: `#${fields.cardCode.containerId}`,\n                        placeholder: fields.cardCode.placeholder,\n                        internalLabel: fields.cardCode.accessibilityLabel,\n                    },\n                    cardholderName: {\n                        container: `#${fields.cardName.containerId}`,\n                        placeholder: fields.cardName.placeholder,\n                        internalLabel: fields.cardName.accessibilityLabel,\n                    },\n                },\n                isNil,\n            );\n        }\n\n        return omitBy(\n            {\n                number: fields.cardNumberVerification && {\n                    container: `#${fields.cardNumberVerification.containerId}`,\n                    placeholder: fields.cardNumberVerification.placeholder,\n                },\n                cvv: fields.cardCodeVerification && {\n                    container: `#${fields.cardCodeVerification.containerId}`,\n                    placeholder: fields.cardCodeVerification.placeholder,\n                },\n            },\n            isNil,\n        );\n    }\n\n    private mapStyleOptions(\n        options: BraintreeFormFieldStylesMap,\n    ): BraintreeHostedFieldsCreatorConfig['styles'] {\n        const mapStyles = (styles: BraintreeFormFieldStyles = {}) =>\n            omitBy(\n                {\n                    color: styles.color,\n                    'font-family': styles.fontFamily,\n                    'font-size': styles.fontSize,\n                    'font-weight': styles.fontWeight,\n                },\n                isNil,\n            ) as Dictionary<string>;\n\n        return {\n            input: mapStyles(options.default),\n            '.invalid': mapStyles(options.error),\n            ':focus': mapStyles(options.focus),\n        };\n    }\n\n    private mapFieldType(type: string): BraintreeFormFieldType {\n        switch (type) {\n            case 'number':\n                return this.type === BraintreeHostedFormType.StoredCardVerification\n                    ? BraintreeFormFieldType.CardNumberVerification\n                    : BraintreeFormFieldType.CardNumber;\n\n            case 'expirationDate':\n                return BraintreeFormFieldType.CardExpiry;\n\n            case 'cvv':\n                return this.type === BraintreeHostedFormType.StoredCardVerification\n                    ? BraintreeFormFieldType.CardCodeVerification\n                    : BraintreeFormFieldType.CardCode;\n\n            case 'cardholderName':\n                return BraintreeFormFieldType.CardName;\n\n            default:\n                throw new Error('Unexpected field type');\n        }\n    }\n\n    private mapErrors(fields: BraintreeHostedFieldsState['fields']): BraintreeFormErrorsData {\n        const errors: BraintreeFormErrorsData = {};\n\n        if (fields) {\n            // eslint-disable-next-line no-restricted-syntax\n            for (const [key, value] of Object.entries(fields)) {\n                if (value && this.isValidParam(key)) {\n                    const { isValid, isEmpty, isPotentiallyValid } = value;\n\n                    errors[key] = {\n                        isValid,\n                        isEmpty,\n                        isPotentiallyValid,\n                    };\n                }\n            }\n        }\n\n        return errors;\n    }\n\n    private mapValidationErrors(\n        fields: BraintreeHostedFieldsState['fields'],\n    ): BraintreeFormFieldValidateEventData['errors'] {\n        return (Object.keys(fields) as Array<keyof BraintreeHostedFieldsState['fields']>).reduce(\n            (result, fieldKey) => ({\n                ...result,\n                [this.mapFieldType(fieldKey)]: fields[fieldKey]?.isValid\n                    ? undefined\n                    : [this.createInvalidError(this.mapFieldType(fieldKey))],\n            }),\n            {},\n        );\n    }\n\n    private mapTokenizeError(\n        error: BraintreeHostedFormError,\n        isStoredCard = false,\n    ): BraintreeFormFieldValidateEventData['errors'] | undefined {\n        if (error.code === 'HOSTED_FIELDS_FIELDS_EMPTY') {\n            const cvv = [this.createRequiredError(this.mapFieldType('cvv'))];\n\n            if (isStoredCard) {\n                return { [this.mapFieldType('cvv')]: cvv };\n            }\n\n            return {\n                [this.mapFieldType('cvv')]: cvv,\n                [this.mapFieldType('expirationDate')]: [\n                    this.createRequiredError(this.mapFieldType('expirationDate')),\n                ],\n                [this.mapFieldType('number')]: [\n                    this.createRequiredError(this.mapFieldType('number')),\n                ],\n                [this.mapFieldType('cardholderName')]: [\n                    this.createRequiredError(this.mapFieldType('cardholderName')),\n                ],\n            };\n        }\n\n        return error.details?.invalidFieldKeys?.reduce((result, key) => {\n            const type = this.mapFieldType(key);\n\n            return {\n                ...result,\n                [type]: [this.createInvalidError(type)],\n            };\n        }, {});\n    }\n\n    private createRequiredError(\n        fieldType: BraintreeFormFieldType,\n    ): BraintreeFormFieldValidateErrorData {\n        const messages = {\n            [BraintreeFormFieldType.CardCode]: 'CVV is required',\n            [BraintreeFormFieldType.CardCodeVerification]: 'CVV is required',\n            [BraintreeFormFieldType.CardNumber]: 'Credit card number is required',\n            [BraintreeFormFieldType.CardNumberVerification]: 'Credit card number is required',\n            [BraintreeFormFieldType.CardExpiry]: 'Expiration date is required',\n            [BraintreeFormFieldType.CardName]: 'Full name is required',\n        };\n\n        return {\n            fieldType,\n            message: messages[fieldType] ?? 'Field is required',\n            type: 'required',\n        };\n    }\n\n    private createInvalidError(\n        fieldType: BraintreeFormFieldType,\n    ): BraintreeFormFieldValidateErrorData {\n        const formFields = {\n            [BraintreeFormFieldType.CardCode]: {\n                message: 'Invalid card code',\n                type: 'invalid_card_code',\n            },\n            [BraintreeFormFieldType.CardCodeVerification]: {\n                message: 'Invalid card code',\n                type: 'invalid_card_code',\n            },\n            [BraintreeFormFieldType.CardNumber]: {\n                message: 'Invalid card number',\n                type: 'invalid_card_number',\n            },\n            [BraintreeFormFieldType.CardNumberVerification]: {\n                message: 'Invalid card number',\n                type: 'invalid_card_number',\n            },\n            [BraintreeFormFieldType.CardExpiry]: {\n                message: 'Invalid card expiry',\n                type: 'invalid_card_expiry',\n            },\n            [BraintreeFormFieldType.CardName]: {\n                message: 'Invalid card name',\n                type: 'invalid_card_name',\n            },\n        };\n\n        return {\n            fieldType,\n            message: formFields[fieldType]?.message ?? 'Invalid field',\n            type: formFields[fieldType]?.type ?? 'invalid',\n        };\n    }\n\n    private handleBlur = (event: BraintreeHostedFieldsState): void => {\n        this.formOptions?.onBlur?.({\n            fieldType: this.mapFieldType(event.emittedBy),\n            errors: this.mapErrors(event.fields),\n        });\n    };\n\n    private handleFocus = (event: BraintreeHostedFieldsState): void => {\n        this.formOptions?.onFocus?.({\n            fieldType: this.mapFieldType(event.emittedBy),\n        });\n    };\n\n    private handleCardTypeChange = (event: BraintreeHostedFieldsState): void => {\n        const cardType =\n            event.cards.length === 1\n                ? event.cards[0].type.replace(/^master-card$/, 'mastercard')\n                : undefined;\n\n        this.formOptions?.onCardTypeChange?.({ cardType });\n    };\n\n    private handleInputSubmitRequest = (event: BraintreeHostedFieldsState): void => {\n        this.formOptions?.onEnter?.({\n            fieldType: this.mapFieldType(event.emittedBy),\n        });\n    };\n\n    private handleValidityChange = (event: BraintreeHostedFieldsState): void => {\n        this.formOptions?.onValidate?.({\n            isValid: this.isValidForm(event),\n            errors: this.mapValidationErrors(event.fields),\n        });\n    };\n\n    private isValidForm(event: BraintreeHostedFieldsState): boolean {\n        return (\n            Object.keys(event.fields) as Array<keyof BraintreeHostedFieldsState['fields']>\n        ).every((key) => event.fields[key]?.isValid);\n    }\n\n    private isValidParam(key: string): key is BraintreeFormErrorDataKeys {\n        return [\n            'number',\n            'cvv',\n            'expirationDate',\n            'postalCode',\n            'cardholderName',\n            'cardType',\n        ].includes(key);\n    }\n}\n","import { BraintreeSupportedCardBrands } from '../types';\n\nexport const isBraintreeSupportedCardBrand = (\n    cardBrand: string,\n): cardBrand is BraintreeSupportedCardBrands => {\n    const supportedCardBrands = Object.values(BraintreeSupportedCardBrands);\n\n    // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n    return supportedCardBrands.includes(cardBrand as BraintreeSupportedCardBrands);\n};\n\nexport default isBraintreeSupportedCardBrand;\n","import { getScriptLoader } from '@bigcommerce/script-loader';\n\nimport {\n    BraintreeHostWindow,\n    BraintreeIntegrationService,\n    BraintreeScriptLoader,\n    BraintreeSDKVersionManager,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\n\nimport {\n    PaymentStrategyFactory,\n    toResolvableModule,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport BraintreeCreditCardPaymentStrategy from './braintree-credit-card-payment-strategy';\nimport BraintreeHostedForm from '../braintree-hosted-form/braintree-hosted-form';\n\nconst createBraintreeCreditCardPaymentStrategy: PaymentStrategyFactory<\n    BraintreeCreditCardPaymentStrategy\n> = (paymentIntegrationService) => {\n    const braintreeHostWindow: BraintreeHostWindow = window;\n\n    const braintreeSDKVersionManager = new BraintreeSDKVersionManager(paymentIntegrationService);\n\n    const braintreeScriptLoader = new BraintreeScriptLoader(\n        getScriptLoader(),\n        braintreeHostWindow,\n        braintreeSDKVersionManager,\n    );\n\n    const braintreeIntegrationService = new BraintreeIntegrationService(\n        braintreeScriptLoader,\n        braintreeHostWindow,\n    );\n\n    const braintreeHostedForm = new BraintreeHostedForm(\n        braintreeScriptLoader,\n        braintreeSDKVersionManager,\n    );\n\n    return new BraintreeCreditCardPaymentStrategy(\n        paymentIntegrationService,\n        braintreeIntegrationService,\n        braintreeHostedForm,\n    );\n};\n\nexport default toResolvableModule(createBraintreeCreditCardPaymentStrategy, [{ id: 'braintree' }]);\n","import { FormPoster } from '@bigcommerce/form-poster';\nimport { noop } from 'lodash';\n\nimport {\n    BraintreeError,\n    BraintreeHostWindow,\n    BraintreeInitializationData,\n    BraintreeIntegrationService,\n    BraintreePaypalCheckout,\n    BraintreePaypalSdkCreatorConfig,\n    BraintreeTokenizePayload,\n    isBraintreeError,\n    PaypalAuthorizeData,\n    PaypalStyleOptions,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    CustomerCredentials,\n    CustomerInitializeOptions,\n    CustomerStrategy,\n    DefaultCheckoutButtonHeight,\n    ExecutePaymentMethodCheckoutOptions,\n    InvalidArgumentError,\n    MissingDataError,\n    MissingDataErrorType,\n    PaymentIntegrationService,\n    PaymentMethod,\n    RequestOptions,\n    StandardError,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport BraintreePaypalCustomerInitializeOptions, {\n    WithBraintreePaypalCustomerInitializeOptions,\n} from './braintree-paypal-customer-initialize-options';\n\nexport default class BraintreePaypalCustomerStrategy implements CustomerStrategy {\n    constructor(\n        private paymentIntegrationService: PaymentIntegrationService,\n        private formPoster: FormPoster,\n        private braintreeIntegrationService: BraintreeIntegrationService,\n        private braintreeHostWindow: BraintreeHostWindow,\n    ) {}\n\n    async initialize(\n        options: CustomerInitializeOptions & WithBraintreePaypalCustomerInitializeOptions,\n    ): Promise<void> {\n        const { braintreepaypal, methodId } = options;\n        const { container, onError } = braintreepaypal || {};\n\n        if (!methodId) {\n            throw new InvalidArgumentError(\n                'Unable to initialize payment because \"options.methodId\" argument is not provided.',\n            );\n        }\n\n        if (!braintreepaypal) {\n            throw new InvalidArgumentError(\n                `Unable to initialize payment because \"options.braintreepaypal\" argument is not provided.`,\n            );\n        }\n\n        if (!container) {\n            throw new InvalidArgumentError(\n                `Unable to initialize payment because \"options.braintreepaypal.container\" argument is not provided.`,\n            );\n        }\n\n        let state = this.paymentIntegrationService.getState();\n        let paymentMethod: PaymentMethod<BraintreeInitializationData>;\n\n        try {\n            paymentMethod = state.getPaymentMethodOrThrow(methodId);\n\n            if (!paymentMethod.clientToken) {\n                throw new MissingDataError(MissingDataErrorType.MissingPaymentToken);\n            }\n        } catch (_e) {\n            state = await this.paymentIntegrationService.loadPaymentMethod(methodId);\n            paymentMethod = state.getPaymentMethodOrThrow(methodId);\n        }\n\n        const { clientToken, config, initializationData } = paymentMethod;\n        const { paymentButtonStyles } = initializationData || {};\n        const { checkoutTopButtonStyles } = paymentButtonStyles || {};\n\n        if (!clientToken || !initializationData) {\n            throw new MissingDataError(MissingDataErrorType.MissingPaymentMethod);\n        }\n\n        const currencyCode = state.getCartOrThrow().currency.code;\n        const paypalCheckoutOptions: Partial<BraintreePaypalSdkCreatorConfig> = {\n            currency: currencyCode,\n            intent: initializationData.intent,\n            isCreditEnabled: initializationData.isCreditEnabled,\n            commit: false,\n        };\n\n        const paypalCheckoutSuccessCallback = (\n            braintreePaypalCheckout: BraintreePaypalCheckout,\n        ) => {\n            this.renderPayPalButton(\n                braintreePaypalCheckout,\n                braintreepaypal,\n                methodId,\n                Boolean(config.testMode),\n                checkoutTopButtonStyles,\n            );\n        };\n        const paypalCheckoutErrorCallback = (error: BraintreeError) =>\n            this.handleError(error, container, onError);\n\n        this.braintreeIntegrationService.initialize(clientToken);\n        await this.braintreeIntegrationService.getPaypalCheckout(\n            paypalCheckoutOptions,\n            paypalCheckoutSuccessCallback,\n            paypalCheckoutErrorCallback,\n        );\n    }\n\n    async deinitialize(): Promise<void> {\n        await this.braintreeIntegrationService.teardown();\n    }\n\n    async signIn(credentials: CustomerCredentials, options?: RequestOptions): Promise<void> {\n        await this.paymentIntegrationService.signInCustomer(credentials, options);\n    }\n\n    async signOut(options?: RequestOptions): Promise<void> {\n        await this.paymentIntegrationService.signOutCustomer(options);\n    }\n\n    executePaymentMethodCheckout(options?: ExecutePaymentMethodCheckoutOptions): Promise<void> {\n        options?.continueWithCheckoutCallback?.();\n\n        return Promise.resolve();\n    }\n\n    private renderPayPalButton(\n        braintreePaypalCheckout: BraintreePaypalCheckout,\n        braintreepaypal: BraintreePaypalCustomerInitializeOptions,\n        methodId: string,\n        testMode: boolean,\n        buttonStyles: PaypalStyleOptions,\n    ): void {\n        const { container, onClick = noop } = braintreepaypal;\n\n        const { paypal } = this.braintreeHostWindow;\n        const fundingSource = paypal?.FUNDING.PAYPAL;\n\n        if (paypal && fundingSource) {\n            const paypalButtonRender = paypal.Buttons({\n                env: this.braintreeIntegrationService.getBraintreeEnv(testMode),\n                fundingSource,\n                style: { ...buttonStyles, height: DefaultCheckoutButtonHeight },\n                createOrder: () =>\n                    this.setupPayment(braintreePaypalCheckout, braintreepaypal, methodId),\n                onApprove: (authorizeData: PaypalAuthorizeData) =>\n                    this.tokenizePayment(\n                        authorizeData,\n                        braintreePaypalCheckout,\n                        methodId,\n                        braintreepaypal,\n                    ),\n                onClick,\n            });\n\n            if (paypalButtonRender.isEligible()) {\n                paypalButtonRender.render(`#${container}`);\n            }\n        } else {\n            this.braintreeIntegrationService.removeElement(container);\n        }\n    }\n\n    private async setupPayment(\n        braintreePaypalCheckout: BraintreePaypalCheckout,\n        braintreepaypal: BraintreePaypalCustomerInitializeOptions,\n        methodId: string,\n    ): Promise<string | void> {\n        try {\n            await this.paymentIntegrationService.loadDefaultCheckout();\n\n            const state = this.paymentIntegrationService.getState();\n            const amount = state.getCheckoutOrThrow().outstandingBalance;\n            const currency = state.getCartOrThrow().currency.code;\n            const customer = state.getCustomer();\n            const paymentMethod: PaymentMethod<BraintreeInitializationData> =\n                state.getPaymentMethodOrThrow(methodId);\n            const address = customer?.addresses[0];\n            const shippingAddressOverride = address\n                ? this.braintreeIntegrationService.mapToBraintreeShippingAddressOverride(address)\n                : undefined;\n\n            return await braintreePaypalCheckout.createPayment({\n                flow: 'checkout',\n                enableShippingAddress: true,\n                shippingAddressEditable: false,\n                shippingAddressOverride,\n                amount,\n                currency,\n                offerCredit: false,\n                intent: paymentMethod.initializationData?.intent,\n            });\n        } catch (error) {\n            const { container, onError } = braintreepaypal;\n\n            this.handleError(error, container, onError);\n        }\n    }\n\n    private async tokenizePayment(\n        authorizeData: PaypalAuthorizeData,\n        braintreePaypalCheckout: BraintreePaypalCheckout,\n        methodId: string,\n        braintreepaypal: BraintreePaypalCustomerInitializeOptions,\n    ): Promise<BraintreeTokenizePayload | void> {\n        try {\n            const { deviceData } = await this.braintreeIntegrationService.getDataCollector({\n                paypal: true,\n            });\n            const tokenizePayload = await braintreePaypalCheckout.tokenizePayment(authorizeData);\n            const { details, nonce } = tokenizePayload;\n            const billingAddress =\n                this.braintreeIntegrationService.mapToLegacyBillingAddress(details);\n            const shippingAddress =\n                this.braintreeIntegrationService.mapToLegacyShippingAddress(details);\n\n            this.formPoster.postForm('/checkout.php', {\n                payment_type: 'paypal',\n                provider: methodId,\n                action: 'set_external_checkout',\n                nonce,\n                device_data: deviceData,\n                billing_address: JSON.stringify(billingAddress),\n                shipping_address: JSON.stringify(shippingAddress),\n            });\n\n            return tokenizePayload;\n        } catch (error) {\n            const { container, onError } = braintreepaypal;\n\n            this.handleError(error, container, onError);\n        }\n    }\n\n    private handleError(\n        error: unknown,\n        buttonContainerId: string,\n        onErrorCallback?: (error: BraintreeError | StandardError) => void,\n    ): void {\n        this.braintreeIntegrationService.removeElement(buttonContainerId);\n\n        if (onErrorCallback && isBraintreeError(error)) {\n            onErrorCallback(error);\n        } else {\n            throw error;\n        }\n    }\n}\n","const DefaultCheckoutButtonHeight = 40;\n\nexport default DefaultCheckoutButtonHeight;\n","import { createFormPoster } from '@bigcommerce/form-poster';\nimport { getScriptLoader } from '@bigcommerce/script-loader';\n\nimport {\n    BraintreeHostWindow,\n    BraintreeIntegrationService,\n    BraintreeScriptLoader,\n    BraintreeSDKVersionManager,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    CustomerStrategyFactory,\n    toResolvableModule,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport BraintreePaypalCustomerStrategy from './braintree-paypal-customer-strategy';\n\nconst createBraintreePaypalCustomerStrategy: CustomerStrategyFactory<\n    BraintreePaypalCustomerStrategy\n> = (paymentIntegrationService) => {\n    const braintreeHostWindow: BraintreeHostWindow = window;\n    const braintreeSDKVersionManager = new BraintreeSDKVersionManager(paymentIntegrationService);\n    const braintreeIntegrationService = new BraintreeIntegrationService(\n        new BraintreeScriptLoader(\n            getScriptLoader(),\n            braintreeHostWindow,\n            braintreeSDKVersionManager,\n        ),\n        braintreeHostWindow,\n    );\n\n    return new BraintreePaypalCustomerStrategy(\n        paymentIntegrationService,\n        createFormPoster(),\n        braintreeIntegrationService,\n        braintreeHostWindow,\n    );\n};\n\nexport default toResolvableModule(createBraintreePaypalCustomerStrategy, [\n    { id: 'braintreepaypal' },\n]);\n","import { FormPoster } from '@bigcommerce/form-poster';\nimport { noop } from 'lodash';\n\nimport {\n    BraintreeError,\n    BraintreeHostWindow,\n    BraintreeInitializationData,\n    BraintreeIntegrationService,\n    BraintreePaypalCheckout,\n    BraintreePaypalSdkCreatorConfig,\n    BraintreeTokenizePayload,\n    isBraintreeError,\n    PaypalAuthorizeData,\n    PaypalStyleOptions,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    CustomerCredentials,\n    CustomerInitializeOptions,\n    CustomerStrategy,\n    DefaultCheckoutButtonHeight,\n    ExecutePaymentMethodCheckoutOptions,\n    InvalidArgumentError,\n    MissingDataError,\n    MissingDataErrorType,\n    PaymentIntegrationService,\n    PaymentMethod,\n    RequestOptions,\n    StandardError,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport BraintreePaypalCreditCustomerInitializeOptions, {\n    WithBraintreePaypalCreditCustomerInitializeOptions,\n} from './braintree-paypal-credit-customer-initialize-options';\n\nexport default class BraintreePaypalCreditCustomerStrategy implements CustomerStrategy {\n    constructor(\n        private paymentIntegrationService: PaymentIntegrationService,\n        private formPoster: FormPoster,\n        private braintreeIntegrationService: BraintreeIntegrationService,\n        private braintreeHostWindow: BraintreeHostWindow,\n    ) {}\n\n    async initialize(\n        options: CustomerInitializeOptions & WithBraintreePaypalCreditCustomerInitializeOptions,\n    ): Promise<void> {\n        const { braintreepaypalcredit, methodId } = options;\n        const { container, onError } = braintreepaypalcredit || {};\n\n        if (!methodId) {\n            throw new InvalidArgumentError(\n                'Unable to initialize payment because \"options.methodId\" argument is not provided.',\n            );\n        }\n\n        if (!braintreepaypalcredit) {\n            throw new InvalidArgumentError(\n                `Unable to initialize payment because \"options.braintreepaypalcredit\" argument is not provided.`,\n            );\n        }\n\n        if (!container) {\n            throw new InvalidArgumentError(\n                `Unable to initialize payment because \"options.braintreepaypalcredit.container\" argument is not provided.`,\n            );\n        }\n\n        let state = this.paymentIntegrationService.getState();\n        let paymentMethod: PaymentMethod<BraintreeInitializationData>;\n\n        try {\n            paymentMethod = state.getPaymentMethodOrThrow(methodId);\n\n            if (!paymentMethod.clientToken) {\n                throw new MissingDataError(MissingDataErrorType.MissingPaymentToken);\n            }\n        } catch (_e) {\n            state = await this.paymentIntegrationService.loadPaymentMethod(methodId);\n            paymentMethod = state.getPaymentMethodOrThrow(methodId);\n        }\n\n        const { clientToken, config, initializationData } = paymentMethod;\n        const { paymentButtonStyles } = initializationData || {};\n        const { checkoutTopButtonStyles } = paymentButtonStyles || {};\n\n        if (!clientToken || !initializationData) {\n            throw new MissingDataError(MissingDataErrorType.MissingPaymentMethod);\n        }\n\n        const currencyCode = state.getCartOrThrow().currency.code;\n        const paypalCheckoutOptions: Partial<BraintreePaypalSdkCreatorConfig> = {\n            currency: currencyCode,\n            intent: initializationData.intent,\n            isCreditEnabled: initializationData.isCreditEnabled,\n            commit: false,\n        };\n\n        const paypalCheckoutSuccessCallback = (\n            braintreePaypalCheckout: BraintreePaypalCheckout,\n        ) => {\n            this.renderPayPalButton(\n                braintreePaypalCheckout,\n                braintreepaypalcredit,\n                methodId,\n                Boolean(config.testMode),\n                { ...checkoutTopButtonStyles, height: DefaultCheckoutButtonHeight },\n            );\n        };\n        const paypalCheckoutErrorCallback = (error: BraintreeError) =>\n            this.handleError(error, container, onError);\n\n        this.braintreeIntegrationService.initialize(clientToken);\n        await this.braintreeIntegrationService.getPaypalCheckout(\n            paypalCheckoutOptions,\n            paypalCheckoutSuccessCallback,\n            paypalCheckoutErrorCallback,\n        );\n    }\n\n    async deinitialize(): Promise<void> {\n        await this.braintreeIntegrationService.teardown();\n    }\n\n    async signIn(credentials: CustomerCredentials, options?: RequestOptions): Promise<void> {\n        await this.paymentIntegrationService.signInCustomer(credentials, options);\n    }\n\n    async signOut(options?: RequestOptions): Promise<void> {\n        await this.paymentIntegrationService.signOutCustomer(options);\n    }\n\n    executePaymentMethodCheckout(options?: ExecutePaymentMethodCheckoutOptions): Promise<void> {\n        options?.continueWithCheckoutCallback?.();\n\n        return Promise.resolve();\n    }\n\n    private renderPayPalButton(\n        braintreePaypalCheckout: BraintreePaypalCheckout,\n        braintreepaypalcredit: BraintreePaypalCreditCustomerInitializeOptions,\n        methodId: string,\n        testMode: boolean,\n        buttonStyles: PaypalStyleOptions,\n    ): void {\n        const { container, onClick = noop } = braintreepaypalcredit;\n        const { paypal } = this.braintreeHostWindow;\n\n        let hasRenderedSmartButton = false;\n\n        if (paypal) {\n            const fundingSources = [paypal.FUNDING.PAYLATER, paypal.FUNDING.CREDIT];\n\n            fundingSources.forEach((fundingSource) => {\n                if (!hasRenderedSmartButton) {\n                    const paypalButtonRender = paypal.Buttons({\n                        env: testMode ? 'sandbox' : 'production',\n                        fundingSource,\n                        style: buttonStyles,\n                        createOrder: () =>\n                            this.setupPayment(\n                                braintreePaypalCheckout,\n                                braintreepaypalcredit,\n                                methodId,\n                            ),\n                        onApprove: (authorizeData: PaypalAuthorizeData) =>\n                            this.tokenizePayment(\n                                authorizeData,\n                                braintreePaypalCheckout,\n                                methodId,\n                                braintreepaypalcredit,\n                            ),\n                        onClick,\n                    });\n\n                    if (paypalButtonRender.isEligible()) {\n                        paypalButtonRender.render(`#${container}`);\n                        hasRenderedSmartButton = true;\n                    }\n                }\n            });\n        }\n\n        if (!paypal || !hasRenderedSmartButton) {\n            this.braintreeIntegrationService.removeElement(container);\n        }\n    }\n\n    private async setupPayment(\n        braintreePaypalCheckout: BraintreePaypalCheckout,\n        braintreepaypalcredit: BraintreePaypalCreditCustomerInitializeOptions,\n        methodId: string,\n    ): Promise<string | void> {\n        try {\n            await this.paymentIntegrationService.loadDefaultCheckout();\n\n            const state = this.paymentIntegrationService.getState();\n            const amount = state.getCheckoutOrThrow().outstandingBalance;\n            const currency = state.getCartOrThrow().currency.code;\n            const customer = state.getCustomer();\n            const paymentMethod: PaymentMethod<BraintreeInitializationData> =\n                state.getPaymentMethodOrThrow(methodId);\n            const address = customer?.addresses[0];\n            const shippingAddressOverride = address\n                ? this.braintreeIntegrationService.mapToBraintreeShippingAddressOverride(address)\n                : undefined;\n\n            return await braintreePaypalCheckout.createPayment({\n                flow: 'checkout',\n                enableShippingAddress: true,\n                shippingAddressEditable: false,\n                shippingAddressOverride,\n                amount,\n                currency,\n                offerCredit: true,\n                intent: paymentMethod.initializationData?.intent,\n            });\n        } catch (error) {\n            const { container, onError } = braintreepaypalcredit;\n\n            this.handleError(error, container, onError);\n        }\n    }\n\n    private async tokenizePayment(\n        authorizeData: PaypalAuthorizeData,\n        braintreePaypalCheckout: BraintreePaypalCheckout,\n        methodId: string,\n        braintreepaypalcredit: BraintreePaypalCreditCustomerInitializeOptions,\n    ): Promise<BraintreeTokenizePayload | void> {\n        try {\n            const { deviceData } = await this.braintreeIntegrationService.getDataCollector({\n                paypal: true,\n            });\n            const tokenizePayload = await braintreePaypalCheckout.tokenizePayment(authorizeData);\n            const { details, nonce } = tokenizePayload;\n            const billingAddress =\n                this.braintreeIntegrationService.mapToLegacyBillingAddress(details);\n            const shippingAddress =\n                this.braintreeIntegrationService.mapToLegacyShippingAddress(details);\n\n            this.formPoster.postForm('/checkout.php', {\n                payment_type: 'paypal',\n                provider: methodId,\n                action: 'set_external_checkout',\n                nonce,\n                device_data: deviceData,\n                billing_address: JSON.stringify(billingAddress),\n                shipping_address: JSON.stringify(shippingAddress),\n            });\n\n            return tokenizePayload;\n        } catch (error) {\n            const { container, onError } = braintreepaypalcredit;\n\n            this.handleError(error, container, onError);\n        }\n    }\n\n    private handleError(\n        error: unknown,\n        buttonContainerId: string,\n        onErrorCallback?: (error: BraintreeError | StandardError) => void,\n    ): void {\n        this.braintreeIntegrationService.removeElement(buttonContainerId);\n\n        if (onErrorCallback && isBraintreeError(error)) {\n            onErrorCallback(error);\n        } else {\n            throw error;\n        }\n    }\n}\n","import { createFormPoster } from '@bigcommerce/form-poster';\nimport { getScriptLoader } from '@bigcommerce/script-loader';\n\nimport {\n    BraintreeHostWindow,\n    BraintreeIntegrationService,\n    BraintreeScriptLoader,\n    BraintreeSDKVersionManager,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    CustomerStrategyFactory,\n    toResolvableModule,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport BraintreePaypalCreditCustomerStrategy from './braintree-paypal-credit-customer-strategy';\n\nconst createBraintreePaypalCreditCustomerStrategy: CustomerStrategyFactory<\n    BraintreePaypalCreditCustomerStrategy\n> = (paymentIntegrationService) => {\n    const braintreeHostWindow: BraintreeHostWindow = window;\n    const braintreeSDKVersionManager = new BraintreeSDKVersionManager(paymentIntegrationService);\n    const braintreeIntegrationService = new BraintreeIntegrationService(\n        new BraintreeScriptLoader(\n            getScriptLoader(),\n            braintreeHostWindow,\n            braintreeSDKVersionManager,\n        ),\n        braintreeHostWindow,\n    );\n\n    return new BraintreePaypalCreditCustomerStrategy(\n        paymentIntegrationService,\n        createFormPoster(),\n        braintreeIntegrationService,\n        braintreeHostWindow,\n    );\n};\n\nexport default toResolvableModule(createBraintreePaypalCreditCustomerStrategy, [\n    { id: 'braintreepaypalcredit' },\n]);\n","import {\n    BraintreeInitializationData,\n    getFastlaneStyles,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    CustomerCredentials,\n    CustomerInitializeOptions,\n    CustomerStrategy,\n    ExecutePaymentMethodCheckoutOptions,\n    InvalidArgumentError,\n    PaymentIntegrationService,\n    PaymentMethod,\n    RequestOptions,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport { WithBraintreeFastlaneCustomerInitializeOptions } from './braintree-fastlane-customer-initialize-options';\nimport BraintreeFastlaneUtils from './braintree-fastlane-utils';\n\nexport default class BraintreeFastlaneCustomerStrategy implements CustomerStrategy {\n    private isAcceleratedCheckoutEnabled = false;\n\n    constructor(\n        private paymentIntegrationService: PaymentIntegrationService,\n        private braintreeFastlaneUtils: BraintreeFastlaneUtils,\n    ) {}\n\n    async initialize({\n        methodId,\n        braintreefastlane,\n    }: CustomerInitializeOptions & WithBraintreeFastlaneCustomerInitializeOptions): Promise<void> {\n        if (!methodId) {\n            throw new InvalidArgumentError(\n                'Unable to proceed because \"methodId\" argument is not provided.',\n            );\n        }\n\n        const paymentMethod = await this.getValidPaymentMethodOrThrow(methodId);\n\n        const { isAcceleratedCheckoutEnabled, isFastlaneStylingEnabled } =\n            paymentMethod.initializationData || {};\n\n        const paypalFastlaneStylesSettings = isFastlaneStylingEnabled\n            ? paymentMethod.initializationData?.fastlaneStyles\n            : undefined;\n\n        this.isAcceleratedCheckoutEnabled = !!isAcceleratedCheckoutEnabled;\n\n        try {\n            if (this.isAcceleratedCheckoutEnabled) {\n                const fastlaneStyles = getFastlaneStyles(\n                    paypalFastlaneStylesSettings,\n                    braintreefastlane?.styles,\n                );\n\n                await this.braintreeFastlaneUtils.initializeBraintreeFastlaneOrThrow(\n                    paymentMethod.id,\n                    fastlaneStyles,\n                );\n            }\n        } catch (_) {\n            // Info: Do not throw anything here to avoid blocking customer from passing checkout flow\n        }\n\n        return Promise.resolve();\n    }\n\n    async deinitialize(): Promise<void> {\n        return Promise.resolve();\n    }\n\n    async signIn(credentials: CustomerCredentials, options?: RequestOptions): Promise<void> {\n        await this.paymentIntegrationService.signInCustomer(credentials, options);\n    }\n\n    async signOut(options?: RequestOptions): Promise<void> {\n        await this.paymentIntegrationService.signOutCustomer(options);\n    }\n\n    async executePaymentMethodCheckout(\n        options?: ExecutePaymentMethodCheckoutOptions,\n    ): Promise<void> {\n        const { checkoutPaymentMethodExecuted, continueWithCheckoutCallback } = options || {};\n\n        if (typeof continueWithCheckoutCallback !== 'function') {\n            throw new InvalidArgumentError(\n                'Unable to proceed because \"continueWithCheckoutCallback\" argument is not provided and it must be a function.',\n            );\n        }\n\n        const state = this.paymentIntegrationService.getState();\n        const customer = state.getCustomerOrThrow();\n\n        if (this.isAcceleratedCheckoutEnabled && customer.isGuest) {\n            const shouldRunAuthenticationFlow = await this.shouldRunAuthenticationFlow();\n\n            if (\n                checkoutPaymentMethodExecuted &&\n                typeof checkoutPaymentMethodExecuted === 'function'\n            ) {\n                checkoutPaymentMethodExecuted();\n            }\n\n            if (shouldRunAuthenticationFlow) {\n                await this.braintreeFastlaneUtils.runPayPalAuthenticationFlowOrThrow(\n                    undefined,\n                    true,\n                );\n            }\n        }\n\n        continueWithCheckoutCallback();\n    }\n\n    // TODO: remove this method after A/B testing finished\n    private async shouldRunAuthenticationFlow(): Promise<boolean> {\n        const primaryMethodId = 'braintreeacceleratedcheckout';\n\n        try {\n            // Info: we should load payment method each time to detect if the user\n            // should be in a test or in a control group\n            await this.paymentIntegrationService.loadPaymentMethod(primaryMethodId);\n\n            const state = this.paymentIntegrationService.getState();\n            const paymentMethod =\n                state.getPaymentMethodOrThrow<BraintreeInitializationData>(primaryMethodId);\n\n            // Info: shouldRunAcceleratedCheckout is responsible for the flow of A/B testing purposes\n            // when shouldRunAcceleratedCheckout is true, the lookup PayPal Connect method should be called,\n            // otherwise AcceleratedCheckout should not be available for the customer\n            return paymentMethod.initializationData?.shouldRunAcceleratedCheckout || false;\n        } catch (_) {\n            return false;\n        }\n    }\n\n    private async getValidPaymentMethodOrThrow(\n        methodId: string,\n    ): Promise<PaymentMethod<BraintreeInitializationData>> {\n        let validPaymentMethodId = methodId;\n\n        try {\n            await this.paymentIntegrationService.loadPaymentMethod(validPaymentMethodId);\n        } catch {\n            validPaymentMethodId =\n                methodId === 'braintree' ? 'braintreeacceleratedcheckout' : 'braintree';\n            await this.paymentIntegrationService.loadPaymentMethod(validPaymentMethodId);\n        }\n\n        return this.paymentIntegrationService\n            .getState()\n            .getPaymentMethodOrThrow<BraintreeInitializationData>(validPaymentMethodId);\n    }\n}\n","import { getScriptLoader } from '@bigcommerce/script-loader';\n\nimport {\n    BraintreeHostWindow,\n    BraintreeIntegrationService,\n    BraintreeScriptLoader,\n    BraintreeSDKVersionManager,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    CustomerStrategyFactory,\n    toResolvableModule,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport BraintreeFastlaneCustomerStrategy from './braintree-fastlane-customer-strategy';\nimport BraintreeFastlaneUtils from './braintree-fastlane-utils';\n\nconst createBraintreeFastlaneCustomerStrategy: CustomerStrategyFactory<\n    BraintreeFastlaneCustomerStrategy\n> = (paymentIntegrationService) => {\n    const braintreeHostWindow: BraintreeHostWindow = window;\n    const braintreeSDKVersionManager = new BraintreeSDKVersionManager(paymentIntegrationService);\n    const braintreeIntegrationService = new BraintreeIntegrationService(\n        new BraintreeScriptLoader(\n            getScriptLoader(),\n            braintreeHostWindow,\n            braintreeSDKVersionManager,\n        ),\n        braintreeHostWindow,\n    );\n    const braintreeFastlaneUtils = new BraintreeFastlaneUtils(\n        paymentIntegrationService,\n        braintreeIntegrationService,\n    );\n\n    return new BraintreeFastlaneCustomerStrategy(paymentIntegrationService, braintreeFastlaneUtils);\n};\n\n// Info: braintree method id was added only for A/B testing purposes.\n// The main reason why we can't go in other way, because braintreeacceleratedcheckout\n// may be turned on only when BE knows customer's email address (to understand should we show the feature for the user or not).\n// So { id: 'braintree' }, should be removed after A/B testing\nexport default toResolvableModule(createBraintreeFastlaneCustomerStrategy, [\n    { id: 'braintreeacceleratedcheckout' },\n    { id: 'braintree' },\n]);\n","import StandardError from './standard-error';\n\n/**\n * Throw this error if we try to call a method that is only a stub and has not\n * been fully implemented.\n */\nexport default class NotImplementedError extends StandardError {\n    constructor(message?: string) {\n        super(message || 'Not implemented.');\n\n        this.name = 'NotImplementedError';\n        this.type = 'not_implemented';\n    }\n}\n","import { FormPoster } from '@bigcommerce/form-poster';\nimport { noop } from 'lodash';\n\nimport {\n    BraintreeDataCollector,\n    BraintreeSdk,\n    BraintreeVisaCheckout,\n    VisaCheckoutAddress,\n    VisaCheckoutPaymentSuccessPayload,\n    VisaCheckoutTokenizedPayload,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    Address,\n    CustomerInitializeOptions,\n    CustomerStrategy,\n    ExecutePaymentMethodCheckoutOptions,\n    InvalidArgumentError,\n    LegacyAddress,\n    MissingDataError,\n    MissingDataErrorType,\n    NotImplementedError,\n    PaymentIntegrationService,\n    RequestOptions,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport { WithBraintreeVisaCheckoutCustomerInitializeOptions } from './braintree-visa-customer-initialize-options';\n\nexport default class BraintreeVisaCheckoutCustomerStrategy implements CustomerStrategy {\n    private buttonClassName = 'visa-checkout-wrapper';\n    private onError = noop;\n\n    constructor(\n        private paymentIntegrationService: PaymentIntegrationService,\n        private formPoster: FormPoster,\n        private braintreeSdk: BraintreeSdk,\n    ) {}\n\n    async initialize(\n        options: CustomerInitializeOptions & WithBraintreeVisaCheckoutCustomerInitializeOptions,\n    ): Promise<void> {\n        const { braintreevisacheckout: visaCheckoutOptions, methodId } = options;\n\n        if (!methodId) {\n            throw new InvalidArgumentError(\n                'Unable to proceed because \"methodId\" argument is not provided.',\n            );\n        }\n\n        if (!visaCheckoutOptions) {\n            throw new InvalidArgumentError(\n                'Unable to proceed because \"options.braintreevisacheckout\" argument is not provided.',\n            );\n        }\n\n        await this.paymentIntegrationService.loadPaymentMethod(methodId);\n\n        const state = this.paymentIntegrationService.getState();\n\n        const checkout = state.getCheckoutOrThrow();\n\n        const { clientToken, config } = state.getPaymentMethodOrThrow(methodId);\n\n        const storeConfig = state.getStoreConfigOrThrow();\n\n        if (!clientToken) {\n            throw new MissingDataError(MissingDataErrorType.MissingPaymentMethod);\n        }\n\n        this.braintreeSdk.initialize(clientToken);\n\n        const braintreeVisaCheckout = await this.braintreeSdk.getBraintreeVisaCheckout();\n\n        const visaCheckoutInstance = await this.braintreeSdk.getVisaCheckoutSdk(config.testMode);\n\n        const { container, onError } = visaCheckoutOptions;\n\n        this.onError = onError || noop;\n\n        const initOptions = braintreeVisaCheckout.createInitOptions({\n            paymentRequest: {\n                currencyCode: storeConfig.currency.code,\n                subtotal: String(checkout.subtotal),\n            },\n            settings: {\n                locale: storeConfig.storeProfile.storeLanguage,\n                shipping: {\n                    collectShipping: true,\n                },\n            },\n        });\n\n        const signInButton = this.createSignInButton(container, this.buttonClassName);\n\n        await visaCheckoutInstance.init(initOptions);\n\n        visaCheckoutInstance.on(\n            'payment.success',\n            (paymentSuccessPayload: VisaCheckoutPaymentSuccessPayload) =>\n                this.tokenizePayment(braintreeVisaCheckout, paymentSuccessPayload)\n                    .then(() => this.paymentIntegrationService.loadCheckout())\n                    .catch((error) => this.handleError(error)),\n        );\n\n        visaCheckoutInstance.on('payment.error', (_, error) => this.handleError(error));\n\n        signInButton.style.visibility = 'visible';\n    }\n\n    async deinitialize(): Promise<void> {\n        await this.braintreeSdk.deinitialize();\n    }\n\n    signIn(): Promise<void> {\n        throw new NotImplementedError(\n            'In order to sign in via VisaCheckout, the shopper must click on \"Visa Checkout\" button.',\n        );\n    }\n\n    async signOut(options?: RequestOptions): Promise<void> {\n        await this.paymentIntegrationService.signOutCustomer(options);\n\n        return Promise.resolve();\n    }\n\n    executePaymentMethodCheckout(options?: ExecutePaymentMethodCheckoutOptions): Promise<void> {\n        options?.continueWithCheckoutCallback?.();\n\n        return Promise.resolve();\n    }\n\n    private async tokenizePayment(\n        braintreeVisaCheckout: BraintreeVisaCheckout,\n        payment: VisaCheckoutPaymentSuccessPayload,\n    ) {\n        return Promise.all([\n            braintreeVisaCheckout.tokenize(payment),\n            this.braintreeSdk.getDataCollectorOrThrow(),\n        ]).then(([payload, deviceData]) => {\n            const state = this.paymentIntegrationService.getState();\n\n            const shipping = state.getShippingAddress();\n            const billing = state.getBillingAddress();\n\n            const {\n                shippingAddress = this.mapToVisaCheckoutAddress(shipping),\n                billingAddress = this.mapToVisaCheckoutAddress(billing),\n            } = payload;\n\n            return this.postForm(\n                {\n                    ...payload,\n                    shippingAddress,\n                    billingAddress,\n                },\n                deviceData,\n            );\n        });\n    }\n\n    private postForm(\n        paymentData: VisaCheckoutTokenizedPayload,\n        dataCollector: BraintreeDataCollector,\n    ) {\n        const { userData, billingAddress, shippingAddress, details: cardInformation } = paymentData;\n        const { userEmail } = userData;\n        const { deviceData } = dataCollector;\n\n        return this.formPoster.postForm('/checkout.php', {\n            payment_type: paymentData.type,\n            nonce: paymentData.nonce,\n            provider: 'braintreevisacheckout',\n            action: 'set_external_checkout',\n            device_data: deviceData,\n            card_information: JSON.stringify({\n                type: cardInformation.cardType,\n                number: cardInformation.lastTwo,\n            }),\n            billing_address: JSON.stringify(this.getAddress(userEmail, billingAddress)),\n            shipping_address: JSON.stringify(this.getAddress(userEmail, shippingAddress)),\n        });\n    }\n\n    private mapToVisaCheckoutAddress(address?: Address): VisaCheckoutAddress {\n        if (!address) {\n            return {};\n        }\n\n        return {\n            firstName: address.firstName,\n            lastName: address.lastName,\n            phoneNumber: address.phone,\n            streetAddress: address.address1,\n            extendedAddress: address.address2,\n            locality: address.city,\n            region: address.stateOrProvinceCode,\n            countryCode: address.countryCode,\n            postalCode: address.postalCode,\n        };\n    }\n\n    private getAddress(email: string, address: VisaCheckoutAddress = {}): Partial<LegacyAddress> {\n        return {\n            email,\n            first_name: address.firstName,\n            last_name: address.lastName,\n            phone_number: address.phoneNumber,\n            address_line_1: address.streetAddress,\n            address_line_2: address.extendedAddress,\n            city: address.locality,\n            state: address.region,\n            country_code: address.countryCode,\n            postal_code: address.postalCode,\n        };\n    }\n\n    private createSignInButton(containerId: string, buttonClass: string): HTMLElement {\n        const container = document.querySelector(`#${containerId}`);\n\n        if (!container) {\n            throw new Error('Unable to proceed because the provided container ID is not valid.');\n        }\n\n        return this.insertVisaCheckoutButton(container, buttonClass);\n    }\n\n    private insertVisaCheckoutButton(container: Element, buttonClass: string): HTMLElement {\n        const buttonSource =\n            'https://secure.checkout.visa.com/wallet-services-web/xo/button.png?acceptCanadianVisaDebit=false&cobrand=true&height=34&width=178';\n        const buttonTemplate = `\n            <img\n                alt=\"Visa Checkout\"\n                class=\"v-button\"\n                role=\"button\"\n                src=\"${buttonSource}\"\n                />\n            <a class=\"v-learn v-learn-default\" style=\"text-align: right; display: block; font-size: 10px; color: #003366;\" href=\"#\" data-locale=\"en_US\">Tell Me More</a>`;\n\n        const visaCheckoutButton = document.createElement('div');\n\n        visaCheckoutButton.style.display = 'flex';\n        visaCheckoutButton.style.flexDirection = 'column';\n        visaCheckoutButton.style.visibility = 'hidden';\n        visaCheckoutButton.style.width = 'max-content';\n\n        visaCheckoutButton.className = buttonClass;\n        visaCheckoutButton.innerHTML = buttonTemplate;\n\n        container.appendChild(visaCheckoutButton);\n\n        return visaCheckoutButton;\n    }\n\n    private handleError(error: Error) {\n        if (typeof this.onError === 'function') {\n            this.onError(error);\n        } else {\n            throw error;\n        }\n    }\n}\n","import { createFormPoster } from '@bigcommerce/form-poster';\nimport { getScriptLoader } from '@bigcommerce/script-loader';\n\nimport {\n    BraintreeHostWindow,\n    BraintreeScriptLoader,\n    BraintreeSdk,\n    BraintreeSDKVersionManager,\n    VisaCheckoutHostWindow,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    CustomerStrategyFactory,\n    toResolvableModule,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport BraintreeVisaCheckoutCustomerStrategy from './braintree-visa-checkout-customer-strategy';\n\nconst createBraintreeVisaCheckoutCustomerStrategy: CustomerStrategyFactory<\n    BraintreeVisaCheckoutCustomerStrategy\n> = (paymentIntegrationService) => {\n    const hostWindow: VisaCheckoutHostWindow & BraintreeHostWindow = window;\n    const braintreeSDKVersionManager = new BraintreeSDKVersionManager(paymentIntegrationService);\n    const braintreeSdk = new BraintreeSdk(\n        new BraintreeScriptLoader(getScriptLoader(), hostWindow, braintreeSDKVersionManager),\n    );\n\n    return new BraintreeVisaCheckoutCustomerStrategy(\n        paymentIntegrationService,\n        createFormPoster(),\n        braintreeSdk,\n    );\n};\n\nexport default toResolvableModule(createBraintreeVisaCheckoutCustomerStrategy, [\n    { id: 'braintreevisacheckout' },\n]);\n","import StandardError from './standard-error';\n\n/**\n * This error should be thrown when a shopper tries to sign in as a guest but\n * they are already signed in as a registered customer.\n */\nexport default class BuyNowCartCreationError extends StandardError {\n    constructor(message?: string) {\n        super(\n            message ||\n                'An unexpected error has occurred during buy now cart creation process. Please try again later.',\n        );\n\n        this.name = 'BuyNowCartCreationError';\n        this.type = 'buy_now_cart_creation_error';\n    }\n}\n","import { isNil, omitBy } from 'lodash';\n\nimport { PaypalStyleOptions } from '@bigcommerce/checkout-sdk/braintree-utils';\n\nexport default function getValidButtonStyle(style?: PaypalStyleOptions): PaypalStyleOptions {\n    const { color, fundingicons, height = 40, layout, shape, size, tagline } = style || {};\n\n    const validStyles = {\n        color,\n        fundingicons,\n        height: getValidHeight(height),\n        layout,\n        shape: shape || 'rect',\n        size,\n        tagline,\n    };\n\n    return omitBy(validStyles, isNil);\n}\n\nfunction getValidHeight(height: number | string): number {\n    const minHeight = 25;\n    const defaultHeight = 40;\n    const maxHeight = 55;\n\n    const currentHeight = Number(height);\n\n    if (!currentHeight || Number.isNaN(currentHeight)) {\n        return defaultHeight;\n    }\n\n    if (currentHeight > maxHeight) {\n        return maxHeight;\n    }\n\n    if (currentHeight < minHeight) {\n        return minHeight;\n    }\n\n    return currentHeight;\n}\n","import { FormPoster } from '@bigcommerce/form-poster';\n\nimport {\n    BraintreeError,\n    BraintreeHostWindow,\n    BraintreeInitializationData,\n    BraintreeIntegrationService,\n    BraintreePaypalCheckout,\n    BraintreePaypalSdkCreatorConfig,\n    BraintreeTokenizePayload,\n    isBraintreeError,\n    PaypalAuthorizeData,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    BuyNowCartCreationError,\n    BuyNowCartRequestBody,\n    CheckoutButtonInitializeOptions,\n    CheckoutButtonStrategy,\n    InvalidArgumentError,\n    MissingDataError,\n    MissingDataErrorType,\n    PaymentIntegrationService,\n    PaymentMethod,\n    StandardError,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport getValidButtonStyle from '../get-valid-button-style';\nimport mapToBraintreeShippingAddressOverride from '../map-to-braintree-shipping-address-override';\n\nimport BraintreePaypalButtonInitializeOptions, {\n    WithBraintreePaypalButtonInitializeOptions,\n} from './braintree-paypal-button-initialize-options';\n\nexport default class BraintreePaypalButtonStrategy implements CheckoutButtonStrategy {\n    private buyNowCartId: string | undefined;\n\n    constructor(\n        private paymentIntegrationService: PaymentIntegrationService,\n        private formPoster: FormPoster,\n        private braintreeIntegrationService: BraintreeIntegrationService,\n        private braintreeHostWindow: BraintreeHostWindow,\n    ) {}\n\n    async initialize(\n        options: CheckoutButtonInitializeOptions & WithBraintreePaypalButtonInitializeOptions,\n    ): Promise<void> {\n        const { braintreepaypal, containerId, methodId } = options;\n\n        if (!methodId) {\n            throw new InvalidArgumentError(\n                'Unable to initialize payment because \"options.methodId\" argument is not provided.',\n            );\n        }\n\n        if (!containerId) {\n            throw new InvalidArgumentError(\n                `Unable to initialize payment because \"options.containerId\" argument is not provided.`,\n            );\n        }\n\n        if (!braintreepaypal) {\n            throw new InvalidArgumentError(\n                `Unable to initialize payment because \"options.braintreepaypal\" argument is not provided.`,\n            );\n        }\n\n        let state = this.paymentIntegrationService.getState();\n        let currencyCode: string;\n\n        if (braintreepaypal.buyNowInitializeOptions) {\n            if (!braintreepaypal.currencyCode) {\n                throw new InvalidArgumentError(\n                    `Unable to initialize payment because \"options.braintreepaypalcredit.currencyCode\" argument is not provided.`,\n                );\n            }\n\n            currencyCode = braintreepaypal.currencyCode;\n        } else {\n            await this.paymentIntegrationService.loadDefaultCheckout();\n\n            state = this.paymentIntegrationService.getState();\n            currencyCode = state.getCartOrThrow().currency.code;\n        }\n\n        const paymentMethod = state.getPaymentMethodOrThrow<BraintreeInitializationData>(methodId);\n        const { clientToken, config, initializationData } = paymentMethod;\n\n        if (!clientToken || !initializationData) {\n            throw new MissingDataError(MissingDataErrorType.MissingPaymentMethod);\n        }\n\n        const paypalCheckoutOptions: Partial<BraintreePaypalSdkCreatorConfig> = {\n            currency: currencyCode,\n            intent: initializationData.intent,\n            isCreditEnabled: initializationData.isCreditEnabled,\n        };\n\n        const paypalCheckoutSuccessCallback = (\n            braintreePaypalCheckout: BraintreePaypalCheckout,\n        ) => {\n            this.renderPayPalButton(\n                braintreePaypalCheckout,\n                braintreepaypal,\n                containerId,\n                methodId,\n                !!config.testMode,\n            );\n        };\n        const paypalCheckoutErrorCallback = (error: BraintreeError) =>\n            this.handleError(error, containerId, braintreepaypal.onError);\n\n        this.braintreeIntegrationService.initialize(clientToken);\n        await this.braintreeIntegrationService.getPaypalCheckout(\n            paypalCheckoutOptions,\n            paypalCheckoutSuccessCallback,\n            paypalCheckoutErrorCallback,\n        );\n    }\n\n    async deinitialize(): Promise<void> {\n        await this.braintreeIntegrationService.teardown();\n    }\n\n    private renderPayPalButton(\n        braintreePaypalCheckout: BraintreePaypalCheckout,\n        braintreepaypal: BraintreePaypalButtonInitializeOptions,\n        containerId: string,\n        methodId: string,\n        testMode: boolean,\n    ): void {\n        const { style, shouldProcessPayment, onAuthorizeError, onEligibilityFailure } =\n            braintreepaypal;\n        const { paypal } = this.braintreeHostWindow;\n\n        if (paypal) {\n            const paypalButtonRender = paypal.Buttons({\n                env: testMode ? 'sandbox' : 'production',\n                fundingSource: paypal.FUNDING.PAYPAL,\n                style: getValidButtonStyle(style),\n                createOrder: () =>\n                    this.setupPayment(braintreePaypalCheckout, braintreepaypal, methodId),\n                onApprove: (authorizeData: PaypalAuthorizeData) =>\n                    this.tokenizePayment(\n                        authorizeData,\n                        braintreePaypalCheckout,\n                        methodId,\n                        shouldProcessPayment,\n                        onAuthorizeError,\n                    ),\n            });\n\n            if (paypalButtonRender.isEligible()) {\n                paypalButtonRender.render(`#${containerId}`);\n            } else if (onEligibilityFailure && typeof onEligibilityFailure === 'function') {\n                onEligibilityFailure();\n            }\n        } else {\n            this.braintreeIntegrationService.removeElement(containerId);\n        }\n    }\n\n    private async setupPayment(\n        braintreePaypalCheckout: BraintreePaypalCheckout,\n        braintreepaypal: BraintreePaypalButtonInitializeOptions,\n        methodId: string,\n    ): Promise<string | void> {\n        const { onPaymentError, shippingAddress, buyNowInitializeOptions } = braintreepaypal;\n\n        try {\n            const buyNowCart =\n                typeof buyNowInitializeOptions?.getBuyNowCartRequestBody === 'function'\n                    ? await this.createBuyNowCart(\n                          buyNowInitializeOptions.getBuyNowCartRequestBody(),\n                      )\n                    : undefined;\n\n            this.buyNowCartId = buyNowCart?.id;\n\n            const state = this.paymentIntegrationService.getState();\n            const customer = state.getCustomer();\n            const paymentMethod: PaymentMethod<BraintreeInitializationData> =\n                state.getPaymentMethodOrThrow(methodId);\n\n            const amount = buyNowCart ? buyNowCart.cartAmount : state.getCartOrThrow().cartAmount;\n            const currencyCode = buyNowCart\n                ? braintreepaypal.currencyCode\n                : state.getCartOrThrow().currency.code;\n\n            const address = shippingAddress || customer?.addresses[0];\n\n            const shippingAddressOverride = address\n                ? mapToBraintreeShippingAddressOverride(address)\n                : undefined;\n\n            return await braintreePaypalCheckout.createPayment({\n                flow: 'checkout',\n                enableShippingAddress: true,\n                shippingAddressEditable: false,\n                shippingAddressOverride,\n                amount,\n                currency: currencyCode,\n                offerCredit: false,\n                intent: paymentMethod.initializationData?.intent,\n            });\n        } catch (error: unknown) {\n            if (onPaymentError) {\n                if (isBraintreeError(error) || error instanceof StandardError) {\n                    onPaymentError(error);\n                }\n            }\n\n            throw error;\n        }\n    }\n\n    private async tokenizePayment(\n        authorizeData: PaypalAuthorizeData,\n        braintreePaypalCheckout: BraintreePaypalCheckout,\n        methodId: string,\n        shouldProcessPayment?: boolean,\n        onError?: (error: BraintreeError | StandardError) => void,\n    ): Promise<BraintreeTokenizePayload | void> {\n        try {\n            const { deviceData } = await this.braintreeIntegrationService.getDataCollector({\n                paypal: true,\n            });\n            const tokenizePayload = await braintreePaypalCheckout.tokenizePayment(authorizeData);\n            const { details, nonce } = tokenizePayload;\n            const billingAddress =\n                this.braintreeIntegrationService.mapToLegacyBillingAddress(details);\n            const shippingAddress =\n                this.braintreeIntegrationService.mapToLegacyShippingAddress(details);\n\n            this.formPoster.postForm('/checkout.php', {\n                payment_type: 'paypal',\n                provider: methodId,\n                action: shouldProcessPayment ? 'process_payment' : 'set_external_checkout',\n                nonce,\n                device_data: deviceData,\n                billing_address: JSON.stringify(billingAddress),\n                shipping_address: JSON.stringify(shippingAddress),\n                ...(this.buyNowCartId && { cart_id: this.buyNowCartId }),\n            });\n\n            return tokenizePayload;\n        } catch (error) {\n            if (onError) {\n                if (isBraintreeError(error) || error instanceof StandardError) {\n                    onError(error);\n                }\n            }\n\n            throw error;\n        }\n    }\n\n    private async createBuyNowCart(buyNowCardRequestBody?: BuyNowCartRequestBody | void) {\n        if (!buyNowCardRequestBody) {\n            throw new MissingDataError(MissingDataErrorType.MissingCart);\n        }\n\n        try {\n            return await this.paymentIntegrationService.createBuyNowCart(buyNowCardRequestBody);\n        } catch (error) {\n            throw new BuyNowCartCreationError();\n        }\n    }\n\n    private handleError(\n        error: unknown,\n        buttonContainerId: string,\n        onErrorCallback?: (error: BraintreeError | StandardError) => void,\n    ): void {\n        this.braintreeIntegrationService.removeElement(buttonContainerId);\n\n        if (onErrorCallback && isBraintreeError(error)) {\n            onErrorCallback(error);\n        } else {\n            throw error;\n        }\n    }\n}\n","import { createFormPoster } from '@bigcommerce/form-poster';\nimport { getScriptLoader } from '@bigcommerce/script-loader';\n\nimport {\n    BraintreeHostWindow,\n    BraintreeIntegrationService,\n    BraintreeScriptLoader,\n    BraintreeSDKVersionManager,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    CheckoutButtonStrategyFactory,\n    toResolvableModule,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport BraintreePaypalButtonStrategy from './braintree-paypal-button-strategy';\n\nconst createBraintreePaypalButtonStrategy: CheckoutButtonStrategyFactory<\n    BraintreePaypalButtonStrategy\n> = (paymentIntegrationService) => {\n    const braintreeHostWindow: BraintreeHostWindow = window;\n    const braintreeSDKVersionManager = new BraintreeSDKVersionManager(paymentIntegrationService);\n    const braintreeIntegrationService = new BraintreeIntegrationService(\n        new BraintreeScriptLoader(\n            getScriptLoader(),\n            braintreeHostWindow,\n            braintreeSDKVersionManager,\n        ),\n        braintreeHostWindow,\n    );\n\n    return new BraintreePaypalButtonStrategy(\n        paymentIntegrationService,\n        createFormPoster(),\n        braintreeIntegrationService,\n        braintreeHostWindow,\n    );\n};\n\nexport default toResolvableModule(createBraintreePaypalButtonStrategy, [{ id: 'braintreepaypal' }]);\n","import { FormPoster } from '@bigcommerce/form-poster';\n\nimport {\n    BraintreeError,\n    BraintreeHostWindow,\n    BraintreeInitializationData,\n    BraintreeIntegrationService,\n    BraintreeMessages,\n    BraintreePaypalCheckout,\n    BraintreePaypalSdkCreatorConfig,\n    BraintreeTokenizePayload,\n    isBraintreeError,\n    MessagingPlacements,\n    PaypalAuthorizeData,\n    PaypalButtonStyleLabelOption,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    BuyNowCartCreationError,\n    BuyNowCartRequestBody,\n    CheckoutButtonInitializeOptions,\n    CheckoutButtonStrategy,\n    InvalidArgumentError,\n    MissingDataError,\n    MissingDataErrorType,\n    PaymentIntegrationService,\n    PaymentMethod,\n    StandardError,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\nimport { isExperimentEnabled } from '@bigcommerce/checkout-sdk/utility';\n\nimport getValidButtonStyle from '../get-valid-button-style';\nimport mapToBraintreeShippingAddressOverride from '../map-to-braintree-shipping-address-override';\n\nimport BraintreePaypalCreditButtonInitializeOptions, {\n    WithBraintreePaypalCreditButtonInitializeOptions,\n} from './braintree-paypal-credit-button-initialize-options';\n\nexport default class BraintreePaypalCreditButtonStrategy implements CheckoutButtonStrategy {\n    private buyNowCartId: string | undefined;\n\n    constructor(\n        private paymentIntegrationService: PaymentIntegrationService,\n        private formPoster: FormPoster,\n        private braintreeIntegrationService: BraintreeIntegrationService,\n        private braintreeMessages: BraintreeMessages,\n        private braintreeHostWindow: BraintreeHostWindow,\n    ) {}\n\n    async initialize(\n        options: CheckoutButtonInitializeOptions & WithBraintreePaypalCreditButtonInitializeOptions,\n    ): Promise<void> {\n        const { braintreepaypalcredit, containerId, methodId } = options;\n\n        if (!methodId) {\n            throw new InvalidArgumentError(\n                'Unable to initialize payment because \"options.methodId\" argument is not provided.',\n            );\n        }\n\n        if (!containerId) {\n            throw new InvalidArgumentError(\n                `Unable to initialize payment because \"options.containerId\" argument is not provided.`,\n            );\n        }\n\n        if (!braintreepaypalcredit) {\n            throw new InvalidArgumentError(\n                `Unable to initialize payment because \"options.braintreepaypalcredit\" argument is not provided.`,\n            );\n        }\n\n        let state = this.paymentIntegrationService.getState();\n        let currencyCode: string;\n\n        if (braintreepaypalcredit.buyNowInitializeOptions) {\n            if (!braintreepaypalcredit.currencyCode) {\n                throw new InvalidArgumentError(\n                    `Unable to initialize payment because \"options.braintreepaypalcredit.currencyCode\" argument is not provided.`,\n                );\n            }\n\n            currencyCode = braintreepaypalcredit.currencyCode;\n        } else {\n            await this.paymentIntegrationService.loadDefaultCheckout();\n\n            state = this.paymentIntegrationService.getState();\n            currencyCode = state.getCartOrThrow().currency.code;\n        }\n\n        const paymentMethod = state.getPaymentMethodOrThrow<BraintreeInitializationData>(methodId);\n        const { clientToken, config, initializationData } = paymentMethod;\n\n        if (!clientToken || !initializationData) {\n            throw new MissingDataError(MissingDataErrorType.MissingPaymentMethod);\n        }\n\n        const paypalCheckoutOptions: Partial<BraintreePaypalSdkCreatorConfig> = {\n            currency: currencyCode,\n            intent: initializationData.intent,\n            isCreditEnabled: initializationData.isCreditEnabled,\n        };\n\n        // TODO: remove banner rendering implementation in this file when PAYPAL-5663.hide_braintree_card_banner_implementation_in_checkout_sdk will be rolled out to 100%\n        const features = state.getStoreConfig()?.checkoutSettings.features ?? {};\n        const isBannerImplementationDisabled = isExperimentEnabled(\n            features,\n            'PAYPAL-5663.hide_braintree_card_banner_implementation_in_checkout_sdk',\n        );\n\n        const paypalCheckoutSuccessCallback = (\n            braintreePaypalCheckout: BraintreePaypalCheckout,\n        ) => {\n            if (!isBannerImplementationDisabled && braintreepaypalcredit.messagingContainerId) {\n                this.renderPayPalMessages(methodId, braintreepaypalcredit.messagingContainerId);\n            }\n\n            this.renderPayPalButton(\n                braintreePaypalCheckout,\n                braintreepaypalcredit,\n                containerId,\n                methodId,\n                !!config.testMode,\n            );\n        };\n        const paypalCheckoutErrorCallback = (error: BraintreeError) =>\n            this.handleError(error, containerId, braintreepaypalcredit.onError);\n\n        this.braintreeIntegrationService.initialize(clientToken);\n        await this.braintreeIntegrationService.getPaypalCheckout(\n            paypalCheckoutOptions,\n            paypalCheckoutSuccessCallback,\n            paypalCheckoutErrorCallback,\n        );\n    }\n\n    async deinitialize(): Promise<void> {\n        await this.braintreeIntegrationService.teardown();\n    }\n\n    private renderPayPalMessages(methodId: string, messagingContainerId: string): void {\n        this.braintreeMessages.render(methodId, messagingContainerId, MessagingPlacements.CART);\n    }\n\n    private renderPayPalButton(\n        braintreePaypalCheckout: BraintreePaypalCheckout,\n        braintreepaypalcredit: BraintreePaypalCreditButtonInitializeOptions,\n        containerId: string,\n        methodId: string,\n        testMode: boolean,\n    ): void {\n        const { style, shouldProcessPayment, onAuthorizeError, onEligibilityFailure } =\n            braintreepaypalcredit;\n        const { paypal } = this.braintreeHostWindow;\n\n        let hasRenderedSmartButton = false;\n\n        if (paypal) {\n            const fundingSources = [paypal.FUNDING.PAYLATER, paypal.FUNDING.CREDIT];\n\n            fundingSources.forEach((fundingSource) => {\n                const buttonStyle =\n                    fundingSource === paypal.FUNDING.CREDIT\n                        ? {\n                              label: PaypalButtonStyleLabelOption.CREDIT,\n                              ...getValidButtonStyle(style),\n                          }\n                        : getValidButtonStyle(style);\n\n                if (!hasRenderedSmartButton) {\n                    const paypalButtonRender = paypal.Buttons({\n                        env: testMode ? 'sandbox' : 'production',\n                        fundingSource,\n                        style: buttonStyle,\n                        createOrder: () =>\n                            this.setupPayment(\n                                braintreePaypalCheckout,\n                                braintreepaypalcredit,\n                                methodId,\n                            ),\n                        onApprove: (authorizeData: PaypalAuthorizeData) =>\n                            this.tokenizePayment(\n                                authorizeData,\n                                braintreePaypalCheckout,\n                                methodId,\n                                shouldProcessPayment,\n                                onAuthorizeError,\n                            ),\n                    });\n\n                    if (paypalButtonRender.isEligible()) {\n                        paypalButtonRender.render(`#${containerId}`);\n                        hasRenderedSmartButton = true;\n                    } else if (\n                        paypal.FUNDING.CREDIT &&\n                        onEligibilityFailure &&\n                        typeof onEligibilityFailure === 'function'\n                    ) {\n                        // the condition is related to paypal.FUNDING.CREDIT because when paypal.FUNDING.PAYLATER is not eligible then\n                        // CREDIT button should be configured and triggered to render with eligibility check\n                        // and if it is not eligible, then onEligibilityFailure callback should be called\n                        onEligibilityFailure();\n                    }\n                }\n            });\n        }\n\n        if (!paypal || !hasRenderedSmartButton) {\n            this.braintreeIntegrationService.removeElement(containerId);\n        }\n    }\n\n    private async setupPayment(\n        braintreePaypalCheckout: BraintreePaypalCheckout,\n        braintreepaypalcredit: BraintreePaypalCreditButtonInitializeOptions,\n        methodId: string,\n    ): Promise<string | void> {\n        const { onPaymentError, shippingAddress, buyNowInitializeOptions } = braintreepaypalcredit;\n\n        try {\n            const buyNowCart =\n                typeof buyNowInitializeOptions?.getBuyNowCartRequestBody === 'function'\n                    ? await this.createBuyNowCart(\n                          buyNowInitializeOptions.getBuyNowCartRequestBody(),\n                      )\n                    : undefined;\n\n            this.buyNowCartId = buyNowCart?.id;\n\n            const state = this.paymentIntegrationService.getState();\n            const customer = state.getCustomer();\n            const paymentMethod: PaymentMethod<BraintreeInitializationData> =\n                state.getPaymentMethodOrThrow(methodId);\n\n            const amount = buyNowCart ? buyNowCart.cartAmount : state.getCartOrThrow().cartAmount; // state.getCheckoutOrThrow().outstandingBalance\n            const currencyCode = buyNowCart\n                ? braintreepaypalcredit.currencyCode\n                : state.getCartOrThrow().currency.code;\n\n            const address = shippingAddress || customer?.addresses[0];\n\n            const shippingAddressOverride = address\n                ? mapToBraintreeShippingAddressOverride(address)\n                : undefined;\n\n            return await braintreePaypalCheckout.createPayment({\n                flow: 'checkout',\n                enableShippingAddress: true,\n                shippingAddressEditable: false,\n                shippingAddressOverride,\n                amount,\n                currency: currencyCode,\n                offerCredit: true,\n                intent: paymentMethod.initializationData?.intent,\n            });\n        } catch (error: unknown) {\n            if (onPaymentError) {\n                if (isBraintreeError(error) || error instanceof StandardError) {\n                    onPaymentError(error);\n                }\n            }\n\n            throw error;\n        }\n    }\n\n    private async tokenizePayment(\n        authorizeData: PaypalAuthorizeData,\n        braintreePaypalCheckout: BraintreePaypalCheckout,\n        methodId: string,\n        shouldProcessPayment?: boolean,\n        onError?: (error: BraintreeError | StandardError) => void,\n    ): Promise<BraintreeTokenizePayload | void> {\n        try {\n            const { deviceData } = await this.braintreeIntegrationService.getDataCollector({\n                paypal: true,\n            });\n            const tokenizePayload = await braintreePaypalCheckout.tokenizePayment(authorizeData);\n            const { details, nonce } = tokenizePayload;\n            const billingAddress =\n                this.braintreeIntegrationService.mapToLegacyBillingAddress(details);\n            const shippingAddress =\n                this.braintreeIntegrationService.mapToLegacyShippingAddress(details);\n\n            this.formPoster.postForm('/checkout.php', {\n                payment_type: 'paypal',\n                provider: methodId,\n                action: shouldProcessPayment ? 'process_payment' : 'set_external_checkout',\n                nonce,\n                device_data: deviceData,\n                billing_address: JSON.stringify(billingAddress),\n                shipping_address: JSON.stringify(shippingAddress),\n                ...(this.buyNowCartId && { cart_id: this.buyNowCartId }),\n            });\n\n            return tokenizePayload;\n        } catch (error) {\n            if (onError) {\n                if (isBraintreeError(error) || error instanceof StandardError) {\n                    onError(error);\n                }\n            }\n\n            throw error;\n        }\n    }\n\n    private async createBuyNowCart(buyNowCardRequestBody?: BuyNowCartRequestBody | void) {\n        if (!buyNowCardRequestBody) {\n            throw new MissingDataError(MissingDataErrorType.MissingCart);\n        }\n\n        try {\n            return await this.paymentIntegrationService.createBuyNowCart(buyNowCardRequestBody);\n        } catch (error) {\n            throw new BuyNowCartCreationError();\n        }\n    }\n\n    private handleError(\n        error: unknown,\n        buttonContainerId: string,\n        onErrorCallback?: (error: BraintreeError | StandardError) => void,\n    ): void {\n        this.braintreeIntegrationService.removeElement(buttonContainerId);\n\n        if (onErrorCallback && isBraintreeError(error)) {\n            onErrorCallback(error);\n        } else {\n            throw error;\n        }\n    }\n}\n","import { createFormPoster } from '@bigcommerce/form-poster';\nimport { getScriptLoader } from '@bigcommerce/script-loader';\n\nimport {\n    BraintreeHostWindow,\n    BraintreeIntegrationService,\n    BraintreeMessages,\n    BraintreeScriptLoader,\n    BraintreeSDKVersionManager,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    CheckoutButtonStrategyFactory,\n    toResolvableModule,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport BraintreePaypalCreditButtonStrategy from './braintree-paypal-credit-button-strategy';\n\nconst createBraintreePaypalCreditButtonStrategy: CheckoutButtonStrategyFactory<\n    BraintreePaypalCreditButtonStrategy\n> = (paymentIntegrationService) => {\n    const braintreeHostWindow: BraintreeHostWindow = window;\n    const braintreeSDKVersionManager = new BraintreeSDKVersionManager(paymentIntegrationService);\n    const braintreeIntegrationService = new BraintreeIntegrationService(\n        new BraintreeScriptLoader(\n            getScriptLoader(),\n            braintreeHostWindow,\n            braintreeSDKVersionManager,\n        ),\n        braintreeHostWindow,\n    );\n    const braintreeMessages = new BraintreeMessages(paymentIntegrationService);\n\n    return new BraintreePaypalCreditButtonStrategy(\n        paymentIntegrationService,\n        createFormPoster(),\n        braintreeIntegrationService,\n        braintreeMessages,\n        braintreeHostWindow,\n    );\n};\n\nexport default toResolvableModule(createBraintreePaypalCreditButtonStrategy, [\n    { id: 'braintreepaypalcredit' },\n]);\n","import { FormPoster } from '@bigcommerce/form-poster';\n\nimport {\n    BraintreeDataCollector,\n    BraintreeSdk,\n    BraintreeVisaCheckout,\n    VisaCheckoutAddress,\n    VisaCheckoutPaymentSuccessPayload,\n    VisaCheckoutTokenizedPayload,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    Address,\n    CheckoutButtonInitializeOptions,\n    CheckoutButtonStrategy,\n    InvalidArgumentError,\n    LegacyAddress,\n    MissingDataError,\n    MissingDataErrorType,\n    PaymentIntegrationService,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nexport default class BraintreeVisaCheckoutButtonStrategy implements CheckoutButtonStrategy {\n    constructor(\n        private paymentIntegrationService: PaymentIntegrationService,\n        private formPoster: FormPoster,\n        private braintreeSdk: BraintreeSdk,\n    ) {}\n\n    async initialize(options: CheckoutButtonInitializeOptions): Promise<void> {\n        const { containerId, methodId } = options;\n\n        if (!methodId) {\n            throw new InvalidArgumentError(\n                'Unable to initialize payment because \"options.methodId\" argument is not provided.',\n            );\n        }\n\n        if (!containerId) {\n            throw new InvalidArgumentError(\n                `Unable to initialize payment because \"options.containerId\" argument is not provided.`,\n            );\n        }\n\n        await this.paymentIntegrationService.loadPaymentMethod(methodId);\n\n        const state = this.paymentIntegrationService.getState();\n\n        const { clientToken, initializationData, config } = state.getPaymentMethodOrThrow(methodId);\n\n        if (!clientToken || !initializationData) {\n            throw new MissingDataError(MissingDataErrorType.MissingPaymentMethod);\n        }\n\n        this.braintreeSdk.initialize(clientToken);\n\n        const braintreeVisaCheckout = await this.braintreeSdk.getBraintreeVisaCheckout();\n\n        const {\n            currency: { code },\n            cartAmount,\n        } = state.getCartOrThrow();\n\n        const visaCheckoutInstance = await this.braintreeSdk.getVisaCheckoutSdk(config.testMode);\n\n        const initOptions = braintreeVisaCheckout.createInitOptions({\n            paymentRequest: {\n                currencyCode: code,\n                subtotal: String(cartAmount),\n            },\n            settings: {\n                shipping: {\n                    collectShipping: true,\n                },\n            },\n        });\n\n        this.createSignInButton(containerId);\n\n        await visaCheckoutInstance.init(initOptions);\n\n        visaCheckoutInstance.on('payment.success', async (payment) => {\n            await this.paymentSuccess(braintreeVisaCheckout, payment);\n        });\n    }\n\n    deinitialize(): Promise<void> {\n        return Promise.resolve();\n    }\n\n    private async paymentSuccess(\n        braintreeVisaCheckout: BraintreeVisaCheckout,\n        payment: VisaCheckoutPaymentSuccessPayload,\n    ) {\n        return Promise.all([\n            braintreeVisaCheckout.tokenize(payment),\n            this.braintreeSdk.getDataCollectorOrThrow(),\n        ]).then(([payload, deviceData]) => {\n            const state = this.paymentIntegrationService.getState();\n\n            const shipping = state.getShippingAddress();\n            const billing = state.getBillingAddress();\n\n            const {\n                shippingAddress = this.toVisaCheckoutAddress(shipping),\n                billingAddress = this.toVisaCheckoutAddress(billing),\n            } = payload;\n\n            return this.postForm(\n                {\n                    ...payload,\n                    shippingAddress,\n                    billingAddress,\n                },\n                deviceData,\n            );\n        });\n    }\n\n    private postForm(\n        paymentData: VisaCheckoutTokenizedPayload,\n        dataCollector: BraintreeDataCollector,\n    ) {\n        const { userData, billingAddress, shippingAddress, details: cardInformation } = paymentData;\n        const { userEmail } = userData;\n        const { deviceData } = dataCollector;\n\n        return this.formPoster.postForm('/checkout.php', {\n            payment_type: paymentData.type,\n            nonce: paymentData.nonce,\n            provider: 'braintreevisacheckout',\n            action: 'set_external_checkout',\n            device_data: deviceData,\n            card_information: JSON.stringify({\n                type: cardInformation.cardType,\n                number: cardInformation.lastTwo,\n            }),\n            billing_address: JSON.stringify(this.getAddress(userEmail, billingAddress)),\n            shipping_address: JSON.stringify(this.getAddress(userEmail, shippingAddress)),\n        });\n    }\n\n    private toVisaCheckoutAddress(address?: Address): VisaCheckoutAddress {\n        if (!address) {\n            return {};\n        }\n\n        return {\n            firstName: address.firstName,\n            lastName: address.lastName,\n            phoneNumber: address.phone,\n            streetAddress: address.address1,\n            extendedAddress: address.address2,\n            locality: address.city,\n            region: address.stateOrProvinceCode,\n            countryCode: address.countryCode,\n            postalCode: address.postalCode,\n        };\n    }\n\n    private getAddress(email: string, address: VisaCheckoutAddress = {}): Partial<LegacyAddress> {\n        return {\n            email,\n            first_name: address.firstName,\n            last_name: address.lastName,\n            phone_number: address.phoneNumber,\n            address_line_1: address.streetAddress,\n            address_line_2: address.extendedAddress,\n            city: address.locality,\n            state: address.region,\n            country_code: address.countryCode,\n            postal_code: address.postalCode,\n        };\n    }\n\n    private createSignInButton(containerId: string): HTMLElement {\n        const container = document.querySelector(`#${containerId}`);\n\n        if (!container) {\n            throw new Error('Need a container to place the button');\n        }\n\n        return this.insertVisaCheckoutButton(container);\n    }\n\n    private insertVisaCheckoutButton(container: Element): HTMLElement {\n        const buttonSource =\n            'https://secure.checkout.visa.com/wallet-services-web/xo/button.png?acceptCanadianVisaDebit=false&cobrand=true&height=34&width=178';\n        const buttonTemplate = `\n            <img\n                alt=\"Visa Checkout\"\n                class=\"v-button\"\n                role=\"button\"\n                src=\"${buttonSource}\"\n                />\n            <a class=\"v-learn v-learn-default\" style=\"text-align: right; display: block; font-size: 10px; color: #003366;\" href=\"#\" data-locale=\"en_US\">Tell Me More</a>`;\n\n        const visaCheckoutButton = document.createElement('div');\n\n        visaCheckoutButton.style.display = 'flex';\n        visaCheckoutButton.style.flexDirection = 'column';\n        visaCheckoutButton.style.alignItems = 'flex-end';\n\n        visaCheckoutButton.innerHTML = buttonTemplate;\n\n        container.appendChild(visaCheckoutButton);\n\n        return visaCheckoutButton;\n    }\n}\n","import { createFormPoster } from '@bigcommerce/form-poster';\nimport { getScriptLoader } from '@bigcommerce/script-loader';\n\nimport {\n    BraintreeHostWindow,\n    BraintreeScriptLoader,\n    BraintreeSdk,\n    BraintreeSDKVersionManager,\n    VisaCheckoutHostWindow,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    CheckoutButtonStrategyFactory,\n    toResolvableModule,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport BraintreeVisaCheckoutButtonStrategy from './braintree-visa-checkout-button-strategy';\n\nconst createBraintreeVisaCheckoutButtonStrategy: CheckoutButtonStrategyFactory<\n    BraintreeVisaCheckoutButtonStrategy\n> = (paymentIntegrationService) => {\n    const hostWindow: VisaCheckoutHostWindow & BraintreeHostWindow = window;\n    const braintreeSDKVersionManager = new BraintreeSDKVersionManager(paymentIntegrationService);\n    const braintreeSdk = new BraintreeSdk(\n        new BraintreeScriptLoader(getScriptLoader(), hostWindow, braintreeSDKVersionManager),\n    );\n\n    return new BraintreeVisaCheckoutButtonStrategy(\n        paymentIntegrationService,\n        createFormPoster(),\n        braintreeSdk,\n    );\n};\n\nexport default toResolvableModule(createBraintreeVisaCheckoutButtonStrategy, [\n    { id: 'braintreevisacheckout' },\n]);\n","import { LegacyAddress } from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport { BraintreeTokenizationDetails } from './types';\n\nexport default function mapToLegacyBillingAddress(\n    details: BraintreeTokenizationDetails,\n): Partial<LegacyAddress> {\n    const { billingAddress, email, firstName, lastName, phone, shippingAddress } = details;\n\n    const address = billingAddress || shippingAddress;\n\n    return {\n        email,\n        first_name: firstName,\n        last_name: lastName,\n        phone_number: phone,\n        address_line_1: address?.line1,\n        address_line_2: address?.line2,\n        city: address?.city,\n        state: address?.state,\n        country_code: address?.countryCode,\n        postal_code: address?.postalCode,\n    };\n}\n","import { LegacyAddress } from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport { BraintreeTokenizationDetails } from './types';\n\nexport default function mapToLegacyShippingAddress(\n    details: BraintreeTokenizationDetails,\n): Partial<LegacyAddress> {\n    const { email, phone, shippingAddress } = details;\n\n    const recipientName = shippingAddress?.recipientName || '';\n    const [firstName, lastName] = recipientName.split(' ');\n\n    return {\n        email,\n        first_name: firstName || '',\n        last_name: lastName || '',\n        phone_number: phone,\n        address_line_1: shippingAddress?.line1,\n        address_line_2: shippingAddress?.line2,\n        city: shippingAddress?.city,\n        state: shippingAddress?.state,\n        country_code: shippingAddress?.countryCode,\n        postal_code: shippingAddress?.postalCode,\n    };\n}\n","import { FormPoster } from '@bigcommerce/form-poster';\nimport { noop } from 'lodash';\n\nimport {\n    BraintreeError,\n    BraintreeSdk,\n    BraintreeTokenizePayload,\n    BraintreeVenmoCheckout,\n    mapToLegacyBillingAddress,\n    mapToLegacyShippingAddress,\n    PaypalButtonStyleColorOption,\n    PaypalStyleOptions,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    BuyNowCartCreationError,\n    BuyNowCartRequestBody,\n    Cart,\n    CheckoutButtonInitializeOptions,\n    CheckoutButtonStrategy,\n    InvalidArgumentError,\n    MissingDataError,\n    MissingDataErrorType,\n    PaymentIntegrationService,\n    PaymentMethod,\n    UnsupportedBrowserError,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport isBraintreeError from '../is-braintree-error';\nimport { isUnsupportedBrowserError } from '../isUnsupportedBrowserError';\n\nimport { WithBraintreeVenmoInitializeOptions } from './braintree-venmo-initialize-options';\n\nconst getVenmoButtonStyle = (styles: PaypalStyleOptions): Record<string, string> => {\n    const { color, height } = styles;\n\n    const colorParser = (c: string) => {\n        if (c === PaypalButtonStyleColorOption.WHITE) {\n            return '#FFFFFF';\n        }\n\n        return '#3D95CE';\n    };\n\n    return {\n        backgroundColor: colorParser(color || ''),\n        backgroundPosition: '50% 50%',\n        backgroundSize: '80px auto',\n        backgroundImage: `url(\"/app/assets/img/payment-providers/venmo-logo-${\n            color === PaypalButtonStyleColorOption.WHITE\n                ? PaypalButtonStyleColorOption.BLUE\n                : PaypalButtonStyleColorOption.WHITE\n        }.svg\")`,\n        backgroundRepeat: 'no-repeat',\n        borderRadius: '4px',\n        cursor: 'pointer',\n        transition: '0.2s ease',\n        minHeight: `${height || 40}px`,\n        minWidth: '150px',\n        height: '100%',\n        width: '100%',\n        border: color === PaypalButtonStyleColorOption.WHITE ? '1px solid black' : 'none',\n    };\n};\n\nconst venmoButtonStyleHover = {\n    backgroundColor: '#0a7fc2',\n};\n\ninterface BuyNowInitializeOptions {\n    getBuyNowCartRequestBody?(): BuyNowCartRequestBody | void;\n}\n\nexport default class BraintreeVenmoButtonStrategy implements CheckoutButtonStrategy {\n    private onError = noop;\n\n    constructor(\n        private paymentIntegrationService: PaymentIntegrationService,\n        private formPoster: FormPoster,\n        private braintreeSdk: BraintreeSdk,\n    ) {}\n\n    async initialize(\n        options: CheckoutButtonInitializeOptions & WithBraintreeVenmoInitializeOptions,\n    ): Promise<void> {\n        const { braintreevenmo, containerId, methodId } = options;\n\n        if (!methodId) {\n            throw new InvalidArgumentError(\n                'Unable to initialize payment because \"options.methodId\" argument is not provided.',\n            );\n        }\n\n        const state = this.paymentIntegrationService.getState();\n        const paymentMethod = state.getPaymentMethodOrThrow(methodId);\n        const { clientToken, initializationData }: PaymentMethod = paymentMethod;\n        const { paymentButtonStyles } = initializationData;\n        const { cartButtonStyles } = paymentButtonStyles || {};\n        const styles = braintreevenmo?.style || cartButtonStyles;\n\n        if (!clientToken || !initializationData) {\n            throw new MissingDataError(MissingDataErrorType.MissingPaymentMethod);\n        }\n\n        if (!containerId) {\n            throw new InvalidArgumentError(\n                `Unable to initialize payment because \"options.containerId\" argument is not provided.`,\n            );\n        }\n\n        await this.paymentIntegrationService.loadDefaultCheckout();\n\n        this.onError = braintreevenmo?.onError || this.handleError;\n        this.braintreeSdk.initialize(clientToken);\n\n        try {\n            const braintreeVenmoCheckout = await this.braintreeSdk.getVenmoCheckoutOrThrow();\n\n            this.renderVenmoButton(\n                braintreeVenmoCheckout,\n                containerId,\n                braintreevenmo?.buyNowInitializeOptions,\n                styles,\n            );\n        } catch (error) {\n            if (isBraintreeError(error) || isUnsupportedBrowserError(error)) {\n                this.handleInitializationVenmoError(error, containerId);\n            }\n        }\n    }\n\n    async deinitialize(): Promise<void> {\n        await this.braintreeSdk.deinitialize();\n\n        return Promise.resolve();\n    }\n\n    private handleError(error: BraintreeError) {\n        throw new Error(error.message);\n    }\n\n    private async createBuyNowCart(\n        buyNowInitializeOptions?: BuyNowInitializeOptions,\n    ): Promise<Cart | undefined> {\n        if (typeof buyNowInitializeOptions?.getBuyNowCartRequestBody === 'function') {\n            const cartRequestBody = buyNowInitializeOptions?.getBuyNowCartRequestBody();\n\n            if (!cartRequestBody) {\n                throw new MissingDataError(MissingDataErrorType.MissingCart);\n            }\n\n            try {\n                const buyNowCart = await this.paymentIntegrationService.createBuyNowCart(\n                    cartRequestBody,\n                );\n\n                return buyNowCart;\n            } catch (error) {\n                throw new BuyNowCartCreationError();\n            }\n        }\n\n        return undefined;\n    }\n\n    private handleInitializationVenmoError(\n        error: BraintreeError | UnsupportedBrowserError,\n        containerId: string,\n    ): void {\n        this.removeVenmoContainer(containerId);\n\n        return this.onError(error);\n    }\n\n    private removeVenmoContainer(containerId: string): void {\n        const buttonContainer = document.getElementById(containerId);\n\n        if (buttonContainer) {\n            buttonContainer.remove();\n        }\n    }\n\n    private renderVenmoButton(\n        braintreeVenmoCheckout: BraintreeVenmoCheckout,\n        containerId: string,\n        buyNowInitializeOptions?: BuyNowInitializeOptions,\n        buttonStyles?: PaypalStyleOptions,\n    ): void {\n        const venmoButton = document.getElementById(containerId);\n        const { color } = buttonStyles || {};\n\n        if (!venmoButton) {\n            throw new InvalidArgumentError(\n                'Unable to create wallet button without valid container ID.',\n            );\n        }\n\n        venmoButton.setAttribute('aria-label', 'Venmo');\n        Object.assign(venmoButton.style, getVenmoButtonStyle(buttonStyles || {}));\n\n        // eslint-disable-next-line @typescript-eslint/no-misused-promises\n        venmoButton.addEventListener('click', async () => {\n            venmoButton.setAttribute('disabled', 'true');\n\n            const buyBowCart = await this.createBuyNowCart(buyNowInitializeOptions);\n\n            if (braintreeVenmoCheckout.tokenize) {\n                braintreeVenmoCheckout.tokenize(\n                    async (\n                        error: BraintreeError | undefined,\n                        payload: BraintreeTokenizePayload,\n                    ) => {\n                        venmoButton.removeAttribute('disabled');\n\n                        if (error) {\n                            this.onError(error);\n                        }\n\n                        await this.handlePostForm(payload, buyBowCart?.id);\n                    },\n                );\n            }\n        });\n\n        if (color === PaypalButtonStyleColorOption.BLUE) {\n            venmoButton.addEventListener('mouseenter', () => {\n                venmoButton.style.backgroundColor = venmoButtonStyleHover.backgroundColor;\n            });\n\n            venmoButton.addEventListener('mouseleave', () => {\n                venmoButton.style.backgroundColor = getVenmoButtonStyle(\n                    buttonStyles || {},\n                ).backgroundColor;\n            });\n        }\n    }\n\n    private async handlePostForm(\n        payload: BraintreeTokenizePayload,\n        buyNowCartId?: string,\n    ): Promise<void> {\n        const { deviceData } = await this.braintreeSdk.getDataCollectorOrThrow();\n        const { nonce, details } = payload;\n\n        this.formPoster.postForm('/checkout.php', {\n            nonce,\n            provider: 'braintreevenmo',\n            payment_type: 'paypal',\n            device_data: deviceData,\n            action: 'set_external_checkout',\n            billing_address: JSON.stringify(mapToLegacyBillingAddress(details)),\n            shipping_address: JSON.stringify(mapToLegacyShippingAddress(details)),\n            ...(buyNowCartId && { cart_id: buyNowCartId }),\n        });\n    }\n}\n","import { UnsupportedBrowserError } from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nexport function isUnsupportedBrowserError(error: unknown): error is UnsupportedBrowserError {\n    return error instanceof UnsupportedBrowserError;\n}\n","import { createFormPoster } from '@bigcommerce/form-poster';\nimport { getScriptLoader } from '@bigcommerce/script-loader';\n\nimport {\n    BraintreeHostWindow,\n    BraintreeScriptLoader,\n    BraintreeSdk,\n    BraintreeSDKVersionManager,\n} from '@bigcommerce/checkout-sdk/braintree-utils';\nimport {\n    CheckoutButtonStrategyFactory,\n    toResolvableModule,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport BraintreeVenmoButtonStrategy from './braintree-venmo-button-strategy';\n\nconst createBraintreeVenmoButtonStrategy: CheckoutButtonStrategyFactory<\n    BraintreeVenmoButtonStrategy\n> = (paymentIntegrationService) => {\n    const braintreeHostWindow: BraintreeHostWindow = window;\n    const scriptLoader = getScriptLoader();\n    const braintreeSDKVersionManager = new BraintreeSDKVersionManager(paymentIntegrationService);\n    const braintreeScriptLoader = new BraintreeScriptLoader(\n        scriptLoader,\n        braintreeHostWindow,\n        braintreeSDKVersionManager,\n    );\n\n    const braintreeSdk = new BraintreeSdk(braintreeScriptLoader);\n\n    return new BraintreeVenmoButtonStrategy(\n        paymentIntegrationService,\n        createFormPoster(),\n        braintreeSdk,\n    );\n};\n\nexport default toResolvableModule(createBraintreeVenmoButtonStrategy, [{ id: 'braintreevenmo' }]);\n"],"names":["BraintreeEnv","BraintreeModuleName","BraintreeFormFieldType","StandardError","Error","constructor","message","prototype","super","name","type","Object","setPrototypeOf","this","__proto__","captureStackTrace","stack","PaymentMethodClientUnavailableError","Sandbox","Production","Client","DataCollector","Fastlane","GooglePayment","HostedFields","LocalPayment","Paypal","PaypalCheckout","ThreeDSecure","UsBankAccount","Venmo","VisaCheckout","CardCode","CardCodeVerification","CardExpiry","CardName","CardNumber","CardNumberVerification","BRAINTREE_SDK_HOSTED_FIELDS_FIX_VERSION","BRAINTREE_SDK_DEFAULT_VERSION","BRAINTREE_SDK_STABLE_VERSION","BRAINTREE_SDK_SCRIPTS_INTEGRITY","NotInitializedErrorType","TotalPriceStatusType","BraintreeOrderStatus","NonInstantLocalPaymentMethods","BraintreeFastlaneAuthenticationState","BraintreeErrorType","BraintreeErrorCode","BraintreeSupportedCardBrands","BraintreeScriptLoader","scriptLoader","braintreeHostWindow","braintreeSDKVersionManager","loadClient","loadBraintreeModuleOrThrow","loadFastlane","loadPaypalCheckout","loadPaypal","loadLocalPayment","loadDataCollector","loadUsBankAccount","loadGooglePayment","load3DS","loadVisaCheckout","loadVenmoCheckout","loadHostedFields","loadVisaCheckoutSdk","testMode","V","hash","loadScript","async","attributes","integrity","crossorigin","then","braintreeModuleName","fileName","module","getBraintreeModule","braintreeSdkVersion","getSDKVersion","scriptPath","getIntegrityValuesByModuleName","t","braintree","moduleName","version","UnsupportedBrowserError","CheckoutButtonNotInitialized","CustomerNotInitialized","PaymentNotInitialized","ShippingNotInitialized","SpamProtectionNotInitialized","NotInitializedError","subtype","isBraintreeError","error","Boolean","ESTIMATED","FINAL","NOT_CURRENTLY_KNOWN","Completed","Pending","Failed","TRUSTLY","SUCCEEDED","FAILED","CANCELED","UNRECOGNIZED","Customer","Merchant","Network","Internal","Unknown","KountNotEnabled","Visa","Mastercard","AmericanExpress","DinersClub","Discover","Jcb","UnionPay","Maestro","Elo","Mir","Hiper","Hipercard","MissingDataErrorType","BraintreeSdk","braintreeScriptLoader","initialize","clientToken","setClientToken","deinitialize","teardownModule","dataCollector","getClient","client","getClientTokenOrThrow","clientCreator","create","authorization","getDataCollectorOrThrow","options","emptyDataCollector","deviceData","teardown","Promise","resolve","dataCollectorConfig","kount","code","getBraintreeGooglePayment","googlePayment","braintreeGooglePayment","all","getBraintreeThreeDS","threeDS","threeDSecure","getBraintreeLocalPayment","merchantAccountId","braintreeLocalPayment","localPaymentCreator","reject","getUsBankAccount","usBankAccount","getBraintreeVisaCheckout","visaCheckout","paypal","getVisaCheckoutSdk","visaCheckoutSDK","getVenmoCheckoutOrThrow","braintreeVenmo","venmoCheckout","venmoCheckoutConfig","allowDesktop","paymentMethodUsage","braintreeVenmoCheckout","isBrowserSupported","isExperimentEnabled","features","experimentName","fallbackValue","BraintreeSDKVersionManager","paymentIntegrationService","braintreeWindow","window","storeConfig","getState","getStoreConfig","checkoutSettings","getPreloadedSDKVersion","preloadedVersion","find","values","VERSION","toResolvableModule","resolveIds","assign","InvalidArgumentError","MissingBillingAddress","MissingCart","MissingCheckout","MissingConsignments","MissingCustomer","MissingCheckoutConfig","MissingOrder","MissingOrderConfig","MissingOrderId","MissingPayment","MissingPaymentId","MissingPaymentInstrument","MissingPaymentMethod","MissingPaymentRedirectUrl","MissingPaymentStatus","MissingPaymentToken","MissingShippingAddress","MissingDataError","PaymentArgumentInvalidError","invalidFields","join","isVaultedInstrument","instrument","instrumentId","OrderFinalizationNotRequiredError","isHostedInstrumentLike","shouldSaveInstrument","shouldSetAsDefaultInstrument","PaymentMethodFailedError","isUsBankAccountInstrumentLike","BraintreeAchPaymentStrategy","braintreeSdk","methodId","braintreeach","getMandateText","loadPaymentMethod","paymentMethod","getPaymentMethodOrThrow","initializationData","handleBraintreeError","execute","orderRequest","payment","order","isSubmittingWithVaultingInstrument","paymentData","nonce","tokenizePaymentForVaultedInstrument","tokenizePayment","submitPaymentPayload","preparePaymentDataForVaultedInstrument","preparePaymentData","submitOrder","submitPayment","finalize","getUsBankAccountOrThrow","mandateText","tokenize","bankDetails","getBankDetails","state","config","isVaultingEnabled","routingNumber","accountNumber","deviceSessionId","formattedPayload","tokenized_bank_account","issuer","masked_account_number","substr","token","billingAddress","getBillingAddressOrThrow","ownershipType","toLowerCase","accountType","firstName","lastName","businessName","streetAddress","address1","extendedAddress","address2","locality","city","region","stateOrProvinceCode","postalCode","getScriptLoader","id","PaymentInvalidFormError","details","PaymentMethodCancelledError","CancellablePromise","promise","cancellable","_","cancel","race","PAYPAL_COMPONENTS","PaypalButtonStyleLayoutOption","PaypalButtonStyleSizeOption","PaypalButtonStyleColorOption","PaypalButtonStyleLabelOption","PaypalButtonStyleShapeOption","MessagingPlacements","HORIZONTAL","VERTICAL","SMALL","MEDIUM","LARGE","RESPONSIVE","GOLD","BLUE","SIlVER","BLACK","WHITE","CHECKOUT","PAY","BUYNOW","PAYPAL","CREDIT","PILL","RECT","CART","HOME","PAYMENT","PRODUCT","BraintreeIntegrationService","overlay","dataCollectors","threeDSecureOptions","getBraintreeFastlane","cardId","isTestModeEnabled","styles","localStorage","setItem","braintreeFastlane","getSessionId","braintreeFastlaneCreator","defaultStyles","root","backgroundColorPrimary","getPaypal","braintreePaypal","newWindowFlow","supportsPopups","show","onClick","focusWindow","enableShippingAddress","flow","useraction","response","remove","catch","getPaypalCheckout","onSuccess","onError","paypalCheckout","paypalCheckoutConfig","braintreePaypalCheckout","paypalSdkLoadConfig","currency","isCreditEnabled","components","toString","intent","commit","loadPayPalSDK","getDataCollector","cacheKey","cached","getBraintreeEnv","isTestMode","mapToBraintreeShippingAddressOverride","address","recipientName","line1","line2","countryCode","phone","mapToLegacyShippingAddress","email","shippingAddress","split","first_name","last_name","phone_number","address_line_1","address_line_2","country_code","postal_code","mapToLegacyBillingAddress","removeElement","elementId","element","document","getElementById","cartId","riskCorrelationId","default","get3DS","getVenmoCheckout","venmoConfig","verifyCard","amount","tokenizationPayload","tokenizeCard","challenge3DSVerification","creditCardInstrument","ccExpiry","ccNumber","ccName","errors","getErrorsRequiredFields","isEmpty","requestData","mapToCreditCard","creditCards","request","bin","present3DSChallenge","creditCard","data","cardholderName","number","cvv","ccCvv","expirationDate","month","year","validate","countryCodeAlpha2","countryName","country","endpoint","method","addFrame","removeFrame","challengeRequested","additionalInformation","cancelVerifyCard","verification","roundedAmount","toFixed","iframe","Number","onLookupComplete","_data","next","collectDeviceData","BraintreeMessages","render","containerId","placement","messagingContainer","cart","getCartOrThrow","paypalBNPLConfiguration","bannedId","bannerConfiguration","status","removeAttribute","Messages","cartAmount","buyerCountry","style","getPaypalMessagesStylesFromBNPLConfig","messagesStyles","color","layout","logo","position","ratio","text","size","Overlay","closeElement","mainElement","_createElements","_element","_closeElement","_mainElement","parentElement","_registerClick","body","appendChild","setTimeout","opacity","_unregisterClick","_removeAfterTransition","createElement","background","transitionDuration","hasCloseButton","innerHtml","classLayout","classClose","classOverlayText","overlayText","className","addClassLayout","innerText","_addEventListener","addEventListener","_removeEventListener","removeEventListener","onClickClose","handleTransition","event","propertyName","DEFAULT_STYLES","backgroundColor","ROTATION_ANIMATION","LoadingIndicator","containerStyles","defineAnimation","container","buildContainer","indicator","buildIndicator","parentId","parent","visibility","hide","handleTransitionEnd","display","bottom","left","height","width","right","top","transition","setStyleAttribute","borderRadius","border","borderColor","margin","transform","transformStyle","animation","attrs","keys","forEach","k","setProperty","head","sheet","CSSStyleSheet","insertRule","LOADING_INDICATOR_STYLES","BraintreePaypalPaymentStrategy","braintreeIntegrationService","braintreeMessages","loadingIndicator","braintreeOptions","bannerContainerId","loadPaypalCheckoutInstance","useStoreCredit","isProviderError","paypalButtonRender","close","_resolve","handleError","braintreeTokenizePayload","grandTotal","getOutstandingBalance","storeProfile","storeLanguage","getPaymentMethod","hasOwnProperty","call","getShippingAddress","shippingAddressOverride","locale","offerCredit","shippingAddressEditable","sessionId","vaultPaymentInstrument","vault_payment_instrument","set_as_default_stored_instrument","device_info","paypal_account","paymentMethodId","shouldShowPayPalCreditBanner","renderPayPalMessages","renderPayPalButton","onPaymentError","submitForm","onRenderButton","loadingIndicatorContainer","fundingSource","FUNDING","Buttons","env","toggleLoadingIndicator","createOrder","setupPayment","onApprove","authorizeData","tokenizePaymentOrThrow","onCancel","isEligible","customer","getCustomer","getCheckoutOrThrow","outstandingBalance","currencyCode","getStoreConfigOrThrow","addresses","createPayment","filter","e","provider_error","isLoading","ContentType","Json","JsonV1","SDK_VERSION_HEADERS","BraintreeRequestSender","requestSender","getOrderStatus","url","headers","get","DEFAULT_RESPONSE","RequestError","PaymentMethodInvalidError","TimeoutError","BraintreeLocalMethodsPaymentStrategy","braintreeRequestSender","pollingInterval","maxPollingIntervalTime","isLPMsUpdateExperimentEnabled","pollingTimer","stopPolling","noop","isPollingEnabled","gatewayId","braintreelocalmethods","merchantId","isNonInstantPaymentMethod","payload","executeWithNotInstantLPM","executeWithInstantLPM","basicPaymentData","getLPMsBasicPaymentData","isBraintreeRedirectError","redirectUrl","additional_action_required","redirect_url","location","replace","startPayment","getInstantLPMConfig","getInstantLPMCallback","billing","lineItems","isShippingRequired","physicalItems","length","checkoutUrl","links","checkoutLink","paymentType","fallback","buttonText","shippingAddressRequired","givenName","surname","onPaymentStart","start","orderId","paymentId","order_id","isBraintreeOrderSavedResponse","order_id_saved_successfully","initializePollingMechanism","startPaymentError","payloadData","resetPollingMechanism","toUpperCase","resolvePromise","rejectPromise","timeout","clearTimeout","orderStatus","params","useMetadata","isOrderPending","isOrderApproved","isPollingError","deinitializePollingMechanism","reinitializeStrategy","createRequestSender","gateway","isInvalidStyleOption","styleOption","getFastlaneStyles","styleSettings","uiStyles","fastlaneStyles","omitBy","input","toggle","textBody","textCaption","caption","branding","fastlaneRootSettingsBackgroundColor","errorColor","fastlaneRootSettingsErrorColor","fontFamily","fastlaneRootSettingsFontFamily","fontSizeBase","fastlaneRootSettingsFontSize","padding","fastlaneRootSettingsPadding","primaryColor","fastlaneRootSettingsPrimaryColor","fastlaneInputSettingsBorderRadius","fastlaneInputSettingsBorderColor","focusBorderColor","fastlaneInputSettingsFocusBorderBase","fastlaneInputSettingsBackgroundColor","u","borderWidth","fastlaneInputSettingsBorderWidth","textColorBase","fastlaneInputSettingsTextColorBase","colorPrimary","fastlaneToggleSettingsColorPrimary","colorSecondary","fastlaneToggleSettingsColorSecondary","fastlaneTextBodySettingsColor","fontSize","fastlaneTextBodySettingsFontSize","fastlaneTextCaptionSettingsColor","fastlaneTextCaptionSettingsFontSize","fastlaneBrandingSettings","isBraintreeAcceleratedCheckoutCustomer","UntrustedShippingCardVerificationType","BraintreeFastlanePaymentStrategy","braintreeFastlaneUtils","braintreefastlane","onInit","onChange","isFastlaneStylingEnabled","isThreeDSExperimentEnabled","is3DSEnabled","is3dsEnabled","initializeBraintreeFastlaneOrThrow","shouldRunAuthenticationFlow","runPayPalAuthenticationFlowOrThrow","initializeCardComponent","renderBraintreeCardComponent","handleBraintreeStoredInstrumentChange","paymentPayload","preparePaymentPayload","removeSessionIdFromCookies","braintreeCardComponent","fullName","cardComponentOptions","fields","prefill","enabled","phoneNumber","paypalPaymentComponent","getBraintreeFastlaneComponentOrThrow","getBraintreeCardComponentOrThrow","paypalInstrument","getPayPalInstruments","getDeviceSessionId","threeDSToken","bigpayToken","iin","paypal_fastlane_token","getPaymentToken","paymentToken","mapToPayPalAddress","binGuest","paymentSource","card","binDetails","getOrderOrThrow","orderAmount","on","verifyError","stateOrProvince","getCustomerOrThrow","paymentProviderCustomer","getPaymentProviderCustomer","braintreePaymentProviderCustomer","paypalFastlaneSessionId","getSessionIdFromCookies","isGuest","authenticationState","getPaymentProviderCustomerOrThrow","instruments","paypalAxoSdk","getBraintreeFastlaneOrThrow","selectionChanged","selectedCard","profile","showCardSelector","braintreeFastlaneCustomer","selectedInstruments","mapPayPalToBcInstrument","updatePaymentProviderCustomer","CVV","PAN","CookieStorage","cookieKey","encodeURIComponent","cookie","value","firstIndex","indexOf","lastIndex","decodeURIComponent","substring","set","secure","cookieText","expires","path","domain","toUTCString","now","Date","minutes","setTime","getTime","BraintreeFastlaneUtils","getCart","FastlaneCardComponent","shouldSetShippingOption","getMethodIdOrThrow","lookupCustomerByEmail","triggerAuthenticationFlow","identity","getBillingAddress","isFastlaneShippingOptionAutoSelectEnabled","customerEmail","customerContextId","saveSessionIdToCookies","profileData","shippingAddresses","mapPayPalToBcAddress","paypalBillingAddress","getPayPalBillingAddresses","billingAddresses","mergeShippingAndBillingAddresses","updateBillingAddress","digitalItems","digitalItemBilling","updateShippingAddress","setShippingOption","setDate","getDate","map","brand","expiry","lastDigits","expiryYear","expiryMonth","defaultInstrument","last4","provider","trustedShippingAddress","untrustedShippingCardVerificationMode","phones","countries","getCountries","getCountryNameByCountryCode","matchedCountry","company","customFields","given_name","isEqual","normalizeAddress","omit","filteredBillingAddresses","some","consignments","getConsignments","availableShippingOptions","recommendedShippingOption","option","isRecommended","selectedOption","selectShippingOption","BraintreeVisaCheckoutPaymentStrategy","formPoster","braintreevisacheckout","visaCheckoutOptions","checkout","onPaymentSelect","braintreeVisaCheckout","visaCheckoutSdk","initOptions","createInitOptions","settings","shipping","collectShipping","paymentRequest","subtotal","String","init","paymentSuccessPayload","loadCheckout","mapToVisaCheckoutAddress","postForm","userData","cardInformation","userEmail","payment_type","action","device_data","card_information","JSON","stringify","cardType","lastTwo","billing_address","getAddress","shipping_address","hostWindow","createFormPoster","BraintreeVenmoPaymentStrategy","venmoOptions","braintreevenmo","initializeBraintreeVenmo","isBraintreeVenmoWebFallbackSupport","mobileWebFallBack","tokenizeResult","braintreeVenmoTokenize","BraintreeCreditCardPaymentStrategy","braintreeHostedForm","isHostedPaymentFormEnabled","form","unsupportedCardBrands","isHostedFormInitialized","isInitialized","shouldInitializeBraintreeFastlane","prepareHostedPaymentData","processAdditionalAction","isPaymentMethodInitialized","commonPaymentData","isSubmittingWithStoredCard","shouldPerform3DSVerification","tokenizeForStoredCardVerification","verifyCardWithHostedForm","payer_auth_request","storedCreditCardNonce","three_ds_result","getCardInstrumentOrThrow","isHostedFormEnabled","braintreeCustomer","isAcceleratedCheckoutEnabled","isBraintreeFormFieldsMap","isBraintreeHostedFormError","invalidFieldKeys","Array","isArray","every","key","BraintreeHostedFormType","CreditCard","StoredCardVerification","BraintreeHostedForm","isInitializedHostedForm","handleBlur","formOptions","onBlur","fieldType","mapFieldType","emittedBy","mapErrors","handleFocus","onFocus","handleCardTypeChange","cards","onCardTypeChange","handleInputSubmitRequest","onEnter","handleValidityChange","onValidate","isValid","isValidForm","mapValidationErrors","mapFieldOptions","cardFields","createHostedFields","mapStyleOptions","mapBillingAddress","isNil","mapTokenizeError","hostedFields","hostedFieldsOptions","preventCursorJumps","supportedCardBrands","cardBrand","includes","cardNumber","placeholder","internalLabel","accessibilityLabel","cardExpiry","cardCode","cardName","cardNumberVerification","cardCodeVerification","mapStyles","fontWeight","focus","entries","isValidParam","isPotentiallyValid","reduce","result","fieldKey","createInvalidError","isStoredCard","createRequiredError","formFields","BraintreePaypalCustomerStrategy","braintreepaypal","_e","paymentButtonStyles","checkoutTopButtonStyles","paypalCheckoutOptions","signIn","credentials","signInCustomer","signOut","signOutCustomer","executePaymentMethodCheckout","continueWithCheckoutCallback","buttonStyles","loadDefaultCheckout","tokenizePayload","buttonContainerId","onErrorCallback","BraintreePaypalCreditCustomerStrategy","braintreepaypalcredit","hasRenderedSmartButton","PAYLATER","BraintreeFastlaneCustomerStrategy","getValidPaymentMethodOrThrow","paypalFastlaneStylesSettings","checkoutPaymentMethodExecuted","undefined","primaryMethodId","shouldRunAcceleratedCheckout","validPaymentMethodId","NotImplementedError","BraintreeVisaCheckoutCustomerStrategy","buttonClassName","visaCheckoutInstance","signInButton","createSignInButton","buttonClass","querySelector","insertVisaCheckoutButton","visaCheckoutButton","flexDirection","innerHTML","BuyNowCartCreationError","getValidButtonStyle","fundingicons","shape","tagline","validStyles","getValidHeight","currentHeight","isNaN","BraintreePaypalButtonStrategy","buyNowInitializeOptions","shouldProcessPayment","onAuthorizeError","onEligibilityFailure","buyNowCart","getBuyNowCartRequestBody","createBuyNowCart","buyNowCartId","cart_id","buyNowCardRequestBody","BraintreePaypalCreditButtonStrategy","isBannerImplementationDisabled","messagingContainerId","buttonStyle","label","BraintreeVisaCheckoutButtonStrategy","paymentSuccess","toVisaCheckoutAddress","alignItems","getVenmoButtonStyle","c","backgroundPosition","backgroundSize","backgroundImage","backgroundRepeat","cursor","minHeight","minWidth","BraintreeVenmoButtonStrategy","cartButtonStyles","renderVenmoButton","handleInitializationVenmoError","cartRequestBody","removeVenmoContainer","buttonContainer","venmoButton","setAttribute","buyBowCart","handlePostForm"],"sourceRoot":""}